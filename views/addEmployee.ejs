<!--
  파일명: addEmployee.ejs
  목적: 신입 직원 추가 페이지
  기능:
  - 직원 기본 정보 입력
  - 연락처 정보 입력
  - 유니폼/장구류 사이즈 정보 입력
  - 데이터 유효성 검사
  - 반응형 폼 디자인
  - 저장 및 목록 버튼
-->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>직원 추가</title>
</head>
<body>
  <%- include('header') %>
  <div class="container" style="max-width:80%; font-size:0.9em; margin-top:2rem; margin-bottom:2rem;">
    <div class="d-flex justify-content-center">
      <div style="max-width:1200px; width:100%;">
        <h2 class="fw-bold text-center" style="margin-bottom:2rem;">신입 직원 정보 입력</h2>
        <form id="employeeForm" action="/admin/employees/new" method="POST" enctype="multipart/form-data">
          <!-- 기본정보 박스 -->
          <div class="row justify-content-center">
            <div class="col-lg-12">
              <div class="card shadow-sm mb-2" style="min-height:1px;">
                <div class="card-header bg-primary text-white py-1 fw-semibold" style="font-size:0.9rem;">기본 정보</div>
                <div class="card-body row g-2 py-3" style="flex-wrap: nowrap; overflow-x: auto; width: 100%;">
                  <div class="col" style="min-width: 100px; max-width: 120px; flex: 1;">
                    <label class="form-label small mb-1">이름 <span class="text-danger">*</span></label>
                    <input type="text" class="form-control form-control-sm py-1" id="name" name="name" required placeholder="홍길동" maxlength="20">
                  </div>
                  <div class="col" style="min-width: 100px; max-width: 120px; flex: 1;">
                    <label class="form-label small mb-1">소속 <span class="text-danger">*</span></label>
                    <select id="orgType" name="orgType" class="form-select form-select-sm py-1" required>
                      <option value="">선택</option>
                      <option value="본사">본사</option>
                      <option value="지사">지사</option>
                    </select>
                  </div>
                  <div class="col" style="min-width: 120px; max-width: 150px; flex: 1.2;">
                    <label class="form-label small mb-1">부서 <span class="text-danger">*</span></label>
                    <select id="department" name="department" class="form-select form-select-sm py-1" required>
                      <option value="">선택</option>
                      <option value="보안1팀">보안1팀</option>
                      <option value="보안2팀">보안2팀</option>
                      <option value="보안3팀">보안3팀</option>
                      <option value="관리팀">관리팀</option>
                      <option value="인사팀">인사팀</option>
                      <option value="영업팀">영업팀</option>
                      <option value="지원팀">지원팀</option>
                    </select>
                  </div>
                  <div class="col" style="min-width: 100px; max-width: 120px; flex: 1;">
                    <label class="form-label small mb-1">직급</label>
                    <select id="position" name="position" class="form-select form-select-sm py-1">
                      <option value="">선택</option>
                      <option value="인턴">인턴</option>
                      <option value="사원">사원</option>
                      <option value="주임">주임</option>
                      <option value="대리">대리</option>
                      <option value="과장">과장</option>
                      <option value="차장">차장</option>
                      <option value="팀장">팀장</option>
                      <option value="실장">실장</option>
                      <option value="임원">임원</option>
                    </select>
                  </div>
                  <div class="col" style="min-width: 130px; max-width: 160px; flex: 1.3;">
                    <label class="form-label small mb-1">입사일 <span class="text-danger">*</span></label>
                    <input type="date" name="hireDate" class="form-control form-control-sm py-1" required>
                  </div>
                  <div class="col" style="min-width: 100px; max-width: 120px; flex: 1;">
                    <label class="form-label small mb-1">상태</label>
                    <select name="status" class="form-select form-select-sm py-1">
                      <option value="재직" selected>재직</option>
                      <option value="휴직">휴직</option>
                      <option value="산재">산재</option>
                      <option value="병가">병가</option>
                      <option value="정직">정직</option>
                      <option value="퇴직">퇴직</option>
                    </select>
                  </div>
                  <div class="col" style="min-width: 200px; max-width: 250px; flex: 1.8;">
                    <label class="form-label small mb-1">연결 사용자 <span class="text-danger">*</span></label>
                    <select id="userId" name="userId" class="form-select form-select-sm py-1" required>
                      <option value="">사용자 선택</option>
                      <% if (typeof users !== 'undefined') { users.forEach(function(user) { %>
                        <option value="<%= user._id %>"><%= user.username %> (<%= user.email %>)</option>
                      <% }) } %>
                    </select>
                  </div>
                  <div class="col" style="min-width: 250px; max-width: 300px; flex: 2;">
                    <label class="form-label small mb-1">이메일 <span class="text-danger">*</span></label>
                    <input type="email" name="email" class="form-control form-control-sm py-1" required placeholder="example@company.com" maxlength="50" autocomplete="email">
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 프로필 이미지와 상세정보/유니폼 -->
          <div class="row justify-content-center align-items-start">
            <!-- 프로필 이미지: 좌측 -->
            <div class="col-lg-3 d-flex flex-column align-items-center justify-content-center" style="min-width:180px;">
              <div class="card shadow-sm mb-2 w-100" style="min-height:1px;">
                <div class="card-header bg-secondary text-white py-2 fw-semibold text-center" style="font-size:0.95rem;">프로필 이미지</div>
                <div class="card-body d-flex flex-column align-items-center justify-content-center py-3">
                  <!-- 이미지 미리보기 컨테이너 -->
                  <div class="position-relative mb-3">
                    <div id="profileImageContainer" class="position-relative" style="width: 120px; height: 120px; cursor: pointer;">
                      <!-- 기본 아이콘 -->
                      <div id="defaultProfileIcon" class="rounded-circle bg-secondary d-flex align-items-center justify-content-center position-absolute top-0 start-0 w-100 h-100" style="display:flex; border: 3px solid #e9ecef; z-index: 1;">
                        <i class="fa-solid fa-user fa-3x text-white"></i>
                      </div>
                      <!-- 이미지 미리보기 -->
                      <img id="profilePreview" src="" alt="프로필 사진" class="rounded-circle position-absolute top-0 start-0 w-100 h-100" style="display:none; object-fit: cover; border: 3px solid #e9ecef; z-index: 2;">
                      <!-- 이미지 변경 버튼 -->
                      <div id="imageChangeOverlay" class="position-absolute top-0 start-0 w-100 h-100 rounded-circle d-flex align-items-center justify-content-center" style="display:none; background: rgba(0,0,0,0.5); cursor: pointer; z-index: 3;">
                        <i class="fa-solid fa-camera text-white fa-lg"></i>
                      </div>
                    </div>
                  </div>
                  
                  <!-- 파일 입력 컨테이너 -->
                  <div id="profileImageInputBox" style="width:100%; display:flex; justify-content:center; flex-direction:column; align-items:center;">
                    <div class="text-center mb-2">
                      <small class="text-muted">권장 크기: 300x300px</small>
                    </div>
                    <!-- 실제 파일 입력 필드 (숨김) -->
                    <input type="file" name="profileImage" id="profileImageInput" accept="image/*" style="display: none;">
                  </div>
                  
                  <!-- 부서/이름 표시 -->
                  <div class="text-center mt-2">
                    <span class="fw-bold d-block" id="profileDeptName" style="font-size:1.1em; color: #495057;"></span>
                    <small class="text-muted" id="imageStatus">이미지를 선택해주세요</small>
                  </div>
                </div>
              </div>
              <!-- 저장/목록 버튼 - 프로필 이미지 밑 -->
              <div class="d-flex justify-content-center mt-3 mb-3">
                <button type="submit" form="employeeForm" class="btn btn-primary px-4 py-2 me-2">저장</button>
                <a href="/employees" class="btn btn-secondary px-4 py-2">목록</a>
              </div>
            </div>
            <!-- 우측: 상세정보 + 유니폼 -->
            <div class="col-lg-9">
                        <!-- 상세 정보 카드 -->
          <div class="card shadow-sm mb-2" style="min-height:1px;">
            <div class="card-header bg-secondary text-white py-1 fw-semibold" style="font-size:0.8rem;">상세 정보</div>
            <div class="card-body row g-1 py-0">
              <div class="col-md-2">
                <label class="form-label small mb-1">주민등록번호</label>
                <input type="text" name="residentNumber" id="residentNumber" class="form-control form-control-sm py-1" placeholder="000000-0000000" maxlength="14">
                <div id="residentNumberError" class="text-danger small" style="display:none;"></div>
              </div>
              <div class="col-md-2">
                <label class="form-label small mb-1">생년월일</label>
                <input type="date" name="birth" class="form-control form-control-sm py-1">
              </div>
              <div class="col-md-1" style="width: 16%;">
                <label class="form-label small mb-1">성별</label>
                <select name="gender" class="form-select form-select-sm py-1">
                  <option value="">선택</option>
                  <option value="남">남</option>
                  <option value="여">여</option>
                </select>
              </div>
              <div class="col-md-1" style="width: 16%;">
                <label class="form-label small mb-1">국적</label>
                <input type="text" name="nationality" class="form-control form-control-sm py-1">
              </div>
              <div class="col-md-2">
                <label class="form-label small mb-1">휴대폰</label>
                <input type="text" name="mobile" class="form-control form-control-sm py-1" placeholder="예: 010-1234-5678">
              </div>
              <div class="col-md-2">
                <label class="form-label small mb-1">연락처</label>
                <input type="text" name="phone" class="form-control form-control-sm py-1" placeholder="예: 02-1234-5678">
              </div>
              <div class="col-md-4">
                <label class="form-label small mb-0">주소</label>
                <input type="text" name="address" class="form-control form-control-sm py-1">
              </div>
              <div class="col-md-2">
                <label class="form-label small mb-1">학력</label>
                <input type="text" name="education" class="form-control form-control-sm py-1">
              </div>
              <div class="col-md-2">
                <label class="form-label small mb-1">비상연락처</label>
                <input type="text" name="emergencyContact" class="form-control form-control-sm py-1">
              </div>
              <div class="col-md-2">
                <label class="form-label small mb-1">고용형태</label>
                <select name="employmentType" class="form-select form-select-sm py-1">
                  <option value="">선택</option>
                  <option value="정규직">정규직</option>
                  <option value="파견직">파견직</option>
                  <option value="계약직">계약직</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label small mb-1">급여은행</label>
                <input type="text" name="salaryBank" class="form-control form-control-sm py-1">
              </div>
              <div class="col-md-2">
                <label class="form-label small mb-1">급여계좌</label>
                <input type="text" name="salaryAccount" class="form-control form-control-sm py-1">
              </div>
              <div class="col-md-1">
                <label class="form-label small mb-1">신장(cm)</label>
                <input type="number" name="height" class="form-control form-control-sm py-1">
              </div>
              <div class="col-md-1">
                <label class="form-label small mb-1">체중(kg)</label>
                <input type="number" name="weight" class="form-control form-control-sm py-1">
              </div>
              <div class="col-md-1">
                <label class="form-label small mb-1">혈액형</label>
                <input type="text" name="bloodType" class="form-control form-control-sm py-1">
              </div>

              <div class="col-md-2">
                <label class="form-label small mb-1">군별</label>
                <input type="text" name="militaryBranch" class="form-control form-control-sm py-1" placeholder="예: 육군, 해군, 공군">
              </div>
              <div class="col-md-2">
                <label class="form-label small mb-1">계급</label>
                <input type="text" name="militaryRank" class="form-control form-control-sm py-1" placeholder="예: 병장, 상병, 일병">
              </div>
              <div class="col-md-2">
                <label class="form-label small mb-1">군번</label>
                <input type="text" name="militaryNumber" class="form-control form-control-sm py-1" placeholder="예: 12-345678">
              </div>
              <div class="col-md-2">
                <label class="form-label small mb-1">복무기간</label>
                <input type="text" name="militaryServicePeriod" class="form-control form-control-sm py-1" placeholder="예: 2020.01-2021.12">
              </div>
                <div class="col-md-4">
                <label class="form-label small mb-1">미필사유</label>
                <input type="text" name="militaryExemptionReason" class="form-control form-control-sm py-1" placeholder="예: 면제, 제외, 기타사유">
              </div>
              <div class="col-md-12">
                <label class="form-label small mb-1">경력사항</label>
                <textarea name="career" class="form-control form-control-sm py-1" rows="3" placeholder="경력사항을 입력하세요"></textarea>
              </div>
              <div class="col-md-12">
                <label class="form-label small mb-1">특이사항</label>
                <input type="text" name="specialNotes" class="form-control form-control-sm py-1" placeholder="특이사항을 입력하세요">
              </div>
            </div>
          </div>
              
              <div class="card shadow-sm mb-2" style="min-height:1px;">
                <div class="card-header bg-info text-white py-1 fw-semibold" style="font-size:0.8rem;">유니폼/장구류</div>
                <div class="card-body py-2">
                  <!-- 첫 번째 줄 -->
                  <div class="uniform-category mb-2">
                    <div class="row g-2">
                      <div class="col-md-2">
                        <label class="form-label small mb-1 fw-semibold">하복 상의</label>
                        <select name="uniformSummerTop" class="form-select form-select-sm py-1">
                          <option value="">선택</option>
                          <option value="2별대">2별대</option>
                          <option value="별대">별대</option>
                          <option value="특대">특대</option>
                          <option value="대">대</option>
                          <option value="중">중</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small mb-1 fw-semibold">동복 상의</label>
                        <select name="uniformWinterTop" class="form-select form-select-sm py-1">
                          <option value="">선택</option>
                          <option value="2별대">2별대</option>
                          <option value="별대">별대</option>
                          <option value="특대">특대</option>
                          <option value="대">대</option>
                          <option value="중">중</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small mb-1 fw-semibold">춘추복</label>
                        <select name="springAutumnUniform" class="form-select form-select-sm py-1">
                          <option value="">선택</option>
                          <option value="2별대">2별대</option>
                          <option value="별대">별대</option>
                          <option value="특대">특대</option>
                          <option value="대">대</option>
                          <option value="중">중</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small mb-1 fw-semibold">방한외투</label>
                        <select name="uniformWinterCoat" class="form-select form-select-sm py-1">
                          <option value="">선택</option>
                          <option value="2별대">2별대</option>
                          <option value="별대">별대</option>
                          <option value="특대">특대</option>
                          <option value="대">대</option>
                          <option value="중">중</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small mb-1 fw-semibold">우의</label>
                        <select name="raincoat" class="form-select form-select-sm py-1">
                          <option value="">선택</option>
                          <option value="2별대">2별대</option>
                          <option value="별대">별대</option>
                          <option value="특대">특대</option>
                          <option value="대">대</option>
                          <option value="중">중</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <div class="d-flex align-items-center mb-1">
                          <input type="radio" id="winterJacketRadio" name="jacketType" value="winterJacket">
                          <label for="winterJacketRadio" class="form-label small mb-0 me-2 ms-1">동점퍼</label>
                          <input type="radio" id="doubleJacketRadio" name="jacketType" value="doubleJacket">
                          <label for="doubleJacketRadio" class="form-label small mb-0 me-2 ms-1">겹점퍼</label>
                        </div>
                        <select id="jacketSizeSelect" name="" class="form-select form-select-sm py-1" style="display:block;">
                          <option value="">선택</option>
                          <option value="2별대">2별대</option>
                          <option value="별대">별대</option>
                          <option value="특대">특대</option>
                          <option value="대">대</option>
                          <option value="중">중</option>
                        </select>
                        <input type="hidden" id="jacketTypeHidden" name="jacketTypeSelected" value="">
                      </div>
                    </div>
                  </div>

                  <!-- 두 번째 줄 -->
                  <div class="uniform-category">
                    <div class="row g-2">
                      <div class="col-md-2">
                        <label class="form-label small mb-1 fw-semibold">하복 하의</label>
                        <select name="uniformSummerBottom" class="form-select form-select-sm py-1">
                          <option value="">선택</option>
                          <option value="38">38</option>
                          <option value="36">36</option>
                          <option value="35">35</option>
                          <option value="34">34</option>
                          <option value="33">33</option>
                          <option value="32">32</option>
                          <option value="31">31</option>
                          <option value="30">30</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small mb-1 fw-semibold">동복 하의</label>
                        <select name="uniformWinterBottom" class="form-select form-select-sm py-1">
                          <option value="">선택</option>
                          <option value="38">38</option>
                          <option value="36">36</option>
                          <option value="35">35</option>
                          <option value="34">34</option>
                          <option value="33">33</option>
                          <option value="32">32</option>
                          <option value="31">31</option>
                          <option value="30">30</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small mb-1 fw-semibold">방한하의</label>
                        <select name="uniformWinterPants" class="form-select form-select-sm py-1">
                          <option value="">선택</option>
                          <option value="38">38</option>
                          <option value="36">36</option>
                          <option value="35">35</option>
                          <option value="34">34</option>
                          <option value="33">33</option>
                          <option value="32">32</option>
                          <option value="31">31</option>
                          <option value="30">30</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small mb-1 fw-semibold">모자</label>
                        <select name="cap" class="form-select form-select-sm py-1">
                          <option value="">선택</option>
                          <option value="별대">별대</option>
                          <option value="특대">특대</option>
                          <option value="대">대</option>
                          <option value="중">중</option>
                          <option value="소">소</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small mb-1 fw-semibold">신발(안전화)</label>
                        <select name="safetyShoes" class="form-select form-select-sm py-1">
                          <option value="">선택</option>
                          <option value="290">290</option>
                          <option value="285">285</option>
                          <option value="280">280</option>
                          <option value="275">275</option>
                          <option value="270">270</option>
                          <option value="265">265</option>
                          <option value="260">260</option>
                          <option value="255">255</option>
                          <option value="250">250</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <label class="form-label small mb-1 fw-semibold">장화</label>
                        <select name="rainBoots" class="form-select form-select-sm py-1">
                          <option value="">선택</option>
                          <option value="290">290</option>
                          <option value="285">285</option>
                          <option value="280">280</option>
                          <option value="275">275</option>
                          <option value="270">270</option>
                          <option value="265">265</option>
                          <option value="260">260</option>
                          <option value="255">255</option>
                          <option value="250">250</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>

      </div>
    </div>
  </div>
  
  <%- include('footer') %>
  <style>
    footer {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      z-index: 100;
    }
  </style>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    function toggleJacketSelect() {
      const type = document.querySelector('input[name="jacketType"]:checked');
      const select = document.getElementById('jacketSizeSelect');
      const hidden = document.getElementById('jacketTypeHidden');
      
      if(type) {
        select.style.display = 'block';
        // 선택된 타입에 따라 name 속성 설정
        if(type.value === 'winterJacket') {
          select.name = 'winterJacket';
          select.id = 'winterJacketSelect';
        } else if(type.value === 'doubleJacket') {
          select.name = 'doubleJacket';
          select.id = 'doubleJacketSelect';
        }
        hidden.value = type.value;
      } else {
        select.style.display = 'block';
        select.name = '';
        select.id = 'jacketSizeSelect';
        hidden.value = '';
      }
    }
    
    // 라디오 버튼 변경 이벤트 리스너
    document.querySelectorAll('input[name="jacketType"]').forEach(radio => {
      radio.addEventListener('change', toggleJacketSelect);
    });
    
    // 초기 상태 설정
    toggleJacketSelect();
    
    // 폼 제출 전 데이터 검증 및 로깅
    document.getElementById('employeeForm').addEventListener('submit', function(e) {
      console.log('=== 폼 제출 데이터 검증 ===');
      
      // FormData 객체 생성
      const formData = new FormData(this);
      
      // 모든 필드 데이터 로깅
      console.log('기본 정보:');
      console.log('- 이름:', formData.get('name'));
      console.log('- 소속:', formData.get('orgType'));
      console.log('- 부서:', formData.get('department'));
      console.log('- 직급:', formData.get('position'));
      console.log('- 입사일:', formData.get('hireDate'));
      console.log('- 연결 사용자:', formData.get('userId'));
      console.log('- 이메일:', formData.get('email'));
      
      console.log('상세 정보:');
      console.log('- 생년월일:', formData.get('birth'));
      console.log('- 성별:', formData.get('gender'));
      console.log('- 국적:', formData.get('nationality'));
      console.log('- 학력:', formData.get('education'));
      console.log('- 신장:', formData.get('height'));
      console.log('- 체중:', formData.get('weight'));
      console.log('- 혈액형:', formData.get('bloodType'));
      console.log('- 집전화:', formData.get('phone'));
      console.log('- 비상연락처:', formData.get('emergencyContact'));
      console.log('- 급여은행:', formData.get('salaryBank'));
      console.log('- 급여계좌:', formData.get('salaryAccount'));
      console.log('- 주소:', formData.get('address'));
      console.log('- 경력사항:', formData.get('career'));
      console.log('- 특이사항:', formData.get('specialNotes'));
      
      console.log('유니폼 정보:');
      console.log('- 하복 상의:', formData.get('uniformSummerTop'));
      console.log('- 동복 상의:', formData.get('uniformWinterTop'));
      console.log('- 춘추복:', formData.get('springAutumnUniform'));
      console.log('- 동점퍼:', formData.get('winterJacket'));
      console.log('- 겹점퍼:', formData.get('doubleJacket'));
      
      console.log('=== 폼 제출 데이터 검증 끝 ===');
    });

    // 프로필 이미지 미리보기 기능
    document.addEventListener('DOMContentLoaded', function() {
      console.log('이미지 미리보기 초기화 시작');
      
      // 실제 HTML 파일 입력 필드 사용
      const hiddenInput = document.getElementById('profileImageInput');
      
      const preview = document.getElementById('profilePreview');
      const defaultIcon = document.getElementById('defaultProfileIcon');
      const imageChangeOverlay = document.getElementById('imageChangeOverlay');
      const imageStatus = document.getElementById('imageStatus');
      const profileImageContainer = document.getElementById('profileImageContainer');
      
      // 요소 존재 확인
      console.log('프로필 컨테이너:', profileImageContainer);
      console.log('미리보기:', preview);
      console.log('기본 아이콘:', defaultIcon);
      console.log('상태 텍스트:', imageStatus);
      
      // 이미지 컨테이너 클릭 시 파일 선택
      if (profileImageContainer) {
        profileImageContainer.addEventListener('click', function() {
          console.log('이미지 컨테이너 클릭됨');
          hiddenInput.click();
        });
        
        // 이미지 변경 오버레이 표시/숨김
        profileImageContainer.addEventListener('mouseenter', function() {
          if (preview && preview.style.display !== 'none') {
            imageChangeOverlay.style.display = 'flex';
          }
        });
        
        profileImageContainer.addEventListener('mouseleave', function() {
          if (imageChangeOverlay) {
            imageChangeOverlay.style.display = 'none';
          }
        });
      }
      
      hiddenInput.addEventListener('change', function(e) {
        console.log('파일 선택됨:', e.target.files);
        const file = e.target.files[0];
        
        if (file) {
          console.log('선택된 파일:', file.name, file.type, file.size);
          
          // 파일 크기 및 타입 검증
          const maxSize = 5 * 1024 * 1024; // 5MB
          const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
          
          if (file.size > maxSize) {
            alert('파일 크기는 5MB 이하여야 합니다.');
            return;
          }
          
          if (!allowedTypes.includes(file.type)) {
            alert('JPG, PNG, GIF 파일만 업로드 가능합니다.');
            return;
          }
          
          const reader = new FileReader();
          reader.onload = function(ev) {
            console.log('파일 읽기 완료');
            if (preview) {
              preview.src = ev.target.result;
              preview.style.display = 'block';
            }
            if (defaultIcon) {
              defaultIcon.style.display = 'none';
            }
            if (imageStatus) {
              imageStatus.textContent = file.name;
              imageStatus.className = 'text-success';
            }
          };
          reader.onerror = function() {
            console.error('파일 읽기 오류');
            alert('이미지 파일을 읽을 수 없습니다.');
          };
          reader.readAsDataURL(file);
        } else {
          console.log('파일 선택 취소됨');
          if (preview) {
            preview.src = '';
            preview.style.display = 'none';
          }
          if (defaultIcon) {
            defaultIcon.style.display = 'flex';
          }
          if (imageStatus) {
            imageStatus.textContent = '이미지를 선택해주세요';
            imageStatus.className = 'text-muted';
          }
        }
      });
    });
    // 부서/이름 중앙 표시
    const dept = document.getElementById('department');
    const name = document.getElementById('name');
    const deptName = document.getElementById('profileDeptName');
    function updateDeptName() {
      deptName.textContent = (dept.value ? dept.value + ' / ' : '') + (name.value || '');
    }
    dept.addEventListener('change', updateDeptName);
    name.addEventListener('input', updateDeptName);
    updateDeptName();

    // 주민등록번호 유효성검사
    const residentNumberInput = document.getElementById('residentNumber');
    const residentNumberError = document.getElementById('residentNumberError');

    function validateResidentNumber(value) {
      if (!value || value.trim() === '') {
        residentNumberError.style.display = 'none';
        residentNumberInput.classList.remove('is-invalid');
        return true;
      }

      // 형식 검사 (000000-0000000)
      const pattern = /^\d{6}-\d{7}$/;
      if (!pattern.test(value)) {
        residentNumberError.textContent = '주민등록번호 형식이 올바르지 않습니다. (예: 123456-1234567)';
        residentNumberError.style.display = 'block';
        residentNumberInput.classList.add('is-invalid');
        return false;
      }

      // 유효성 검사
      const numbers = value.replace('-', '').split('').map(Number);
      const weights = [2, 3, 4, 5, 6, 7, 8, 9, 2, 3, 4, 5];
      let sum = 0;
      
      for (let i = 0; i < 12; i++) {
        sum += numbers[i] * weights[i];
      }
      
      const remainder = sum % 11;
      const checkDigit = remainder < 2 ? 0 : 11 - remainder;
      
      if (numbers[12] !== checkDigit) {
        residentNumberError.textContent = '유효하지 않은 주민등록번호입니다.';
        residentNumberError.style.display = 'block';
        residentNumberInput.classList.add('is-invalid');
        return false;
      }
      
      residentNumberError.style.display = 'none';
      residentNumberInput.classList.remove('is-invalid');
      return true;
    }

    if (residentNumberInput) {
      residentNumberInput.addEventListener('input', function() {
        validateResidentNumber(this.value);
      });
    }
  });
  </script>
  <style>
    /* 상세정보와 유니폼 섹션 세로 길이 최적화 */
    .card-body .form-label {
      font-size: 0.7rem !important;
      margin-bottom: 0.05rem !important;
      line-height: 1.1 !important;
    }
    
    .card-body .form-control,
    .card-body .form-select {
      font-size: 0.7rem !important;
      padding: 0.15rem 0.3rem !important;
      height: 24px !important;
      line-height: 1.1 !important;
    }
    
    .card-body textarea {
      font-size: 0.7rem !important;
      line-height: 1.1 !important;
    }
    
    /* 상세정보와 유니폼 섹션 여백 최소화 */
    .card-body .col-md-1,
    .card-body .col-md-2,
    .card-body .col-md-3,
    .card-body .col-md-4,
    .card-body .col-md-12 {
      margin-bottom: 0.1rem !important;
    }
    
    /* 기본 정보 섹션 최적화 */
    .card-header.bg-primary + .card-body .form-label {
      font-size: 0.8rem !important;
      margin-bottom: 0.2rem !important;
      line-height: 1.2 !important;
    }
    
    .card-header.bg-primary + .card-body .form-control,
    .card-header.bg-primary + .card-body .form-select {
      font-size: 0.8rem !important;
      padding: 0.3rem 0.5rem !important;
      height: 32px !important;
      line-height: 1.2 !important;
    }
    
    .card-header.bg-primary + .card-body .col-md-1,
    .card-header.bg-primary + .card-body .col-md-2 {
      margin-bottom: 0.3rem !important;
    }
    
    /* 카드 헤더 최적화 */
    .card-header {
      padding: 0.4rem 0.8rem !important;
      font-size: 0.85rem !important;
      line-height: 1.2 !important;
    }
    
    /* 카드 바디 패딩 최적화 */
    .card-body {
      padding: 0.3rem 0.6rem !important;
    }
    
    /* 입력 필드 높이 최적화 */
    .form-control-sm,
    .form-select-sm {
      padding: 0.15rem 0.3rem !important;
      height: 24px !important;
      line-height: 1.1 !important;
    }
    
    /* 유니폼 섹션 최적화 */
    .uniform-section .form-label {
      font-size: 0.65rem !important;
      margin-bottom: 0.05rem !important;
      line-height: 1.1 !important;
    }
    
    .uniform-section .form-control,
    .uniform-section .form-select {
      font-size: 0.65rem !important;
      padding: 0.1rem 0.25rem !important;
      height: 22px !important;
      line-height: 1.1 !important;
    }
    
    .uniform-section .col-md-1,
    .uniform-section .col-md-2,
    .uniform-section .col-md-3 {
      margin-bottom: 0.08rem !important;
    }
  </style>
</body>
</html> 