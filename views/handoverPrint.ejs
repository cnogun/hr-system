<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏùºÏùºÏóÖÎ¨¥ Ïù∏Í≥ÑÏû• Ïù∏ÏáÑ</title>
    <link rel="stylesheet" href="/handover-print-styles.css">
</head>
<body class="<%= isPreview ? 'print-preview-mode' : '' %>">
    <div class="container">
        <!-- Ïù∏Í≥ÑÏû• Ï†úÎ™© -->
        <div class="print-title">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: 16px; font-weight: normal; color: #666; margin-right: 20px;">
                    <%= handover.formattedHandoverDate %>
                </div>
                <div style="flex: 1; text-align: center;">ÏùºÏùºÏóÖÎ¨¥ Ïù∏Í≥ÑÏû•</div>
                <div style="width: 120px;"></div> <!-- Ïö∞Ï∏° Í∑†ÌòïÏùÑ ÏúÑÌïú Îπà Í≥µÍ∞Ñ -->
            </div>
        </div>
        
        <!-- Ïù∏Í≥ÑÏû• ÌÖåÏù¥Î∏î -->
        <table class="print-handover-table">
            <thead>
                <tr>
                    <th class="print-no-col">No</th>
                    <th class="print-date-col">ÎÇ†Ïßú</th>
                    <th class="print-content-col">ÎÇ¥Ïö©</th>
                    <th class="print-report-col">Î≥¥Í≥†Ïú†Î¨¥</th>
                    <th class="print-assignee-col">ÏßÄÏãúÏûê</th>
                    <th class="print-team-col">ÏûëÏÑ±Î∞ò</th>
                </tr>
            </thead>
            <tbody>
                <% if (handover.handoverItems && handover.handoverItems.length > 0) { %>
                    <% handover.handoverItems.forEach(function(item, index) { %>
                    <tr>
                        <!-- Î≤àÌò∏ Ïª¨Îüº -->
                        <td class="print-no-col">
                            <div style="font-weight: bold; font-size: 12px; text-align: center;">
                                <%= index + 1 %>
                            </div>
                        </td>
                        
                        <!-- ÎÇ†Ïßú Ïª¨Îüº -->
                        <td class="print-date-col">
                            <% if (item.taskDetails && item.taskDetails.dateTime) { %>
                                <div style="font-weight: bold;"><%= item.taskDetails.dateTime.date || '' %></div>
                                <div style="font-size: 10px; color: #666; margin-top: 2px;">
                                    <%= item.taskDetails.dateTime.startTime || '' %>~<%= item.taskDetails.dateTime.endTime || '' %>
                                </div>
                            <% } else { %>
                                <div style="font-weight: bold;"><%= handover.formattedHandoverDate %></div>
                            <% } %>
                        </td>
                        
                        <!-- ÎÇ¥Ïö© Ïª¨Îüº -->
                        <td class="print-content-col">
                            <div class="print-task-type">
                                <% if (handover.handoverType === 'security') { %>
                                    üîí <%= item.taskType %>
                                <% } else { %>
                                    ‚öôÔ∏è <%= item.taskType %>
                                <% } %>
                            </div>
                            
                            <% if (item.taskDetails) { %>
                                <div class="print-task-details">
                                    <div style="margin-top: 3px;">
                                        <% if (item.taskDetails.personnel && item.taskDetails.personnel.name) { %>
                                        <div class="print-personnel" style="margin-bottom: 2px;">
                                            <strong>Îã¥ÎãπÏûê:</strong> <%= item.taskDetails.personnel.name %>
                                            <% if (item.taskDetails.personnel.phone) { %>
                                            (<%= item.taskDetails.personnel.phone %>)
                                            <% } %>
                                        </div>
                                        <% } %>
                                        
                                        <% if (item.taskDetails.location) { %>
                                        <div class="print-location" style="margin-bottom: 2px;">
                                            <strong>Ïû•ÏÜå:</strong> <%= item.taskDetails.location %>
                                        </div>
                                        <% } %>
                                        
                                        <% if (item.taskDetails.content) { %>
                                        <div class="print-content" style="margin-bottom: 2px;">
                                            <strong>ÎÇ¥Ïö©:</strong> <%= item.taskDetails.content %>
                                        </div>
                                        <% } %>
                                        
                                        <% if (item.taskDetails.additionalInfo) { %>
                                        <div class="print-additional-info">
                                            <strong>ÌäπÏù¥ÏÇ¨Ìï≠:</strong> <%= item.taskDetails.additionalInfo %>
                                        </div>
                                        <% } %>
                                    </div>
                                </div>
                            <% } %>
                        </td>
                        
                        <!-- Î≥¥Í≥†Ïú†Î¨¥ Ïª¨Îüº -->
                        <td class="print-report-col">
                            <div class="print-report-completed <%= item.reportCompleted ? 'yes' : 'no' %>">
                                <%= item.reportCompleted ? 'ÏôÑÎ£å' : 'ÎØ∏ÏôÑÎ£å' %>
                            </div>
                        </td>
                        
                        <!-- ÏßÄÏãúÏûê Ïª¨Îüº -->
                        <td class="print-assignee-col">
                            <%= handover.handoverFrom ? handover.handoverFrom.name : 'ÎØ∏ÏßÄÏ†ï' %>
                        </td>
                        
                        <!-- ÏûëÏÑ±Î∞ò Ïª¨Îüº -->
                        <td class="print-team-col">
                            <div style="text-align: center;">
                                <div class="print-team-badge print-team-<%= item.assignedTeam.charAt(0) %>" style="margin-bottom: 3px;">
                                    <%= item.assignedTeam %>
                                </div>
                                <div>
                                    <span class="print-time-badge print-time-<%= item.timeCategory === 'Ï£ºÍ∞Ñ' ? 'day' : (item.timeCategory === 'ÏïºÍ∞Ñ' ? 'night' : 'late') %>">
                                        <%= item.timeCategory %>
                                    </span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <% }); %>
                <% } else { %>
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px; color: #666;">
                            Îì±Î°ùÎêú Ïù∏Í≥ÑÏÇ¨Ìï≠Ïù¥ ÏóÜÏäµÎãàÎã§.
                        </td>
                    </tr>
                <% } %>
                
                <!-- Îπà Ìñâ Ï∂îÍ∞Ä (Ïù∏ÏáÑ Ïãú Ïó¨Î∞± ÌôïÎ≥¥) -->
                <% for (let i = 0; i < 5; i++) { %>
                <tr class="print-empty-row">
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <% } %>
            </tbody>
        </table>
        
    </div>
    
    <script>
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï≤òÎ¶¨
        window.onload = function() {
            <% if (!isPreview) { %>
            // ÎØ∏Î¶¨Î≥¥Í∏∞Í∞Ä ÏïÑÎãå Í≤ΩÏö∞ÏóêÎßå ÏûêÎèô Ïù∏ÏáÑ
            window.print();
            
            // Ïù∏ÏáÑ ÏôÑÎ£å ÌõÑ ÏõêÎûò ÌéòÏù¥ÏßÄÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
            window.onafterprint = function() {
                window.close();
            };
            <% } else { %>
            // ÎØ∏Î¶¨Î≥¥Í∏∞ Î™®ÎìúÏù∏ Í≤ΩÏö∞ Ïù∏ÏáÑ Î≤ÑÌäº Ï∂îÍ∞Ä
            addPrintButton();
            <% } %>
        };
        
        <% if (isPreview) { %>
        function addPrintButton() {
            const printButton = document.createElement('div');
            printButton.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; z-index: 1000; background: white; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <button onclick="window.print()" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-right: 10px;">Ïù∏ÏáÑ</button>
                    <button onclick="window.close()" style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Îã´Í∏∞</button>
                </div>
            `;
            document.body.appendChild(printButton);
        }
        <% } %>
    </script>
</body>
</html>
