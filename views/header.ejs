<!--
  파일명: header.ejs
  목적: 애플리케이션 공통 헤더 컴포넌트
  기능:
  - 네비게이션 메뉴 표시
  - 사용자 로그인 상태 표시
  - 권한별 메뉴 표시/숨김
  - 로그아웃 기능
  - 반응형 디자인 적용 (모바일 햄버거 메뉴)
  - 현대적인 UI/UX
-->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="/mobile-optimization.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<header class="sticky-top shadow-lg bg-white border-bottom">
  <div class="container-fluid py-3">
    <div class="d-flex justify-content-between align-items-center">
      <!-- 햄버거 메뉴 버튼 (모바일에서만 표시, 좌측 배치) -->
      <% if (typeof session !== 'undefined' && session && session.userId) { %>
        <button class="navbar-toggler d-lg-none order-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      <% } %>
      
      <!-- 로고 및 브랜드 -->
      <div class="d-flex align-items-center gap-3 flex-grow-1 justify-content-center justify-content-lg-start">
        <div class="brand-logo">
          <i class="fa-solid fa-users-gear fa-2x text-primary"></i>
        </div>
        <div class="brand-text">
          <h2 class="mb-0 fw-bold text-primary">인사관리 시스템</h2>
          <small class="text-muted">Human Resource Management System</small>
        </div>
      </div>
      
      <% if (typeof session !== 'undefined' && session && session.userId) { %>
      <!-- 네비게이션 메뉴 -->
      <nav class="navbar navbar-expand-lg order-2">
        <!-- 네비게이션 메뉴 -->
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link d-flex align-items-center" href="/dashboard">
                <i class="fa-solid fa-chart-line me-2"></i> 대시보드
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link d-flex align-items-center" href="/employees">
                <i class="fa-solid fa-users me-2"></i>직원 찾기
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link d-flex align-items-center" href="/boards">
                <i class="fa-solid fa-comments me-2"></i> 게시판
              </a>
            </li>
            

            
            <% if ((typeof session !== 'undefined' && session && session.userRole === 'admin') || (typeof userRole !== 'undefined' && userRole === 'admin')) { %>
            <!-- 관리자 메뉴 -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown">
                <i class="fa-solid fa-cog me-2"></i> 관리자
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><h6 class="dropdown-header">시스템 관리</h6></li>
                <li><a class="dropdown-item" href="/boards/admin/reports">
                  <i class="fa-solid fa-flag me-2"></i> 게시판 신고 관리
                </a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><h6 class="dropdown-header">데이터 관리</h6></li>
                  <li><a class="dropdown-item" href="/uniform/stats">
                    <i class="fa-solid fa-tshirt me-2"></i> 유니폼 현황
                  </a></li>
                  <li><a class="dropdown-item" href="/auth/logs">
                    <i class="fa-solid fa-history me-2"></i> 활동 로그 관리
                  </a></li>
                </ul>
              </li>
             
             <!-- 엑셀관리 메뉴 -->
             <li class="nav-item dropdown">
               <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="excelDropdown" role="button" data-bs-toggle="dropdown">
                 <i class="fa-solid fa-file-excel me-2"></i> 엑셀관리
               </a>
               <ul class="dropdown-menu dropdown-menu-end">
                 <li><h6 class="dropdown-header">통합 엑셀 관리</h6></li>
                 <li><a class="dropdown-item" href="/excelManager">
                   <i class="fa-solid fa-table me-2"></i> 통합 엑셀 관리
                 </a></li>
              </ul>
            </li>
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="employeeInputDropdown" role="button" data-bs-toggle="dropdown">
                <i class="fa-solid fa-user-plus me-2"></i> 정보 입력
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><h6 class="dropdown-header">직원 등록</h6></li>
                <li><a class="dropdown-item" href="/employees/new">
                  <i class="fa-solid fa-user-plus me-2"></i>신입사원등록
                </a></li>
                <li><a class="dropdown-item" href="/employees/existing">
                  <i class="fa-solid fa-user-edit me-2"></i>등록사원수정
                </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><h6 class="dropdown-header">근태 관리</h6></li>
                <li><a class="dropdown-item" href="/attendance">
                  <i class="fa-solid fa-clock me-2"></i>근태 입력
                </a></li>
                <li><a class="dropdown-item" href="/monthlyAttendance">
                  <i class="fa-solid fa-calendar-days me-2"></i>월간 근태현황
                </a></li>
                <li><a class="dropdown-item" href="/workSchedule">
                  <i class="fa-solid fa-calendar-alt me-2"></i>근무 스케줄 관리
                </a></li>
              </ul>
            </li>
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="securityWorkDropdown" role="button" data-bs-toggle="dropdown">
                <i class="fa-solid fa-shield-alt me-2"></i> 보안업무
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><h6 class="dropdown-header">보안 관리</h6></li>
                <li><a class="dropdown-item" href="/security/duty-orders">
                  <i class="fa-solid fa-clipboard-list me-2"></i> 인사명령
                </a></li>
                <li><a class="dropdown-item" href="/security/work-orders">
                  <i class="fa-solid fa-file-alt me-2"></i> 근무명령서
                </a></li>
                <li><a class="dropdown-item" href="/security/handover">
                  <i class="fa-solid fa-exchange-alt me-2"></i> 인계사항
                </a></li>
                <li><a class="dropdown-item" href="/security/schedule">
                  <i class="fa-solid fa-calendar-alt me-2"></i> 일정
                </a></li>
              </ul>
            </li>
            <% } %>
          </ul>
        </div>
      </nav>
      <% } %>
      
      <!-- 사용자 정보 및 액션 -->
      <div class="d-flex align-items-center gap-3 order-3">
        <% if (typeof session !== 'undefined' && session && session.userId) { %>
          <a href="/notice/new" class="btn btn-warning btn-sm me-2 d-none d-md-inline-block">
            <i class="fa-solid fa-bullhorn me-1"></i> 시스템 공지
          </a>
          
          <div class="vr mx-2 d-none d-md-block" style="height: 35px; opacity: 0.3;"></div>
          
          <div class="user-info text-end d-none d-md-block">
            <div class="fw-semibold text-primary" style="font-size: 0.9rem;">
              <i class="fa-solid fa-user me-1"></i>관리자
            </div>
            <div class="fw-semibold text-dark" style="font-size: 0.9rem;">
              <i class="fa-solid fa-user-tie me-1"></i><%= position %>
            </div>
          </div>
          
          <a href="/auth/logout" class="btn btn-outline-danger btn-sm">
            <i class="fa-solid fa-right-from-bracket me-1"></i> <span class="d-none d-sm-inline">로그아웃</span>
          </a>
        <% } else { %>
          <div class="auth-actions">
            <a href="/auth/login" class="btn btn-primary btn-sm me-2">
              <i class="fa-solid fa-sign-in-alt me-1"></i> <span class="d-none d-sm-inline">로그인</span>
            </a>
            <a href="/auth/register" class="btn btn-outline-primary btn-sm">
              <i class="fa-solid fa-user-plus me-1"></i> <span class="d-none d-sm-inline">회원가입</span>
            </a>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</header>

<script>
// 전역 변수로 이벤트 리스너 중복 등록 방지
let dropdownInitialized = false;
let eventListenersAttached = false;

// 디버깅을 위한 콘솔 로그
console.log('Header script 로드됨');
console.log('Bootstrap 상태:', typeof bootstrap);
console.log('Document ready:', document.readyState);

// Bootstrap 드롭다운이 로드될 때까지 대기
function waitForBootstrap() {
  if (typeof bootstrap !== 'undefined') {
    console.log('Bootstrap 로드됨, 드롭다운 초기화 시작');
    
    if (!dropdownInitialized) {
      initializeDropdowns();
      dropdownInitialized = true;
    }
    
    if (!eventListenersAttached) {
      attachEventListeners();
      eventListenersAttached = true;
    }
    
    // 모바일 햄버거 메뉴 초기화
    initializeMobileMenu();
    
    console.log('모든 드롭다운 및 모바일 메뉴 초기화 완료');
  } else {
    console.log('Bootstrap 로드 대기 중...');
    setTimeout(waitForBootstrap, 100);
  }
}

// 드롭다운 초기화 함수
function initializeDropdowns() {
  document.querySelectorAll('.dropdown-toggle').forEach(function(element) {
    try {
      // 기존 인스턴스가 있다면 제거
      const existingInstance = bootstrap.Dropdown.getInstance(element);
      if (existingInstance) {
        existingInstance.dispose();
      }
      
      // aria-expanded 속성 명시적 설정
      element.setAttribute('aria-expanded', 'false');
      
      // 새 인스턴스 생성
      const dropdown = new bootstrap.Dropdown(element, {
        autoClose: 'inside',
        boundary: 'viewport'
      });
      
      // 드롭다운 상태 변경 이벤트 리스너 추가
      element.addEventListener('show.bs.dropdown', function() {
        this.setAttribute('aria-expanded', 'true');
        console.log('드롭다운 열림:', this.textContent.trim());
        
        // 다른 모든 메뉴의 active 상태 제거
        document.querySelectorAll('.navbar-nav .nav-link.active, .dropdown-item.active').forEach(link => {
          if (link !== this) {
            link.classList.remove('active');
          }
        });
        
        // 현재 드롭다운 토글만 active 상태로 설정
        this.classList.add('active');
      });
      
      element.addEventListener('hide.bs.dropdown', function() {
        this.setAttribute('aria-expanded', 'false');
        console.log('드롭다운 닫힘:', this.textContent.trim());
        
        // 드롭다운이 닫힐 때 active 상태 제거
        this.classList.remove('active');
      });
      
      console.log('드롭다운 초기화됨:', element.textContent.trim());
      
    } catch (error) {
      console.error('드롭다운 초기화 오류:', error);
    }
  });
}

// 이벤트 리스너 등록 함수
function attachEventListeners() {
  // 드롭다운 토글 클릭 이벤트
  document.addEventListener('click', function(e) {
    const dropdownToggle = e.target.closest('.dropdown-toggle');
    if (dropdownToggle) {
      e.preventDefault();
      e.stopPropagation();
      
      console.log('드롭다운 토글 클릭됨:', dropdownToggle.textContent.trim());
      
      // 모든 메뉴의 active 상태 초기화 (드롭다운 토글과 하위 메뉴 모두)
      document.querySelectorAll('.navbar-nav .nav-link.active, .dropdown-item.active').forEach(link => {
        link.classList.remove('active');
      });
      
      // 클릭된 드롭다운 토글에만 active 상태 설정
      dropdownToggle.classList.add('active');
      console.log('드롭다운 토글 active 상태 설정됨:', dropdownToggle.textContent.trim());
      
      // Bootstrap 드롭다운 토글
      const dropdown = bootstrap.Dropdown.getInstance(dropdownToggle);
      if (dropdown) {
        // 현재 상태 확인
        const isExpanded = dropdownToggle.getAttribute('aria-expanded') === 'true';
        
        if (isExpanded) {
          dropdown.hide();
          dropdownToggle.setAttribute('aria-expanded', 'false');
          // 드롭다운이 닫힐 때 active 상태도 제거
          dropdownToggle.classList.remove('active');
        } else {
          dropdown.show();
          dropdownToggle.setAttribute('aria-expanded', 'true');
        }
      }
    }
    
    // 드롭다운 메뉴 외부 클릭 시 모든 드롭다운 닫기 및 active 상태 초기화
    if (!e.target.closest('.dropdown')) {
      closeAllDropdowns();
      // 외부 클릭 시 모든 active 상태 제거
      document.querySelectorAll('.navbar-nav .nav-link.active, .dropdown-item.active').forEach(link => {
        link.classList.remove('active');
      });
    }
  });
  
  // 메뉴 링크 클릭 이벤트
  document.addEventListener('click', function(e) {
    const menuLink = e.target.closest('.nav-link:not(.dropdown-toggle), .dropdown-item');
    if (menuLink && menuLink.getAttribute('href') && menuLink.getAttribute('href') !== '#') {
      console.log('메뉴 링크 클릭됨:', menuLink.textContent.trim());
      
      // 모든 드롭다운 닫기
      closeAllDropdowns();
      
      // 모든 메뉴의 active 상태 완전 초기화
      document.querySelectorAll('.navbar-nav .nav-link.active, .dropdown-item.active').forEach(link => {
        link.classList.remove('active');
      });
      
      // 클릭된 메뉴에만 active 상태 설정
      menuLink.classList.add('active');
      
      // 드롭다운 메뉴인 경우 상위 메뉴도 active
      if (menuLink.classList.contains('dropdown-item')) {
        const parentDropdown = menuLink.closest('.dropdown');
        if (parentDropdown) {
          const parentToggle = parentDropdown.querySelector('.dropdown-toggle');
          if (parentToggle) {
            parentToggle.classList.add('active');
            console.log('상위 드롭다운 토글 active 상태 설정됨:', parentToggle.textContent.trim());
          }
        }
      }
      
      console.log('메뉴 링크 active 상태 설정됨:', menuLink.textContent.trim());
    }
  });
}

// 모든 드롭다운 닫기 함수
function closeAllDropdowns() {
  document.querySelectorAll('.dropdown-toggle').forEach(function(toggle) {
    const dropdown = bootstrap.Dropdown.getInstance(toggle);
    if (dropdown) {
      dropdown.hide();
      toggle.setAttribute('aria-expanded', 'false');
    }
  });
}

// 다른 모든 드롭다운 닫기 함수
function closeAllOtherDropdowns(currentToggle) {
  document.querySelectorAll('.dropdown-toggle').forEach(function(toggle) {
    if (toggle !== currentToggle) {
      const dropdown = bootstrap.Dropdown.getInstance(toggle);
      if (dropdown) {
        dropdown.hide();
        toggle.setAttribute('aria-expanded', 'false');
      }
    }
  });
}

// 모바일 햄버거 메뉴 초기화 함수
function initializeMobileMenu() {
  const navbarToggler = document.querySelector('.navbar-toggler');
  const navbarCollapse = document.querySelector('.navbar-collapse');
  
  if (navbarToggler && navbarCollapse) {
    // 모바일에서 메뉴 열림/닫힘 이벤트 처리
    navbarCollapse.addEventListener('show.bs.collapse', function() {
      console.log('모바일 메뉴 열림');
      // 메뉴가 열릴 때 모든 드롭다운 닫기
      closeAllDropdowns();
    });
    
    navbarCollapse.addEventListener('hide.bs.collapse', function() {
      console.log('모바일 메뉴 닫힘');
    });
    
    // 모바일에서 메뉴 링크 클릭 시 자동으로 메뉴 닫기
    const mobileMenuLinks = navbarCollapse.querySelectorAll('.nav-link:not(.dropdown-toggle), .dropdown-item');
    mobileMenuLinks.forEach(link => {
      link.addEventListener('click', function() {
        if (window.innerWidth <= 991.98) {
          // 모바일에서만 메뉴 자동 닫기
          const bsCollapse = bootstrap.Collapse.getInstance(navbarCollapse);
          if (bsCollapse) {
            bsCollapse.hide();
          }
        }
      });
    });
    
    console.log('모바일 햄버거 메뉴 초기화 완료');
  }
}



// 로딩 토스트 표시 함수
function showLoadingToast(message) {
  const toastContainer = document.getElementById('toast-container') || createToastContainer();
  
  const toast = document.createElement('div');
  toast.className = 'toast show bg-info text-white';
  toast.innerHTML = `
    <div class="toast-body d-flex align-items-center">
      <div class="spinner-border spinner-border-sm me-2" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      ${message}
    </div>
  `;
  
  toastContainer.appendChild(toast);
  return toast;
}

// 로딩 토스트 숨기기 함수
function hideLoadingToast(toast) {
  if (toast && toast.parentNode) {
    toast.parentNode.removeChild(toast);
  }
}

// 성공 토스트 표시 함수
function showSuccessToast(message) {
  const toastContainer = document.getElementById('toast-container') || createToastContainer();
  
  const toast = document.createElement('div');
  toast.className = 'toast show bg-success text-white';
  toast.innerHTML = `
    <div class="toast-body">
      <i class="fa-solid fa-check-circle me-2"></i>
      ${message}
    </div>
  `;
  
  toastContainer.appendChild(toast);
  
  // 3초 후 자동으로 숨기기
  setTimeout(() => {
    if (toast.parentNode) {
      toast.parentNode.removeChild(toast);
    }
  }, 3000);
}

// 에러 토스트 표시 함수
function showErrorToast(message) {
  const toastContainer = document.getElementById('toast-container') || createToastContainer();
  
  const toast = document.createElement('div');
  toast.className = 'toast show bg-danger text-white';
  toast.innerHTML = `
    <div class="toast-body">
      <i class="fa-solid fa-exclamation-triangle me-2"></i>
      ${message}
    </div>
  `;
  
  toastContainer.appendChild(toast);
  
  // 5초 후 자동으로 숨기기
  setTimeout(() => {
    if (toast.parentNode) {
      toast.parentNode.removeChild(toast);
    }
  }, 5000);
}

// 토스트 컨테이너 생성 함수
function createToastContainer() {
  const container = document.createElement('div');
  container.id = 'toast-container';
  container.className = 'toast-container position-fixed top-0 end-0 p-3';
  container.style.zIndex = '9999';
  document.body.appendChild(container);
  return container;
}

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM 로드됨, Bootstrap 대기 시작');
  waitForBootstrap();
  
  // 현재 페이지에 따른 메뉴 active 상태 설정
  setActiveMenuForCurrentPage(window.location.pathname);
});

// 현재 페이지에 따른 메뉴 active 상태 설정
function setActiveMenuForCurrentPage(currentPath) {
  console.log('현재 페이지 경로:', currentPath);
  
  // 모든 메뉴에서 active 클래스 제거
  document.querySelectorAll('.navbar-nav .nav-link, .dropdown-item').forEach(link => {
    link.classList.remove('active');
  });
  
  // 현재 페이지에 해당하는 메뉴 찾기
  const currentMenuItem = document.querySelector(`a[href="${currentPath}"]`);
  if (currentMenuItem) {
    console.log('현재 페이지 메뉴 발견:', currentMenuItem.textContent.trim());
    
    // 클릭된 메뉴에 active 상태 설정
    currentMenuItem.classList.add('active');
    
    // 드롭다운 메뉴인 경우 상위 메뉴도 active
    if (currentMenuItem.classList.contains('dropdown-item')) {
      const parentDropdown = currentMenuItem.closest('.dropdown');
      if (parentDropdown) {
        const parentToggle = parentDropdown.querySelector('.dropdown-toggle');
        if (parentToggle) {
          parentToggle.classList.add('active');
          console.log('상위 드롭다운 토글 active 상태 설정됨:', parentToggle.textContent.trim());
        }
      }
    }
    
    console.log('현재 페이지 메뉴 active 상태 설정 완료');
  } else {
    console.log('현재 페이지에 해당하는 메뉴를 찾을 수 없음');
  }
}
</script>

<style>
body { 
  background: linear-gradient(135deg, #f8fafc 0%, #e2eafc 100%);
  min-height: 100vh;
}

/* 브랜드 스타일 */
.brand-logo {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 1rem;
  border-radius: 20px;
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.25);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.brand-logo::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
  transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: -1;
}

.brand-logo:hover::before {
  left: 0;
}

.brand-logo:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
}

.brand-text {
  transition: all 0.3s ease;
}

.brand-text h2 {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  transition: all 0.3s ease;
}

.brand-text:hover h2 {
  transform: scale(1.02);
}

.brand-text small {
  font-size: 0.8rem;
  font-weight: 500;
  color: #6b7280;
  transition: color 0.3s ease;
}

.brand-text:hover small {
  color: #9ca3af;
}

/* 네비게이션 스타일 */
.navbar-nav .nav-link {
  color: #374151;
  font-weight: 600;
  padding: 0.75rem 1.25rem;
  border-radius: 16px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  margin: 0 0.375rem;
  background: rgba(255, 255, 255, 0.8);
  border: 1px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
}

.navbar-nav .nav-link::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: -1;
}

.navbar-nav .nav-link:hover::before,
.navbar-nav .nav-link.active::before {
  left: 0;
}

.navbar-nav .nav-link:hover {
  color: white;
  background-color: transparent;
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
  border-color: transparent;
}

.navbar-nav .nav-link.active {
  color: white;
  background-color: transparent;
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.25);
}

 /* 하위 메뉴 active 상태 스타일 */
 .dropdown-item.active {
   color: #667eea !important;
   background-color: rgba(102, 126, 234, 0.1) !important;
   font-weight: 600;
 }

/* 드롭다운 스타일 */
.dropdown-menu {
  border: none;
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
  border-radius: 20px;
  padding: 0.75rem 0;
  min-width: 240px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  display: none; /* 기본적으로 숨김 */
  position: absolute;
  z-index: 9999; /* 높은 z-index로 다른 요소 위에 표시 */
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  margin-top: 0.75rem;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  opacity: 0;
  transform: translateY(-15px) scale(0.95);
  overflow: hidden;
}

.dropdown-menu.show {
  display: block !important; /* show 클래스가 있을 때 강제로 표시 */
  opacity: 1 !important;
  visibility: visible !important;
  transform: translateY(0) scale(1) !important;
}

/* 드롭다운 토글 버튼 스타일 */
.dropdown-toggle::after {
  display: inline-block;
  margin-left: 0.255em;
  vertical-align: 0.255em;
  content: "";
  border-top: 0.3em solid;
  border-right: 0.3em solid transparent;
  border-bottom: 0;
  border-left: 0.3em solid transparent;
  transition: transform 0.15s ease-in-out;
}

/* 드롭다운이 열렸을 때 화살표 회전 */
.dropdown.show .dropdown-toggle::after {
  transform: rotate(180deg);
}

/* 드롭다운 아이템 스타일 */
.dropdown-item {
  padding: 1rem 1.5rem;
  color: #374151;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 0;
  display: block;
  text-decoration: none;
  white-space: nowrap;
  position: relative;
  font-weight: 500;
  border-left: 4px solid transparent;
  margin: 0 0.5rem;
  border-radius: 0 12px 12px 0;
}

.dropdown-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: -1;
  border-radius: 0 12px 12px 0;
}

.dropdown-item:hover::before,
.dropdown-item.active::before {
  left: 0;
}

.dropdown-item:hover {
  background-color: transparent;
  color: white;
  transform: translateX(8px);
  border-left-color: rgba(255, 255, 255, 0.6);
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
}

.dropdown-item:active {
  background-color: transparent;
  color: white;
  transform: translateX(6px) scale(0.98);
}

/* 드롭다운 헤더 스타일 */
.dropdown-header {
  color: #6b7280;
  font-weight: 700;
  font-size: 0.875rem;
  padding: 1rem 1.5rem 0.75rem 1.5rem;
  margin-bottom: 0.5rem;
  border-bottom: 2px solid rgba(102, 126, 234, 0.1);
  text-transform: uppercase;
  letter-spacing: 1px;
  background: linear-gradient(135deg, #f8fafc 0%, #e2eafc 100%);
  margin: 0 0.5rem 0.5rem 0.5rem;
  border-radius: 12px 12px 0 0;
  position: relative;
}

.dropdown-header::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 100%;
  height: 2px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 1px;
}

/* 사용자 정보 스타일 */
.user-info {
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  padding: 1rem 1.25rem;
  border-radius: 16px;
  border: 1px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.user-info:hover {
  background: rgba(255, 255, 255, 0.95);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
  border-color: rgba(102, 126, 234, 0.2);
}

/* 버튼 스타일 */
.btn {
  border-radius: 16px;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  border: 1px solid transparent;
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: -1;
}

.btn:hover::before {
  left: 0;
}

.btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
  border-color: transparent;
}

.btn:active {
  transform: translateY(-1px) scale(0.98);
}

.btn-sm {
  padding: 0.75rem 1.25rem;
  font-size: 0.9rem;
  border-radius: 12px;
}

/* 햄버거 메뉴 스타일 */
.navbar-toggler {
  border: none;
  padding: 0.5rem;
  border-radius: 8px;
  transition: all 0.2s ease;
}

.navbar-toggler:focus {
  box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
  outline: none;
}

.navbar-toggler:hover {
  background-color: rgba(102, 126, 234, 0.1);
}

.navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(102, 126, 234, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
}

/* 반응형 디자인 */
@media (max-width: 991.98px) {
  /* 모바일에서 네비게이션 메뉴 스타일 */
  .navbar-collapse {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    padding: 1.5rem;
    border-radius: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
    margin-top: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
    position: absolute;
    top: 100%;
    left: 0.5rem;
    right: 0.5rem;
    z-index: 1000;
    transform: translateY(-10px);
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .navbar-collapse.show {
    transform: translateY(0);
    opacity: 1;
    visibility: visible;
  }
  
  .navbar-nav {
    gap: 0.75rem;
  }
  
  .navbar-nav .nav-link {
    margin: 0;
    padding: 1rem 1.25rem;
    border-radius: 16px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 0.95rem;
    font-weight: 500;
    color: #374151;
    background: rgba(255, 255, 255, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.3);
    position: relative;
    overflow: hidden;
  }
  
  .navbar-nav .nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: -1;
  }
  
  .navbar-nav .nav-link:hover::before,
  .navbar-nav .nav-link.active::before {
    left: 0;
  }
  
  .navbar-nav .nav-link:hover,
  .navbar-nav .nav-link.active {
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    border-color: transparent;
  }
  
  /* 모바일에서 드롭다운 메뉴 스타일 */
  .dropdown-menu {
    position: static !important;
    float: none;
    width: 100%;
    margin-top: 0.75rem;
    border: none;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    overflow: hidden;
  }
  
  .dropdown-item {
    padding: 1rem 1.25rem;
    border-radius: 0;
    font-size: 0.9rem;
    color: #4b5563;
    font-weight: 500;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    border-left: 3px solid transparent;
  }
  
  .dropdown-item:hover {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    transform: translateX(8px);
    border-left-color: rgba(255, 255, 255, 0.5);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
  }
  
  .dropdown-header {
    color: #6b7280;
    font-weight: 600;
    font-size: 0.875rem;
    padding: 1rem 1.25rem 0.5rem 1.25rem;
    margin-bottom: 0.5rem;
    border-bottom: 1px solid rgba(107, 114, 128, 0.1);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  /* 모바일에서 사용자 액션 버튼들 */
  .user-actions {
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .brand-text h2 {
    font-size: 1.5rem;
  }
  
  .brand-text small {
    display: none;
  }
  
  /* 모바일에서 햄버거 메뉴 버튼 위치 조정 */
  .navbar-toggler {
    order: 0;
    margin-right: 0.75rem;
    padding: 0.75rem;
    border-radius: 16px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }
  
  .navbar-toggler::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: -1;
  }
  
  .navbar-toggler:hover::before {
    left: 0;
  }
  
  .navbar-toggler:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
  }
  
  .navbar-toggler:focus {
    box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
  }
  
  .navbar-toggler-icon {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='white' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    transition: all 0.3s ease;
  }
  
  /* 모바일에서 네비게이션 컨테이너 스타일 */
  .navbar {
    width: 100%;
  }
  
  /* 모바일에서 메뉴 아이템 간격 조정 */
  .navbar-nav .nav-item {
    margin-bottom: 0.75rem;
  }
  
  /* 모바일에서 드롭다운 토글 화살표 숨김 */
  .dropdown-toggle::after {
    display: none;
  }
  
  /* 모바일에서 메뉴 열림/닫힘 애니메이션 */
  .navbar-collapse {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .navbar-collapse.collapsing {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* 모바일에서 브랜드 로고 중앙 정렬 */
  .brand-text {
    text-align: center;
  }
  
  /* 모바일에서 사용자 액션 버튼 최적화 */
  .btn-sm {
    padding: 0.75rem 1rem;
    font-size: 0.85rem;
    border-radius: 12px;
    font-weight: 500;
  }
  
  /* 모바일에서 드롭다운 토글 스타일 */
  .dropdown-toggle {
    position: relative;
  }
  
  .dropdown-toggle::before {
    content: '';
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid #9ca3af;
    transition: transform 0.3s ease;
  }
  
  .dropdown.show .dropdown-toggle::before {
    transform: translateY(-50%) rotate(180deg);
  }
  
  /* 모바일에서 메뉴 아이템 호버 효과 */
  .navbar-nav .nav-link:active {
    transform: translateY(0) scale(0.98);
  }
  
  .dropdown-item:active {
    transform: translateX(4px) scale(0.98);
  }
  
  /* 모바일에서 스크롤바 스타일 */
  .navbar-collapse::-webkit-scrollbar {
    width: 4px;
  }
  
  .navbar-collapse::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
  }
  
  .navbar-collapse::-webkit-scrollbar-thumb {
    background: rgba(102, 126, 234, 0.3);
    border-radius: 2px;
  }
  
  .navbar-collapse::-webkit-scrollbar-thumb:hover {
    background: rgba(102, 126, 234, 0.5);
  }
}

/* 데스크탑에서는 햄버거 메뉴 숨김 */
@media (min-width: 992px) {
  .navbar-toggler {
    display: none !important;
  }
  
  .navbar-collapse {
    display: flex !important;
  }
}

@media (max-width: 575.98px) {
  .container-fluid {
    padding: 1rem;
  }
  
  .brand-logo {
    padding: 0.75rem;
    border-radius: 16px;
  }
  
  .brand-logo i {
    font-size: 1.5rem;
  }
  
  .brand-text h2 {
    font-size: 1.25rem;
  }
  
  /* 작은 화면에서 메뉴 최적화 */
  .navbar-collapse {
    left: 0.25rem;
    right: 0.25rem;
    padding: 1.25rem;
    border-radius: 16px;
  }
  
  .navbar-nav .nav-link {
    padding: 0.875rem 1rem;
    font-size: 0.9rem;
  }
  
  .dropdown-item {
    padding: 0.875rem 1.25rem;
    font-size: 0.85rem;
  }
  
  .dropdown-header {
    padding: 0.875rem 1.25rem 0.625rem 1.25rem;
    font-size: 0.8rem;
  }
  
  .navbar-toggler {
    padding: 0.625rem;
    border-radius: 12px;
  }
}

/* 토스트 컨테이너 스타일 */
.toast-container {
  z-index: 9999;
}

.toast {
  min-width: 300px;
  border: none;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.toast.bg-info {
  background-color: #17a2b8 !important;
}

.toast.bg-success {
  background-color: #28a745 !important;
}

.toast.bg-danger {
  background-color: #dc3545 !important;
}

.toast-body {
  padding: 1rem;
  font-weight: 500;
}
</style> 