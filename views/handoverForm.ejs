<%- include('header') %>

<style>
        
    .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
        }
        
        .title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .form-section {
            margin-bottom: 25px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .section-header {
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
            font-size: 14px;
        }
        
        .section-content {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
        
        .form-control.small {
            max-width: 150px;
        }
        
        .form-control.medium {
            max-width: 200px;
        }
        
        .handover-items {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            background-color: #f8f9fa;
        }
        
        .handover-item {
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: white;
        }
        
        .handover-item:last-child {
            margin-bottom: 0;
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .item-title {
            font-weight: bold;
            color: #333;
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            margin-right: 6px;
            min-width: auto;
            width: auto;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .add-btn {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 25px;
            margin-bottom: 25px;
            transition: background-color 0.3s ease;
        }
        
        .add-btn:hover {
            background-color: #138496;
        }
        
        .remove-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>

<div class="container mt-4">
        <!-- í—¤ë” -->
        <div class="header">
            <div class="title"><%= handover ? 'ì¼ì¼ì—…ë¬´ ì¸ê³„ì¥ ìˆ˜ì •' : 'ì¼ì¼ì—…ë¬´ ì¸ê³„ì¥ ì‘ì„±' %></div>
        </div>

        <form method="POST" action="<%= handover ? `/handovers/${handover._id}` : '/handovers' %>" id="handoverForm">
            <% if (handover) { %>
                <input type="hidden" name="_method" value="PUT">
            <% } %>

            <!-- ê¸°ë³¸ ì •ë³´ -->
            <div class="form-section">
                <div class="section-header">â–¡ ê¸°ë³¸ ì •ë³´</div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ì¸ê³„ì¥ ë‚ ì§œ</label>
                            <input type="date" name="handoverDate" class="form-control medium" 
                                   value="<%= handover ? handover.handoverDate.toISOString().split('T')[0] : new Date().toISOString().split('T')[0] %>" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ë¶€ì„œ</label>
                            <select name="department" class="form-control medium" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ë³´ì•ˆ1íŒ€" <%= handover && handover.department === 'ë³´ì•ˆ1íŒ€' ? 'selected' : '' %>>ë³´ì•ˆ1íŒ€</option>
                                <option value="ë³´ì•ˆ2íŒ€" <%= handover && handover.department === 'ë³´ì•ˆ2íŒ€' ? 'selected' : '' %>>ë³´ì•ˆ2íŒ€</option>
                                <option value="ë³´ì•ˆ3íŒ€" <%= handover && handover.department === 'ë³´ì•ˆ3íŒ€' ? 'selected' : '' %>>ë³´ì•ˆ3íŒ€</option>
                                <option value="ì „ì²´" <%= handover && handover.department === 'ì „ì²´' ? 'selected' : (!handover ? 'selected' : '') %>>ì „ì²´</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì¸ê³„ì‚¬í•­ -->
            <div class="form-section">
                <div class="section-header">â–¡ ì¸ê³„ì‚¬í•­</div>
                <div class="section-content">
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label class="form-label">ì¸ê³„ ìœ í˜•</label>
                        <div style="display: flex; gap: 20px; margin-top: 5px;">
                            <label style="display: flex; align-items: center; font-weight: normal;">
                                <input type="radio" name="handoverType" value="work" checked style="margin-right: 5px;">
                                ì‘ì—… ì¸ê³„
                            </label>
                            <label style="display: flex; align-items: center; font-weight: normal;">
                                <input type="radio" name="handoverType" value="security" style="margin-right: 5px;">
                                ë³´ì•ˆì—…ë¬´ ì¸ê³„
                            </label>
                        </div>
                    </div>
                    <div class="handover-items" id="handoverItems">
                        <!-- ê¸°ì¡´ ì¸ê³„ì‚¬í•­ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
                    </div>
                    <button type="button" class="add-btn" onclick="addHandoverItem()">
                        <i class="fa-solid fa-plus me-1"></i>ì¸ê³„ì‚¬í•­ ì¶”ê°€
                    </button>
                </div>
            </div>

            <!-- ë¦¬ë‹¤ì´ë ‰íŠ¸ ì˜µì…˜ -->
            <div class="form-group" style="margin-top: 20px;">
                <div class="checkbox-group">
                    <input type="checkbox" id="redirectToList" name="redirectToList" value="true">
                    <label for="redirectToList">ì €ì¥ í›„ ëª©ë¡ìœ¼ë¡œ ì´ë™</label>
                </div>
            </div>

            <!-- ë²„íŠ¼ ê·¸ë£¹ -->
            <div class="btn-group" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                <a href="/handovers" class="btn btn-secondary" style="padding: 10px 20px; text-decoration: none;">
                    <i class="fa-solid fa-list me-1"></i>ëª©ë¡
                </a>
                <a href="/handovers" class="btn btn-outline-secondary" style="padding: 10px 20px; text-decoration: none; border: 1px solid #6c757d; color: #6c757d; background: white;">
                    <i class="fa-solid fa-times me-1"></i>ì·¨ì†Œ
                </a>
                <button type="submit" class="btn btn-primary" style="padding: 10px 20px;">
                    <i class="fa-solid fa-save me-1"></i><%= handover ? 'ìˆ˜ì •' : 'ì €ì¥' %>
                </button>
            </div>
        </form>
    </div>

    <script>
        // ì„œë²„ì—ì„œ ì „ë‹¬ëœ ê¸°ì¡´ ì¸ê³„ì‚¬í•­ ë°ì´í„°
        const existingHandoverItems = <%- JSON.stringify(handover && handover.handoverItems ? handover.handoverItems : []) %>;
        console.log('ê¸°ì¡´ ì¸ê³„ì‚¬í•­ ë°ì´í„°:', existingHandoverItems);
        
        let itemIndex = <%= handover && handover.handoverItems ? handover.handoverItems.length : 0 %>;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ì¸ê³„ì‚¬í•­ ì¶”ê°€ (ìƒˆ ì¸ê³„ì¥ ì‘ì„± ì‹œì—ë§Œ)
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('handoverItems');
            const isNewHandover = <%= handover ? 'false' : 'true' %>;
            
            console.log('í˜ì´ì§€ ë¡œë“œ - ìƒˆ ì¸ê³„ì¥:', isNewHandover);
            console.log('ì»¨í…Œì´ë„ˆ ìì‹ ê°œìˆ˜:', container.children.length);
            
            // ê¸°ì¡´ ì¸ê³„ì‚¬í•­ì´ ìˆìœ¼ë©´ ë™ì ìœ¼ë¡œ ìƒì„±
            if (existingHandoverItems && existingHandoverItems.length > 0) {
                console.log('ê¸°ì¡´ ì¸ê³„ì‚¬í•­ ë™ì  ìƒì„± ì¤‘...');
                existingHandoverItems.forEach((item, index) => {
                    addHandoverItem(item, index);
                });
            } else if (isNewHandover && container.children.length === 0) {
                console.log('ê¸°ë³¸ ì¸ê³„ì‚¬í•­ ì¶”ê°€ ì¤‘...');
                addHandoverItem();
            }
            
            // ì¸ê³„ ìœ í˜• ë³€ê²½ ì‹œ ì„¹ì…˜ ë™ì  ë³€ê²½ ì²˜ë¦¬
            const handoverTypeRadios = document.querySelectorAll('input[name="handoverType"]');
            handoverTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    updateHandoverSection(this.value);
                });
            });
            
            // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ì„ íƒëœ ì¸ê³„ ìœ í˜•ì— ë”°ë¼ ì„¹ì…˜ ì—…ë°ì´íŠ¸
            const checkedRadio = document.querySelector('input[name="handoverType"]:checked');
            if (checkedRadio) {
                updateHandoverSection(checkedRadio.value);
            }
        });
        
        // ì¸ê³„ ìœ í˜•ì— ë”°ë¼ ì„¹ì…˜ ë™ì  ë³€ê²½
        function updateHandoverSection(handoverType) {
            console.log('ì„¹ì…˜ ë³€ê²½ ì‹œì‘:', handoverType);
            const sectionHeader = document.querySelector('.section-header');
            const addButton = document.querySelector('.add-btn');
            const container = document.getElementById('handoverItems');
            
            if (handoverType === 'security') {
                console.log('ë³´ì•ˆì—…ë¬´ ì¸ê³„ì‚¬í•­ìœ¼ë¡œ ë³€ê²½');
                // ë³´ì•ˆì—…ë¬´ ì¸ê³„ì‚¬í•­ìœ¼ë¡œ ë³€ê²½
                sectionHeader.textContent = 'â–¡ ë³´ì•ˆì—…ë¬´ ì¸ê³„ì‚¬í•­';
                addButton.innerHTML = '<i class="fa-solid fa-plus me-1"></i>ì¸ê³„ì‚¬í•­ ì¶”ê°€';
                
                // ê¸°ì¡´ ì¸ê³„ì‚¬í•­ë“¤ì„ ëª¨ë‘ ì œê±°í•˜ê³  ìƒˆë¡œ ìƒì„±
                container.innerHTML = '';
                if (existingHandoverItems && existingHandoverItems.length > 0) {
                    console.log('ê¸°ì¡´ ì¸ê³„ì‚¬í•­ì„ ë³´ì•ˆì—…ë¬´ í˜•ì‹ìœ¼ë¡œ ìƒˆë¡œ ìƒì„±');
                    existingHandoverItems.forEach((item, index) => {
                        addHandoverItem(item, index);
                    });
                } else {
                    console.log('ìƒˆ ë³´ì•ˆì—…ë¬´ ì¸ê³„ì‚¬í•­ ì¶”ê°€');
                    addHandoverItem();
                }
            } else {
                console.log('ì‘ì—… ì¸ê³„ì‚¬í•­ìœ¼ë¡œ ë³€ê²½');
                // ì‘ì—… ì¸ê³„ì‚¬í•­ìœ¼ë¡œ ë³€ê²½
                sectionHeader.textContent = 'â–¡ ì‘ì—… ì¸ê³„ì‚¬í•­';
                addButton.innerHTML = '<i class="fa-solid fa-plus me-1"></i>ì¸ê³„ì‚¬í•­ ì¶”ê°€';
                
                // ê¸°ì¡´ ì¸ê³„ì‚¬í•­ë“¤ì„ ëª¨ë‘ ì œê±°í•˜ê³  ìƒˆë¡œ ìƒì„±
                container.innerHTML = '';
                if (existingHandoverItems && existingHandoverItems.length > 0) {
                    console.log('ê¸°ì¡´ ì¸ê³„ì‚¬í•­ì„ ì‘ì—… í˜•ì‹ìœ¼ë¡œ ìƒˆë¡œ ìƒì„±');
                    existingHandoverItems.forEach((item, index) => {
                        addHandoverItem(item, index);
                    });
                } else {
                    console.log('ìƒˆ ì‘ì—… ì¸ê³„ì‚¬í•­ ì¶”ê°€');
                    addHandoverItem();
                }
            }
        }
        
        // ë³´ì•ˆì—…ë¬´ ì¸ê³„ ê°€ì´ë“œ ì¶”ê°€
        function addSecurityGuide() {
            console.log('ë³´ì•ˆì—…ë¬´ ê°€ì´ë“œ ì¶”ê°€ ì‹œë„');
            const sectionContent = document.querySelector('.section-content');
            const existingGuide = document.querySelector('.security-guide');
            
            if (!existingGuide) {
                console.log('ë³´ì•ˆì—…ë¬´ ê°€ì´ë“œ ìƒì„± ì¤‘');
                const guideDiv = document.createElement('div');
                guideDiv.className = 'security-guide';
                guideDiv.style.cssText = 'background-color: #e3f2fd; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 13px; color: #1976d2;';
                guideDiv.innerHTML = `
                    <strong>ğŸ“‹ ë³´ì•ˆì—…ë¬´ ì¸ê³„ ê°€ì´ë“œ:</strong><br>
                    â€¢ ì¶œì…í†µì œ, ìˆœì°°ì—…ë¬´, CCTVëª¨ë‹ˆí„°ë§ ë“± ë³´ì•ˆì—…ë¬´ êµ¬ë¶„ì„ ì„ íƒí•˜ì„¸ìš”<br>
                    â€¢ ê·¼ë¬´ êµ¬ì—­ê³¼ ë‹´ë‹¹ ë³´ì•ˆìš”ì›ì„ ëª…í™•íˆ ê¸°ë¡í•˜ì„¸ìš”<br>
                    â€¢ ë³´ì•ˆìƒ íŠ¹ì´ì‚¬í•­ì´ë‚˜ ì˜ì‹¬ ìƒí™©ì„ ìƒì„¸íˆ ê¸°ë¡í•˜ì„¸ìš”
                `;
                
                // ì¸ê³„ ìœ í˜• ì„ íƒ ë‹¤ìŒì— ê°€ì´ë“œ ì‚½ì…
                const handoverTypeGroup = sectionContent.querySelector('.form-group');
                handoverTypeGroup.insertAdjacentElement('afterend', guideDiv);
            } else {
                console.log('ë³´ì•ˆì—…ë¬´ ê°€ì´ë“œê°€ ì´ë¯¸ ì¡´ì¬í•¨');
            }
        }
        
        // ë³´ì•ˆì—…ë¬´ ì¸ê³„ ê°€ì´ë“œ ì œê±°
        function removeSecurityGuide() {
            console.log('ë³´ì•ˆì—…ë¬´ ê°€ì´ë“œ ì œê±° ì‹œë„');
            const existingGuide = document.querySelector('.security-guide');
            if (existingGuide) {
                console.log('ë³´ì•ˆì—…ë¬´ ê°€ì´ë“œ ì œê±°ë¨');
                existingGuide.remove();
            } else {
                console.log('ì œê±°í•  ë³´ì•ˆì—…ë¬´ ê°€ì´ë“œê°€ ì—†ìŒ');
            }
        }
        
        // ê¸°ì¡´ ì¸ê³„ì‚¬í•­ë“¤ì„ ë³´ì•ˆì—…ë¬´ í˜•ì‹ìœ¼ë¡œ ë³€ê²½
        function updateExistingItemsToSecurity() {
            console.log('ë³´ì•ˆì—…ë¬´ í˜•ì‹ìœ¼ë¡œ ë³€ê²½ ì‹œì‘');
            const items = document.querySelectorAll('.handover-item');
            console.log('ì°¾ì€ ì¸ê³„ì‚¬í•­ ê°œìˆ˜:', items.length);
            items.forEach((item, index) => {
                console.log(`ì¸ê³„ì‚¬í•­ #${index + 1} ë³´ì•ˆì—…ë¬´ í˜•ì‹ìœ¼ë¡œ ë³€ê²½ ì¤‘`);
                // ì‘ì—… êµ¬ë¶„ ë¼ë²¨ ë³€ê²½
                const taskTypeLabel = item.querySelector('label[for*="taskType"], .form-group label');
                if (taskTypeLabel) {
                    console.log('ì‘ì—… êµ¬ë¶„ ë¼ë²¨ ë³€ê²½: ì‘ì—… êµ¬ë¶„ â†’ ë³´ì•ˆì—…ë¬´ êµ¬ë¶„');
                    taskTypeLabel.textContent = 'ë³´ì•ˆì—…ë¬´ êµ¬ë¶„';
                } else {
                    console.log('ì‘ì—… êµ¬ë¶„ ë¼ë²¨ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    // ëŒ€ì•ˆ: ì²« ë²ˆì§¸ ë¼ë²¨ì„ ì°¾ì•„ì„œ ë³€ê²½
                    const firstLabel = item.querySelector('.form-group:first-child label');
                    if (firstLabel) {
                        console.log('ì²« ë²ˆì§¸ ë¼ë²¨ì„ ë³´ì•ˆì—…ë¬´ êµ¬ë¶„ìœ¼ë¡œ ë³€ê²½');
                        firstLabel.textContent = 'ë³´ì•ˆì—…ë¬´ êµ¬ë¶„';
                    }
                }
                
                // ì‘ì—… êµ¬ë¶„ ì…ë ¥ í•„ë“œë¥¼ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ë³€ê²½
                const taskTypeInput = item.querySelector('input[name*="taskType"]');
                if (taskTypeInput) {
                    console.log('ì…ë ¥ í•„ë“œë¥¼ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ë³€ê²½');
                    const selectElement = document.createElement('select');
                    selectElement.name = taskTypeInput.name;
                    selectElement.className = 'form-control';
                    selectElement.required = true;
                    selectElement.innerHTML = `
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ì¶œì…í†µì œ">ì¶œì…í†µì œ</option>
                        <option value="ìˆœì°°ì—…ë¬´">ìˆœì°°ì—…ë¬´</option>
                        <option value="CCTVëª¨ë‹ˆí„°ë§">CCTVëª¨ë‹ˆí„°ë§</option>
                        <option value="ë¹„ìƒìƒí™©ëŒ€ì‘">ë¹„ìƒìƒí™©ëŒ€ì‘</option>
                        <option value="ë³´ì•ˆì¥ë¹„ì ê²€">ë³´ì•ˆì¥ë¹„ì ê²€</option>
                        <option value="ë°©ë¬¸ìê´€ë¦¬">ë°©ë¬¸ìê´€ë¦¬</option>
                        <option value="ì°¨ëŸ‰í†µì œ">ì°¨ëŸ‰í†µì œ</option>
                        <option value="ê¸°íƒ€ë³´ì•ˆì—…ë¬´">ê¸°íƒ€ë³´ì•ˆì—…ë¬´</option>
                    `;
                    selectElement.value = taskTypeInput.value; // ê¸°ì¡´ ê°’ ìœ ì§€
                    taskTypeInput.parentNode.replaceChild(selectElement, taskTypeInput);
                } else {
                    console.log('ì‘ì—… êµ¬ë¶„ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
                // ë‹´ë‹¹ì ë¼ë²¨ ë³€ê²½ (ë‘ ë²ˆì§¸ form-groupì˜ ë¼ë²¨)
                const personnelLabels = item.querySelectorAll('.form-group label');
                if (personnelLabels.length > 1) {
                    console.log('ë‹´ë‹¹ì ë¼ë²¨ ë³€ê²½: ë‹´ë‹¹ìëª… â†’ ë‹´ë‹¹ ë³´ì•ˆìš”ì›');
                    personnelLabels[1].textContent = 'ë‹´ë‹¹ ë³´ì•ˆìš”ì›';
                    
                    // ë‹´ë‹¹ì ì…ë ¥ í•„ë“œì˜ placeholder ë³€ê²½
                    const personnelInput = personnelLabels[1].nextElementSibling;
                    if (personnelInput && personnelInput.tagName === 'INPUT') {
                        personnelInput.placeholder = 'ì˜ˆ: ê¹€ë³´ì•ˆ';
                    }
                }
                
                // ì¥ì†Œ ë¼ë²¨ ë³€ê²½ (ë„¤ ë²ˆì§¸ form-groupì˜ ë¼ë²¨)
                if (personnelLabels.length > 3) {
                    console.log('ì¥ì†Œ ë¼ë²¨ ë³€ê²½: ì‘ì—… ì¥ì†Œ â†’ ê·¼ë¬´ êµ¬ì—­');
                    personnelLabels[3].textContent = 'ê·¼ë¬´ êµ¬ì—­';
                    
                    // ì¥ì†Œ ì…ë ¥ í•„ë“œì˜ placeholder ë³€ê²½
                    const locationInput = personnelLabels[3].nextElementSibling;
                    if (locationInput && locationInput.tagName === 'INPUT') {
                        locationInput.placeholder = 'ì˜ˆ: ì •ë¬¸ ì¶œì…í†µì œì‹¤, ì£¼ì°¨ì¥ ìˆœì°°êµ¬ì—­, CCTV ëª¨ë‹ˆí„°ë§ì‹¤';
                    }
                }
                
                // ë‚´ìš© ë¼ë²¨ ë³€ê²½ (ë‹¤ì„¯ ë²ˆì§¸ form-groupì˜ ë¼ë²¨)
                if (personnelLabels.length > 4) {
                    console.log('ë‚´ìš© ë¼ë²¨ ë³€ê²½: ì‘ì—… ë‚´ìš© â†’ ë³´ì•ˆì—…ë¬´ ë‚´ìš©');
                    personnelLabels[4].textContent = 'ë³´ì•ˆì—…ë¬´ ë‚´ìš©';
                    
                    // ë‚´ìš© ì…ë ¥ í•„ë“œì˜ placeholder ë³€ê²½
                    const contentInput = personnelLabels[4].nextElementSibling;
                    if (contentInput && contentInput.tagName === 'TEXTAREA') {
                        contentInput.placeholder = 'ì˜ˆ: ì¶œì…ì ì‹ ë¶„í™•ì¸, ì°¨ëŸ‰ë²ˆí˜¸ ë“±ë¡, ìˆœì°°ê²½ë¡œ ì ê²€, CCTV ëª¨ë‹ˆí„°ë§, ë¹„ìƒìƒí™© ëŒ€ì‘ì ˆì°¨';
                    }
                }
                
                // íŠ¹ì´ì‚¬í•­ ë¼ë²¨ ë³€ê²½ (ì—¬ì„¯ ë²ˆì§¸ form-groupì˜ ë¼ë²¨)
                if (personnelLabels.length > 5) {
                    console.log('íŠ¹ì´ì‚¬í•­ ë¼ë²¨ ë³€ê²½: ì¶”ê°€ ì •ë³´ â†’ ë³´ì•ˆìƒ íŠ¹ì´ì‚¬í•­');
                    personnelLabels[5].textContent = 'ë³´ì•ˆìƒ íŠ¹ì´ì‚¬í•­';
                    
                    // íŠ¹ì´ì‚¬í•­ ì…ë ¥ í•„ë“œì˜ placeholder ë³€ê²½
                    const additionalInput = personnelLabels[5].nextElementSibling;
                    if (additionalInput && additionalInput.tagName === 'TEXTAREA') {
                        additionalInput.placeholder = 'ì˜ˆ: ì˜ì‹¬ì¸ë¬¼ ì¶œí˜„, ë³´ì•ˆì¥ë¹„ ì´ìƒ, íŠ¹ë³„ì§€ì‹œì‚¬í•­, ë¹„ìƒì—°ë½ì²˜ ë“±';
                    }
                }
                
                // ë‚ ì§œ ë¼ë²¨ ë³€ê²½ (ì„¸ ë²ˆì§¸ form-groupì˜ ë¼ë²¨)
                if (personnelLabels.length > 2) {
                    console.log('ë‚ ì§œ ë¼ë²¨ ë³€ê²½: ì‘ì—… ë‚ ì§œ â†’ ê·¼ë¬´ ë‚ ì§œ');
                    personnelLabels[2].textContent = 'ê·¼ë¬´ ë‚ ì§œ';
                    
                    // ë‚ ì§œ ì…ë ¥ í•„ë“œì˜ placeholder ë³€ê²½
                    const dateInput = personnelLabels[2].nextElementSibling;
                    if (dateInput && dateInput.tagName === 'INPUT') {
                        dateInput.placeholder = 'ì˜ˆ: 9ì›” 22ì¼';
                    }
                }
                
                // ë‚ ì§œ placeholder ë³€ê²½
                const dateInput = item.querySelector('input[name*="dateTime.date"]');
                if (dateInput) {
                    console.log('ë‚ ì§œ placeholder ë³€ê²½: 8/29(ê¸ˆ) â†’ 9ì›” 22ì¼');
                    dateInput.placeholder = 'ì˜ˆ: 9ì›” 22ì¼';
                }
            });
        }
        
        // ê¸°ì¡´ ì¸ê³„ì‚¬í•­ë“¤ì„ ì‘ì—… í˜•ì‹ìœ¼ë¡œ ë³€ê²½
        function updateExistingItemsToWork() {
            console.log('ì‘ì—… í˜•ì‹ìœ¼ë¡œ ë³€ê²½ ì‹œì‘');
            const items = document.querySelectorAll('.handover-item');
            console.log('ì°¾ì€ ì¸ê³„ì‚¬í•­ ê°œìˆ˜:', items.length);
            items.forEach((item, index) => {
                console.log(`ì¸ê³„ì‚¬í•­ #${index + 1} ì‘ì—… í˜•ì‹ìœ¼ë¡œ ë³€ê²½ ì¤‘`);
                // ì‘ì—… êµ¬ë¶„ ë¼ë²¨ ë³€ê²½
                const taskTypeLabel = item.querySelector('label[for*="taskType"], .form-group label');
                if (taskTypeLabel) {
                    console.log('ì‘ì—… êµ¬ë¶„ ë¼ë²¨ ë³€ê²½: ë³´ì•ˆì—…ë¬´ êµ¬ë¶„ â†’ ì‘ì—… êµ¬ë¶„');
                    taskTypeLabel.textContent = 'ì‘ì—… êµ¬ë¶„';
                } else {
                    // ëŒ€ì•ˆ: ì²« ë²ˆì§¸ ë¼ë²¨ì„ ì°¾ì•„ì„œ ë³€ê²½
                    const firstLabel = item.querySelector('.form-group:first-child label');
                    if (firstLabel) {
                        console.log('ì²« ë²ˆì§¸ ë¼ë²¨ì„ ì‘ì—… êµ¬ë¶„ìœ¼ë¡œ ë³€ê²½');
                        firstLabel.textContent = 'ì‘ì—… êµ¬ë¶„';
                    }
                }
                
                // ì‘ì—… êµ¬ë¶„ ë“œë¡­ë‹¤ìš´ì„ ì…ë ¥ í•„ë“œë¡œ ë³€ê²½
                const taskTypeSelect = item.querySelector('select[name*="taskType"]');
                if (taskTypeSelect) {
                    console.log('ë“œë¡­ë‹¤ìš´ì„ ì…ë ¥ í•„ë“œë¡œ ë³€ê²½');
                    const inputElement = document.createElement('input');
                    inputElement.type = 'text';
                    inputElement.name = taskTypeSelect.name;
                    inputElement.className = 'form-control';
                    inputElement.required = true;
                    inputElement.placeholder = 'ì˜ˆ: LED ì˜¥ì™¸ ì „ê´‘íŒ, ê°€ë“œë ˆì¼ ì‘ì—…';
                    inputElement.value = taskTypeSelect.value; // ê¸°ì¡´ ê°’ ìœ ì§€
                    taskTypeSelect.parentNode.replaceChild(inputElement, taskTypeSelect);
                } else {
                    console.log('ì‘ì—… êµ¬ë¶„ ë“œë¡­ë‹¤ìš´ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
                // ë‹´ë‹¹ì ë¼ë²¨ ë³€ê²½ (ë‘ ë²ˆì§¸ form-groupì˜ ë¼ë²¨)
                const personnelLabels = item.querySelectorAll('.form-group label');
                if (personnelLabels.length > 1) {
                    console.log('ë‹´ë‹¹ì ë¼ë²¨ ë³€ê²½: ë‹´ë‹¹ ë³´ì•ˆìš”ì› â†’ ë‹´ë‹¹ìëª…');
                    personnelLabels[1].textContent = 'ë‹´ë‹¹ìëª…';
                    
                    // ë‹´ë‹¹ì ì…ë ¥ í•„ë“œì˜ placeholder ë³€ê²½
                    const personnelInput = personnelLabels[1].nextElementSibling;
                    if (personnelInput && personnelInput.tagName === 'INPUT') {
                        personnelInput.placeholder = 'ì˜ˆ: ì„±í¬ì¤€';
                    }
                }
                
                // ì¥ì†Œ ë¼ë²¨ ë³€ê²½ (ë„¤ ë²ˆì§¸ form-groupì˜ ë¼ë²¨)
                if (personnelLabels.length > 3) {
                    console.log('ì¥ì†Œ ë¼ë²¨ ë³€ê²½: ê·¼ë¬´ êµ¬ì—­ â†’ ì‘ì—… ì¥ì†Œ');
                    personnelLabels[3].textContent = 'ì‘ì—… ì¥ì†Œ';
                    
                    // ì¥ì†Œ ì…ë ¥ í•„ë“œì˜ placeholder ë³€ê²½
                    const locationInput = personnelLabels[3].nextElementSibling;
                    if (locationInput && locationInput.tagName === 'INPUT') {
                        locationInput.placeholder = 'ì˜ˆ: ì•„ì‚°ë¡œ ì†Œê³µì› ë‚´';
                    }
                }
                
                // ë‚´ìš© ë¼ë²¨ ë³€ê²½ (ë‹¤ì„¯ ë²ˆì§¸ form-groupì˜ ë¼ë²¨)
                if (personnelLabels.length > 4) {
                    console.log('ë‚´ìš© ë¼ë²¨ ë³€ê²½: ë³´ì•ˆì—…ë¬´ ë‚´ìš© â†’ ì‘ì—… ë‚´ìš©');
                    personnelLabels[4].textContent = 'ì‘ì—… ë‚´ìš©';
                    
                    // ë‚´ìš© ì…ë ¥ í•„ë“œì˜ placeholder ë³€ê²½
                    const contentInput = personnelLabels[4].nextElementSibling;
                    if (contentInput && contentInput.tagName === 'TEXTAREA') {
                        contentInput.placeholder = 'ì˜ˆ: ì˜¥ì™¸ ì „ê´‘íŒ LMDíŒ¨ë„ ë° ê°€ë“œë ˆì¼ 1EA ë³´ìˆ˜ ì‘ì—…';
                    }
                }
                
                // íŠ¹ì´ì‚¬í•­ ë¼ë²¨ ë³€ê²½ (ì—¬ì„¯ ë²ˆì§¸ form-groupì˜ ë¼ë²¨)
                if (personnelLabels.length > 5) {
                    console.log('íŠ¹ì´ì‚¬í•­ ë¼ë²¨ ë³€ê²½: ë³´ì•ˆìƒ íŠ¹ì´ì‚¬í•­ â†’ ì¶”ê°€ ì •ë³´');
                    personnelLabels[5].textContent = 'ì¶”ê°€ ì •ë³´';
                    
                    // íŠ¹ì´ì‚¬í•­ ì…ë ¥ í•„ë“œì˜ placeholder ë³€ê²½
                    const additionalInput = personnelLabels[5].nextElementSibling;
                    if (additionalInput && additionalInput.tagName === 'TEXTAREA') {
                        additionalInput.placeholder = 'ì˜ˆ: ìƒê¸°ì¸ì€ ì™¸ë¶€ì¸ìœ¼ë¡œ ìš¸ì‚°ì‹œ ê±´ì„¤ë³¸ë¶€ ë°œì£¼ ë‚´ìš©';
                    }
                }
                
                // ë‚ ì§œ ë¼ë²¨ ë³€ê²½ (ì„¸ ë²ˆì§¸ form-groupì˜ ë¼ë²¨)
                if (personnelLabels.length > 2) {
                    console.log('ë‚ ì§œ ë¼ë²¨ ë³€ê²½: ê·¼ë¬´ ë‚ ì§œ â†’ ì‘ì—… ë‚ ì§œ');
                    personnelLabels[2].textContent = 'ì‘ì—… ë‚ ì§œ';
                    
                    // ë‚ ì§œ ì…ë ¥ í•„ë“œì˜ placeholder ë³€ê²½
                    const dateInput = personnelLabels[2].nextElementSibling;
                    if (dateInput && dateInput.tagName === 'INPUT') {
                        dateInput.placeholder = 'ì˜ˆ: 8/29(ê¸ˆ)';
                    }
                }
                
                // ë‚ ì§œ placeholder ë³€ê²½
                const dateInput = item.querySelector('input[name*="dateTime.date"]');
                if (dateInput) {
                    console.log('ë‚ ì§œ placeholder ë³€ê²½: 9ì›” 22ì¼ â†’ 8/29(ê¸ˆ)');
                    dateInput.placeholder = 'ì˜ˆ: 8/29(ê¸ˆ)';
                }
            });
        }
        
        // ì¸ê³„ì‚¬í•­ ì¶”ê°€
        function addHandoverItem(existingItem = null, existingIndex = null) {
            const container = document.getElementById('handoverItems');
            const selectedType = document.querySelector('input[name="handoverType"]:checked').value;
            const isSecurity = selectedType === 'security';
            
            // ê¸°ì¡´ ë°ì´í„°ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ì¸ë±ìŠ¤ ì‚¬ìš©, ì—†ìœ¼ë©´ ìƒˆ ì¸ë±ìŠ¤ ì‚¬ìš©
            const currentIndex = existingIndex !== null ? existingIndex : itemIndex;
            
            const div = document.createElement('div');
            div.className = 'handover-item';
            div.innerHTML = `
                <div class="item-header">
                    <div class="item-title">ì¸ê³„ì‚¬í•­ #${currentIndex + 1}</div>
                    <button type="button" class="remove-btn" onclick="removeHandoverItem(this)">ì‚­ì œ</button>
                </div>
                
                ${isSecurity ? `
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ë³´ì•ˆì—…ë¬´ êµ¬ë¶„</label>
                        <select name="handoverItems[${currentIndex}].taskType" class="form-control" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì¶œì…í†µì œ" ${existingItem && existingItem.taskType === 'ì¶œì…í†µì œ' ? 'selected' : ''}>ì¶œì…í†µì œ</option>
                            <option value="ìˆœì°°ì—…ë¬´" ${existingItem && existingItem.taskType === 'ìˆœì°°ì—…ë¬´' ? 'selected' : ''}>ìˆœì°°ì—…ë¬´</option>
                            <option value="CCTVëª¨ë‹ˆí„°ë§" ${existingItem && existingItem.taskType === 'CCTVëª¨ë‹ˆí„°ë§' ? 'selected' : ''}>CCTVëª¨ë‹ˆí„°ë§</option>
                            <option value="ë¹„ìƒìƒí™©ëŒ€ì‘" ${existingItem && existingItem.taskType === 'ë¹„ìƒìƒí™©ëŒ€ì‘' ? 'selected' : ''}>ë¹„ìƒìƒí™©ëŒ€ì‘</option>
                            <option value="ë³´ì•ˆì¥ë¹„ì ê²€" ${existingItem && existingItem.taskType === 'ë³´ì•ˆì¥ë¹„ì ê²€' ? 'selected' : ''}>ë³´ì•ˆì¥ë¹„ì ê²€</option>
                            <option value="ë°©ë¬¸ìê´€ë¦¬" ${existingItem && existingItem.taskType === 'ë°©ë¬¸ìê´€ë¦¬' ? 'selected' : ''}>ë°©ë¬¸ìê´€ë¦¬</option>
                            <option value="ì°¨ëŸ‰í†µì œ" ${existingItem && existingItem.taskType === 'ì°¨ëŸ‰í†µì œ' ? 'selected' : ''}>ì°¨ëŸ‰í†µì œ</option>
                            <option value="ê¸°íƒ€ë³´ì•ˆì—…ë¬´" ${existingItem && existingItem.taskType === 'ê¸°íƒ€ë³´ì•ˆì—…ë¬´' ? 'selected' : ''}>ê¸°íƒ€ë³´ì•ˆì—…ë¬´</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ê·¼ë¬´ ë‚ ì§œ</label>
                        <input type="text" name="handoverItems[${currentIndex}].taskDetails.dateTime.date" class="form-control small" 
                               value="${existingItem && existingItem.taskDetails && existingItem.taskDetails.dateTime ? (existingItem.taskDetails.dateTime.date || '') : ''}"
                               placeholder="ì˜ˆ: 9ì›” 22ì¼">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë‹´ë‹¹ íŒ€</label>
                        <select name="handoverItems[${currentIndex}].assignedTeam" class="form-control" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="1ë°˜" ${existingItem && existingItem.assignedTeam === '1ë°˜' ? 'selected' : ''}>1ë°˜</option>
                            <option value="2ë°˜" ${existingItem && existingItem.assignedTeam === '2ë°˜' ? 'selected' : ''}>2ë°˜</option>
                            <option value="3ë°˜" ${existingItem && existingItem.assignedTeam === '3ë°˜' ? 'selected' : ''}>3ë°˜</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë‹´ë‹¹ ë³´ì•ˆìš”ì›</label>
                        <input type="text" name="handoverItems[${currentIndex}].taskDetails.personnel.name" class="form-control" 
                               value="${existingItem && existingItem.taskDetails && existingItem.taskDetails.personnel ? (existingItem.taskDetails.personnel.name || '') : ''}"
                               placeholder="ì˜ˆ: ê¹€ë³´ì•ˆ">
                    </div>
                </div>
                ` : `
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ì‘ì—… êµ¬ë¶„</label>
                        <input type="text" name="handoverItems[${currentIndex}].taskType" class="form-control" 
                               value="${existingItem ? (existingItem.taskType || '') : ''}"
                               placeholder="ì˜ˆ: LED ì˜¥ì™¸ ì „ê´‘íŒ, ê°€ë“œë ˆì¼ ì‘ì—…" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë‹´ë‹¹ íŒ€</label>
                        <select name="handoverItems[${currentIndex}].assignedTeam" class="form-control" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="1ë°˜" ${existingItem && existingItem.assignedTeam === '1ë°˜' ? 'selected' : ''}>1ë°˜</option>
                            <option value="2ë°˜" ${existingItem && existingItem.assignedTeam === '2ë°˜' ? 'selected' : ''}>2ë°˜</option>
                            <option value="3ë°˜" ${existingItem && existingItem.assignedTeam === '3ë°˜' ? 'selected' : ''}>3ë°˜</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì‹œê°„ëŒ€</label>
                        <select name="handoverItems[${currentIndex}].timeCategory" class="form-control" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì£¼ê°„" ${existingItem && existingItem.timeCategory === 'ì£¼ê°„' ? 'selected' : ''}>ì£¼ê°„</option>
                            <option value="ì•¼ê°„" ${existingItem && existingItem.timeCategory === 'ì•¼ê°„' ? 'selected' : ''}>ì•¼ê°„</option>
                            <option value="ì‹¬ì•¼" ${existingItem && existingItem.timeCategory === 'ì‹¬ì•¼' ? 'selected' : ''}>ì‹¬ì•¼</option>
                        </select>
                    </div>
                </div>
                `}
                
                ${!isSecurity ? `
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ì‘ì—… ë‚ ì§œ</label>
                        <input type="text" name="handoverItems[${currentIndex}].taskDetails.dateTime.date" class="form-control small" 
                               value="${existingItem && existingItem.taskDetails && existingItem.taskDetails.dateTime ? (existingItem.taskDetails.dateTime.date || '') : ''}"
                               placeholder="ì˜ˆ: 8/29(ê¸ˆ)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì‹œì‘ ì‹œê°„</label>
                        <input type="time" name="handoverItems[${currentIndex}].taskDetails.dateTime.startTime" class="form-control small"
                               value="${existingItem && existingItem.taskDetails && existingItem.taskDetails.dateTime ? (existingItem.taskDetails.dateTime.startTime || '') : ''}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì¢…ë£Œ ì‹œê°„</label>
                        <input type="time" name="handoverItems[${currentIndex}].taskDetails.dateTime.endTime" class="form-control small"
                               value="${existingItem && existingItem.taskDetails && existingItem.taskDetails.dateTime ? (existingItem.taskDetails.dateTime.endTime || '') : ''}">
                    </div>
                </div>
                ` : ''}
                
                ${!isSecurity ? `
                <div class="form-group">
                    <label class="form-label">ë‹´ë‹¹ìëª…</label>
                    <input type="text" name="handoverItems[${currentIndex}].taskDetails.personnel.name" class="form-control" 
                           value="${existingItem && existingItem.taskDetails && existingItem.taskDetails.personnel ? (existingItem.taskDetails.personnel.name || '') : ''}"
                           placeholder="ì˜ˆ: ì„±í¬ì¤€">
                </div>
                ` : ''}
                
                ${!isSecurity ? `
                <div class="form-group">
                    <label class="form-label">ì—°ë½ì²˜</label>
                    <input type="text" name="handoverItems[${currentIndex}].taskDetails.personnel.phone" class="form-control" 
                           value="${existingItem && existingItem.taskDetails && existingItem.taskDetails.personnel ? (existingItem.taskDetails.personnel.phone || '') : ''}"
                           placeholder="ì˜ˆ: 010-1234-5678">
                </div>
                ` : ''}
                
                <div class="form-group">
                    <label class="form-label">${isSecurity ? 'ê·¼ë¬´ êµ¬ì—­' : 'ì‘ì—… ì¥ì†Œ'}</label>
                    <input type="text" name="handoverItems[${currentIndex}].taskDetails.location" class="form-control" 
                           value="${existingItem && existingItem.taskDetails ? (existingItem.taskDetails.location || '') : ''}"
                           placeholder="${isSecurity ? 'ì˜ˆ: ì •ë¬¸ ì¶œì…í†µì œì‹¤, ì£¼ì°¨ì¥ ìˆœì°°êµ¬ì—­, CCTV ëª¨ë‹ˆí„°ë§ì‹¤' : 'ì˜ˆ: ì•„ì‚°ë¡œ ì†Œê³µì› ë‚´'}">
                </div>
                
                <div class="form-group">
                    <label class="form-label">${isSecurity ? 'ë³´ì•ˆì—…ë¬´ ë‚´ìš©' : 'ì‘ì—… ë‚´ìš©'}</label>
                    <textarea name="handoverItems[${currentIndex}].taskDetails.content" class="form-control" rows="3" 
                              placeholder="${isSecurity ? 'ì˜ˆ: ì¶œì…ì ì‹ ë¶„í™•ì¸, ì°¨ëŸ‰ë²ˆí˜¸ ë“±ë¡, ìˆœì°°ê²½ë¡œ ì ê²€, CCTV ëª¨ë‹ˆí„°ë§, ë¹„ìƒìƒí™© ëŒ€ì‘ì ˆì°¨' : 'ì˜ˆ: ì˜¥ì™¸ ì „ê´‘íŒ LMDíŒ¨ë„ ë° ê°€ë“œë ˆì¼ 1EA ë³´ìˆ˜ ì‘ì—…'}">${existingItem && existingItem.taskDetails ? (existingItem.taskDetails.content || '') : ''}</textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">${isSecurity ? 'ë³´ì•ˆìƒ íŠ¹ì´ì‚¬í•­' : 'ì¶”ê°€ ì •ë³´'}</label>
                    <textarea name="handoverItems[${currentIndex}].taskDetails.additionalInfo" class="form-control" rows="2" 
                              placeholder="${isSecurity ? 'ì˜ˆ: ì˜ì‹¬ì¸ë¬¼ ì¶œí˜„, ë³´ì•ˆì¥ë¹„ ì´ìƒ, íŠ¹ë³„ì§€ì‹œì‚¬í•­, ë¹„ìƒì—°ë½ì²˜ ë“±' : 'ì˜ˆ: ìƒê¸°ì¸ì€ ì™¸ë¶€ì¸ìœ¼ë¡œ ìš¸ì‚°ì‹œ ê±´ì„¤ë³¸ë¶€ ë°œì£¼ ë‚´ìš©'}">${existingItem && existingItem.taskDetails ? (existingItem.taskDetails.additionalInfo || '') : ''}</textarea>
                </div>
                
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" name="handoverItems[${currentIndex}].reportCompleted" ${existingItem && existingItem.reportCompleted ? 'checked' : ''}>
                        <label>ë³´ê³  ì™„ë£Œ</label>
                    </div>
                </div>
            `;
            container.appendChild(div);
            
            // ìƒˆ ì¸ê³„ì‚¬í•­ì¸ ê²½ìš°ì—ë§Œ ì¸ë±ìŠ¤ ì¦ê°€
            if (existingIndex === null) {
                itemIndex++;
            }
        }
        
        // ì¸ê³„ì‚¬í•­ ì‚­ì œ
        function removeHandoverItem(button) {
            button.parentElement.parentElement.remove();
        }
        
        // í¼ ì œì¶œ ì „ ê²€ì¦ ë° ë¡œë”© ìƒíƒœ í‘œì‹œ
        document.querySelector('form').addEventListener('submit', function(e) {
            const handoverItems = document.querySelectorAll('.handover-item');
            let isValid = true;
            
            console.log('í¼ ì œì¶œ ê²€ì¦ - ì¸ê³„ì‚¬í•­ ê°œìˆ˜:', handoverItems.length);
            
            // ì¸ê³„ì‚¬í•­ì´ ì—†ëŠ” ê²½ìš°
            if (handoverItems.length === 0) {
                alert('ìµœì†Œ í•˜ë‚˜ì˜ ì¸ê³„ì‚¬í•­ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.');
                e.preventDefault();
                return false;
            }
            
            handoverItems.forEach((item, index) => {
                const taskType = item.querySelector('input[name*="taskType"]');
                const assignedTeam = item.querySelector('select[name*="assignedTeam"]');
                const timeCategory = item.querySelector('select[name*="timeCategory"]');
                
                console.log(`ì¸ê³„ì‚¬í•­ #${index + 1} ê²€ì¦:`, {
                    taskType: taskType ? taskType.value : 'ì—†ìŒ',
                    assignedTeam: assignedTeam ? assignedTeam.value : 'ì—†ìŒ',
                    timeCategory: timeCategory ? timeCategory.value : 'ì—†ìŒ'
                });
                
                if (taskType && !taskType.value.trim()) {
                    alert(`ì¸ê³„ì‚¬í•­ #${index + 1}ì˜ ì‘ì—… êµ¬ë¶„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
                    taskType.focus();
                    isValid = false;
                    return false;
                }
                
                if (assignedTeam && !assignedTeam.value) {
                    alert(`ì¸ê³„ì‚¬í•­ #${index + 1}ì˜ ë‹´ë‹¹ íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.`);
                    assignedTeam.focus();
                    isValid = false;
                    return false;
                }
                
                if (timeCategory && !timeCategory.value) {
                    alert(`ì¸ê³„ì‚¬í•­ #${index + 1}ì˜ ì‹œê°„ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.`);
                    timeCategory.focus();
                    isValid = false;
                    return false;
                }
            });
            
            if (!isValid) {
                e.preventDefault();
            } else {
                console.log('í¼ ê²€ì¦ í†µê³¼ - ì œì¶œ ì§„í–‰');
                // ë¡œë”© ìƒíƒœ í‘œì‹œ
                const submitBtn = document.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin me-1"></i>ì €ì¥ ì¤‘...';
                submitBtn.disabled = true;
                
                // 5ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì› (ì„œë²„ ì‘ë‹µì´ ëŠ¦ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„)
                setTimeout(() => {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }, 5000);
            }
        });
    </script>

<%- include('footer') %>
</body>
</html>
