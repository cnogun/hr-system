<%- include('header') %>

<body>
<style>
        /* Ìë∏ÌÑ∞Î•º Î∞îÎîîÏóêÏÑú Î∂ÑÎ¶¨ÌïòÏó¨ ÌôîÎ©¥ ÌïòÎã®Ïóê Í≥†Ï†ï */
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 0;
            font-size: 14px;
        }
        
        .flex-grow-1 {
            flex: 1;
            padding-bottom: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-section {
            margin-bottom: 15px;
            border: none;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .section-header {
            background-color: #f8f9fa;
            padding: 8px 15px;
            font-weight: bold;
            font-size: 14px;
            border-bottom: none;
        }
        
        .section-content {
            padding: 20px;
        }
        
        .form-row {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .form-group {
            margin-right: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 12px;
        }
        
        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .work-assignment-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ddd;
            font-size: 14px;
        }
        
        .work-assignment-table th,
        .work-assignment-table td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: center;
            vertical-align: middle;
            height: 20px;
        }
        
        .work-assignment-table th {
            background-color: #f0f0f0;
            font-weight: normal;
        }
        
        .work-assignment-table .region-col {
            background-color: #e9ecef;
            font-weight: bold;
            width: 15%;
        }
        
        .work-assignment-table .location-col {
            background-color: #e9ecef;
            font-weight: bold;
            text-align: center;
            width: 30%;
        }
        
        .work-assignment-table .personnel-col {
            width: 55%;
        }
        
        /* Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
                margin: 0;
                max-width: 100%;
            }
            
            .form-section {
                margin-bottom: 10px;
            }
            
            .section-header {
                padding: 8px 12px;
                font-size: 13px;
            }
            
            .section-content {
                padding: 15px;
            }
            
            .form-row {
                flex-direction: column;
                margin-bottom: 10px;
            }
            
            .form-group {
                margin-right: 0;
                margin-bottom: 10px;
                width: 100%;
            }
            
            .form-group label {
                font-size: 11px;
                margin-bottom: 3px;
            }
            
            .form-control {
                font-size: 11px;
                padding: 6px;
                width: 100%;
            }
            
            .work-assignment-table {
                font-size: 10px;
                width: 100%;
                overflow-x: auto;
                display: block;
                white-space: nowrap;
            }
            
            .work-assignment-table th,
            .work-assignment-table td {
                padding: 4px 2px;
                font-size: 10px;
                min-width: 60px;
            }
            
            .work-assignment-table .region-col {
                width: 20%;
                min-width: 50px;
            }
            
            .work-assignment-table .location-col {
                width: 30%;
                min-width: 80px;
            }
            
            .work-assignment-table .personnel-col {
                width: 50%;
                min-width: 120px;
            }
            
            .work-assignment-table input[type="text"] {
                font-size: 9px;
                padding: 2px;
                width: 100%;
                min-width: 50px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 11px;
                margin-bottom: 5px;
                width: 100%;
            }
            
            .btn-group {
                display: flex;
                flex-direction: column;
                width: 100%;
            }
            
            .btn-group .btn {
                margin-right: 0;
                margin-bottom: 5px;
            }
            
            .form-control[style*="min-width"] {
                min-width: 100% !important;
            }
            
            .table-responsive {
                border: none;
                margin-bottom: 10px;
            }
            
            .table-responsive table {
                margin-bottom: 0;
            }
            
            .alert {
                padding: 10px;
                margin-bottom: 10px;
                font-size: 11px;
            }
            
            .card {
                margin-bottom: 10px;
            }
            
            .card-header {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .card-body {
                padding: 10px;
            }
            
            h1, h2, h3, h4, h5, h6 {
                font-size: 14px;
                margin-bottom: 8px;
            }
            
            .text-muted {
                font-size: 10px;
            }
            
            .badge {
                font-size: 9px;
                padding: 3px 6px;
            }
            
            .form-check {
                margin-bottom: 8px;
            }
            
            .form-check-label {
                font-size: 10px;
            }
            
            .input-group {
                margin-bottom: 8px;
            }
            
            .input-group-text {
                font-size: 10px;
                padding: 6px 8px;
            }
            
            .dropdown-menu {
                font-size: 11px;
                min-width: 200px;
            }
            
            .modal-dialog {
                margin: 10px;
                max-width: calc(100% - 20px);
            }
            
            .modal-content {
                border-radius: 8px;
            }
            
            .modal-header {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            .modal-body {
                padding: 15px;
            }
            
            .modal-footer {
                padding: 10px 15px;
            }
            
            .modal-footer .btn {
                width: auto;
                margin: 0 2px;
            }
        }
        
        @media (max-width: 576px) {
            .container {
                padding: 5px;
            }
            
            .section-content {
                padding: 10px;
            }
            
            .form-control {
                font-size: 10px;
                padding: 4px;
            }
            
            .work-assignment-table {
                font-size: 9px;
            }
            
            .work-assignment-table th,
            .work-assignment-table td {
                padding: 2px 1px;
                font-size: 9px;
            }
            
            .work-assignment-table input[type="text"] {
                font-size: 8px;
                padding: 1px;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 10px;
            }
            
            .section-header {
                padding: 6px 10px;
                font-size: 12px;
            }
        }
        
        .work-assignment-table .personnel-col input {
            width: 80px !important;
            border: 1px solid #ddd !important;
            padding: 2px !important;
            text-align: left !important;
            font-size: 12px !important;
            display: inline-block !important;
            margin: 2px !important;
            background-color: white !important;
        }
        
        /* ÏÉàÎ°úÏö¥ Í∑ºÎ¨¥Ìé∏ÏÑ± Ï¢åÏö∞ ÎåÄÏπ≠ Ïä§ÌÉÄÏùº */
        .assignment-container {
            display: flex;
            gap: 20px;
            width: 100%;
        }
        
        .assignment-left, .assignment-right {
            flex: 1;
        }
        
        .assignment-left table, .assignment-right table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
            table-layout: fixed;
        }
        
        .assignment-left th, .assignment-right th {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            height: 20px;
        }
        
        .assignment-left td, .assignment-right td {
            border: 1px solid #dee2e6;
            padding: 4px;
            vertical-align: middle;
            height: 20px;
        }
        
        .assignment-left .region-col, .assignment-right .region-col {
            width: 15%;
            text-align: center;
            font-weight: bold;
            background-color: #e9ecef;
        }
        
        .assignment-left .location-col, .assignment-right .location-col {
            width: 30%;
            text-align: center;
            vertical-align: middle;
            font-weight: bold;
            background-color: #f8f9fa;
        }
        
        .assignment-left .personnel-col, .assignment-right .personnel-col {
            width: 55%;
            text-align: left;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
    </style>

<div class="flex-grow-1">
    <div class="container">
        <!-- Ï†úÎ™©Í≥º Î≤ÑÌäº -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="mb-0">Í∑ºÎ¨¥Î™ÖÎ†πÏÑú ÏàòÏ†ï</h1>
            <div class="btn-group">
                <a href="/work-orders" class="btn btn-secondary">Î™©Î°ù</a>
                <button type="submit" form="workOrderForm" class="btn btn-primary">Ï†ÄÏû•</button>
                <a href="/work-orders/<%= workOrder._id %>" class="btn btn-success">Î≥¥Í∏∞</a>
                <button type="button" class="btn btn-warning" onclick="history.back()">Ï∑®ÏÜå</button>
            </div>
        </div>
        
        <form id="workOrderForm" action="/work-orders/<%= workOrder._id %>" method="POST">
            <input type="hidden" name="_method" value="PUT">
            <!-- Ïò§ÎäòÏùò Í∑ºÎ¨¥ ÌòïÌÉú -->
            <div class="form-section">
                <div class="section-header">‚ñ° Ïò§ÎäòÏùò Í∑ºÎ¨¥ ÌòïÌÉú</div>
                <div class="section-content">
                    <div class="row" id="todayScheduleContainer">
                        <!-- JavaScriptÎ°ú ÎèôÏ†Å ÏÉùÏÑ± -->
                    </div>
                </div>
            </div>

            <!-- Í∑ºÎ¨¥ Ï†ïÎ≥¥ -->
            <div class="form-section">
                <div class="section-header">‚ñ° Í∑ºÎ¨¥ Ï†ïÎ≥¥ (ÏàòÏ†ï)</div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Í∑ºÎ¨¥ ÎÇ†Ïßú</label>
                            <input type="date" name="workInfo[date]" class="form-control" id="workDate" 
                                   value="<%= workOrder.workInfo && workOrder.workInfo.date ? workOrder.workInfo.date.toISOString().split('T')[0] : '' %>" required>
                        </div>
                        <div class="form-group">
                            <label>Í∑ºÎ¨¥Î∞ò</label>
                            <select name="workInfo[team]" class="form-control" id="workTeam" required>
                                <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                                <option value="Î≥¥Ïïà1Î∞ò" <%= workOrder.workInfo && workOrder.workInfo.team === 'Î≥¥Ïïà1Î∞ò' ? 'selected' : '' %>>Î≥¥Ïïà1Î∞ò</option>
                                <option value="Î≥¥Ïïà2Î∞ò" <%= workOrder.workInfo && workOrder.workInfo.team === 'Î≥¥Ïïà2Î∞ò' ? 'selected' : '' %>>Î≥¥Ïïà2Î∞ò</option>
                                <option value="Î≥¥Ïïà3Î∞ò" <%= workOrder.workInfo && workOrder.workInfo.team === 'Î≥¥Ïïà3Î∞ò' ? 'selected' : '' %>>Î≥¥Ïïà3Î∞ò</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 2; min-width: 450px;">
                            <label>Í∑ºÎ¨¥ÏãúÍ∞Ñ</label>
                            <input type="text" name="workInfo[workTime.display]" class="form-control" id="workTime" 
                                   value="<%= workOrder.workInfo && workOrder.workInfo.workTime && workOrder.workInfo.workTime.display ? workOrder.workInfo.workTime.display : '' %>"
                                   placeholder="Í∑ºÎ¨¥Î∞òÏùÑ ÏÑ†ÌÉùÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú ÏûÖÎ†•Îê©ÎãàÎã§" readonly style="width: 100%; min-width: 400px; font-size: 14px;">
                            <input type="hidden" name="workInfo[workTime.start]" id="workTimeStart" 
                                   value="<%= workOrder.workInfo && workOrder.workInfo.workTime && workOrder.workInfo.workTime.start ? workOrder.workInfo.workTime.start : '' %>">
                            <input type="hidden" name="workInfo[workTime.end]" id="workTimeEnd" 
                                   value="<%= workOrder.workInfo && workOrder.workInfo.workTime && workOrder.workInfo.workTime.end ? workOrder.workInfo.workTime.end : '' %>">
                            <input type="hidden" name="workInfo[shift]" id="workShift" 
                                   value="<%= workOrder.workInfo && workOrder.workInfo.shift ? workOrder.workInfo.shift : '' %>">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ïù∏Ïõê ÌòÑÌô© -->
            <div class="form-section">
                <div class="section-header">‚ñ° Ïù∏Ïõê ÌòÑÌô©</div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ï¥ùÏõê</label>
                            <input type="number" name="personnelStatus[totalPersonnel]" class="form-control" id="totalPersonnel" 
                                   value="<%= workOrder.personnelStatus && workOrder.personnelStatus.totalPersonnel ? workOrder.personnelStatus.totalPersonnel : '' %>" required>
                        </div>
                        <div class="form-group">
                            <label>Í≤∞Ïõê Ïàò</label>
                            <input type="number" name="personnelStatus[absentPersonnel]" class="form-control" id="absentPersonnel" 
                                   value="<%= workOrder.personnelStatus && workOrder.personnelStatus.absentPersonnel ? workOrder.personnelStatus.absentPersonnel : '0' %>">
                        </div>
                        <div class="form-group">
                            <label>ÌòÑÏû¨Ïõê</label>
                            <input type="number" name="personnelStatus[currentPersonnel]" class="form-control" id="currentPersonnel" 
                                   value="<%= workOrder.personnelStatus && workOrder.personnelStatus.currentPersonnel ? workOrder.personnelStatus.currentPersonnel : '' %>" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="width: 100%;">
                            <label>ÏÇ¨Í≥†ÎÇ¥Ïö©</label>
                            <div style="margin-bottom: 10px;">
                                <button type="button" class="btn btn-secondary" onclick="addAccidentItem()" style="font-size: 12px; padding: 5px 10px;">ÏÇ¨Í≥† Ìï≠Î™© Ï∂îÍ∞Ä</button>
                            </div>
                            <div id="accidentItems">
                                <!-- ÏÇ¨Í≥† Ìï≠Î™©Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Í∑ºÎ¨¥ Ìé∏ÏÑ± -->
            <div class="form-section">
                <div class="section-header">‚ñ° Í∑ºÎ¨¥ Ìé∏ÏÑ± (ÏàòÏ†ï)</div>
                <div class="section-content">
                    <div class="assignment-container">
                        <!-- ÏôºÏ™Ω ÏòÅÏó≠ (Ìï¥ÏïàÏßÄÏó≠) -->
                        <div class="assignment-left">
                            <table class="work-assignment-table" style="table-layout: fixed; vertical-align: middle; font-size: 14px;">
                        <thead>
                                    <tr style="height: 20px;">
                                        <th class="region-col" style="vertical-align: middle;">ÏßÄÏó≠</th>
                                        <th class="location-col" style="vertical-align: middle;">Î≥¥ÏïàÍ∑ºÎ¨¥ÏßÄ</th>
                                        <th class="personnel-col" style="vertical-align: middle; text-align: center;">Ìé∏ÏÑ±</th>
                            </tr>
                        </thead>
                                <tr style="height: 1px; background-color: #ddd;">
                                    <td colspan="3" style="padding: 0; height: 1px;"></td>
                                </tr>
                        <tbody>
                            <!-- Ìï¥ÏïàÏßÄÏó≠ -->
                            <tr>
                                <td rowspan="12" class="region-col">Ìï¥ÏïàÏßÄÏó≠</td>
                                <td class="location-col">Ìï¥ÏïàÏûÖÎ¨∏</td>
                                <td class="personnel-col">
                                    <div style="display: flex; flex-direction: column; gap: 5px;">
                                        <div style="text-align: left;">Ï°∞Ïû•: <input type="text" name="supervisor_Ìï¥ÏïàÏûÖÎ¨∏" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Ìï¥ÏïàÏûÖÎ¨∏', 'supervisor') : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;"></div>
                                        <div style="display: flex; gap: 5px;">
                                            <input type="text" name="member_Ìï¥ÏïàÏûÖÎ¨∏_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Ìï¥ÏïàÏûÖÎ¨∏', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;">
                                            <input type="text" name="member_Ìï¥ÏïàÏûÖÎ¨∏_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Ìï¥ÏïàÏûÖÎ¨∏', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;">
                                            <input type="text" name="member_Ìï¥ÏïàÏûÖÎ¨∏_2" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Ìï¥ÏïàÏûÖÎ¨∏', 'members', 2) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;">
                                        </div>
                                    </div>
                                    <input type="hidden" name="workAssignment[Ìï¥ÏïàÏûÖÎ¨∏].region" value="Ìï¥ÏïàÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[Ìï¥ÏïàÏûÖÎ¨∏].location" value="Ìï¥ÏïàÏûÖÎ¨∏">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">Ìï¥ÏïàÏ∂úÎ¨∏</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_Ìï¥ÏïàÏ∂úÎ¨∏_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Ìï¥ÏïàÏ∂úÎ¨∏', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_Ìï¥ÏïàÏ∂úÎ¨∏_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Ìï¥ÏïàÏ∂úÎ¨∏', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_Ìï¥ÏïàÏ∂úÎ¨∏_2" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Ìï¥ÏïàÏ∂úÎ¨∏', 'members', 2) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[Ìï¥ÏïàÏ∂úÎ¨∏].region" value="Ìï¥ÏïàÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[Ìï¥ÏïàÏ∂úÎ¨∏].location" value="Ìï¥ÏïàÏ∂úÎ¨∏">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">Í∏∞Ïà†ÍµêÏú°ÏõêÎ¨∏</td>
                                <td class="personnel-col">
                                    <div style="display: flex; flex-direction: column; gap: 5px;">
                                        <div style="text-align: left;">Ï°∞Ïû•: <input type="text" name="supervisor_Í∏∞Ïà†ÍµêÏú°ÏõêÎ¨∏" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Í∏∞Ïà†ÍµêÏú°ÏõêÎ¨∏', 'supervisor') : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;"></div>
                                        <div style="display: flex; gap: 5px;">
                                            <input type="text" name="member_Í∏∞Ïà†ÍµêÏú°ÏõêÎ¨∏_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Í∏∞Ïà†ÍµêÏú°ÏõêÎ¨∏', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;">
                                            <input type="text" name="member_Í∏∞Ïà†ÍµêÏú°ÏõêÎ¨∏_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Í∏∞Ïà†ÍµêÏú°ÏõêÎ¨∏', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ÍµêÏú°ÏõêÏ§ëÎ¨∏</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ÍµêÏú°ÏõêÏ§ëÎ¨∏_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÍµêÏú°ÏõêÏ§ëÎ¨∏', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ÍµêÏú°ÏõêÏ§ëÎ¨∏].region" value="Ìï¥ÏïàÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[ÍµêÏú°ÏõêÏ§ëÎ¨∏].location" value="ÍµêÏú°ÏõêÏ§ëÎ¨∏">
                                    <input type="hidden" name="workAssignment[ÍµêÏú°ÏõêÏ§ëÎ¨∏].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ÍµêÏú°ÏõêÏ§ëÎ¨∏].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Î¨∏</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Î¨∏_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Î¨∏', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Î¨∏].region" value="Ìï¥ÏïàÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Î¨∏].location" value="ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Î¨∏">
                                    <input type="hidden" name="workAssignment[ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Î¨∏].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Î¨∏].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Ï¥àÏÜå</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Ï¥àÏÜå_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Ï¥àÏÜå', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Ï¥àÏÜå].region" value="Ìï¥ÏïàÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Ï¥àÏÜå].location" value="ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Ï¥àÏÜå">
                                    <input type="hidden" name="workAssignment[ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Ï¥àÏÜå].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Ï¥àÏÜå].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ÏÑ†Ï†ÅÏ§ëÎ¨∏</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ÏÑ†Ï†ÅÏ§ëÎ¨∏_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏÑ†Ï†ÅÏ§ëÎ¨∏', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_ÏÑ†Ï†ÅÏ§ëÎ¨∏_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏÑ†Ï†ÅÏ§ëÎ¨∏', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">5ÏùòÏû•Ï§ëÎ¨∏</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_5ÏùòÏû•Ï§ëÎ¨∏_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, '5ÏùòÏû•Ï§ëÎ¨∏', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_5ÏùòÏû•Ï§ëÎ¨∏_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, '5ÏùòÏû•Ï§ëÎ¨∏', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ÏïÑÏÇ∞Î°úÏ§ëÎ¨∏</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ÏïÑÏÇ∞Î°úÏ§ëÎ¨∏_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏïÑÏÇ∞Î°úÏ§ëÎ¨∏', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_ÏïÑÏÇ∞Î°úÏ§ëÎ¨∏_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏïÑÏÇ∞Î°úÏ§ëÎ¨∏', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">Ìï≠ÎßåÏàúÏ∞∞</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_Ìï≠ÎßåÏàúÏ∞∞_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Ìï≠ÎßåÏàúÏ∞∞', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_Ìï≠ÎßåÏàúÏ∞∞_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Ìï≠ÎßåÏàúÏ∞∞', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[Ìï≠ÎßåÏàúÏ∞∞].region" value="Ìï¥ÏïàÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[Ìï≠ÎßåÏàúÏ∞∞].location" value="Ìï≠ÎßåÏàúÏ∞∞">
                                    <input type="hidden" name="workAssignment[Ìï≠ÎßåÏàúÏ∞∞].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[Ìï≠ÎßåÏàúÏ∞∞].assignment.supervisor" value="">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Ïò§Î•∏Ï™Ω ÏòÅÏó≠ (ÏÑ±ÎÇ¥/ÏãúÌä∏/Îß§ÏïîÎèôÏßÄÏó≠) -->
                <div class="assignment-right">
                    <table class="work-assignment-table" style="table-layout: fixed; vertical-align: middle; font-size: 14px;">
                        <thead>
                            <tr style="height: 20px;">
                                <th class="region-col" style="vertical-align: middle;">ÏßÄÏó≠</th>
                                <th class="location-col" style="vertical-align: middle;">Î≥¥ÏïàÍ∑ºÎ¨¥ÏßÄ</th>
                                <th class="personnel-col" style="vertical-align: middle; text-align: center;">Ìé∏ÏÑ±</th>
                            </tr>
                        </thead>
                        <tr style="height: 1px; background-color: #ddd;">
                            <td colspan="3" style="padding: 0; height: 1px;"></td>
                        </tr>
                        <tbody>
                            <!-- ÏÑ±ÎÇ¥ÏßÄÏó≠ -->
                            <tr>
                                <td rowspan="3" class="region-col">ÏÑ±ÎÇ¥ÏßÄÏó≠</td>
                                <td rowspan="2" class="location-col">ÏÑ±ÎÇ¥Î¨∏</td>
                                <td class="personnel-col" style="border: none; border-right: 1px solid #ddd;">
                                    <input type="text" name="member_ÏÑ±ÎÇ¥Î¨∏_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏÑ±ÎÇ¥Î¨∏', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 0; border-bottom: none; border-right: none;">
                                    <input type="text" name="member_ÏÑ±ÎÇ¥Î¨∏_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏÑ±ÎÇ¥Î¨∏', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 0; border-bottom: none; border-left: none;">
                                    <input type="hidden" name="workAssignment[ÏÑ±ÎÇ¥Î¨∏].region" value="ÏÑ±ÎÇ¥ÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[ÏÑ±ÎÇ¥Î¨∏].location" value="ÏÑ±ÎÇ¥Î¨∏">
                                    <input type="hidden" name="workAssignment[ÏÑ±ÎÇ¥Î¨∏].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ÏÑ±ÎÇ¥Î¨∏].assignment.supervisor" value="">
                                </td>
                            </tr>
                            <tr>
                                <td class="personnel-col" style="border: none; border-right: 1px solid #ddd;">
                                    <input type="text" name="member_ÏÑ±ÎÇ¥Î¨∏_2" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏÑ±ÎÇ¥Î¨∏', 'members', 2) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 0; border-top: none; border-right: none;">
                                    <input type="text" name="member_ÏÑ±ÎÇ¥Î¨∏_3" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏÑ±ÎÇ¥Î¨∏', 'members', 3) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 0; border-top: none; border-left: none;">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">Ï∞®ÎüâÍ≤ÄÏÉâÏÜå</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_Ï∞®ÎüâÍ≤ÄÏÉâÏÜå_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Ï∞®ÎüâÍ≤ÄÏÉâÏÜå', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_Ï∞®ÎüâÍ≤ÄÏÉâÏÜå_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'Ï∞®ÎüâÍ≤ÄÏÉâÏÜå', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[Ï∞®ÎüâÍ≤ÄÏÉâÏÜå].region" value="ÏÑ±ÎÇ¥ÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[Ï∞®ÎüâÍ≤ÄÏÉâÏÜå].location" value="Ï∞®ÎüâÍ≤ÄÏÉâÏÜå">
                                    <input type="hidden" name="workAssignment[Ï∞®ÎüâÍ≤ÄÏÉâÏÜå].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[Ï∞®ÎüâÍ≤ÄÏÉâÏÜå].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <!-- ÏãúÌä∏ÏßÄÏó≠ -->
                            <tr>
                                <td rowspan="6" class="region-col">ÏãúÌä∏ÏßÄÏó≠</td>
                                <td rowspan="2" class="location-col">ÏãúÌä∏1Î¨∏</td>
                                <td class="personnel-col" style="border: none; border-right: 1px solid #ddd;">
                                    <div style="display: flex; gap: 60px; justify-content: flex-start;">
                                        <div style="text-align: left;">Ï°∞Ïû•: <input type="text" name="supervisor_ÏãúÌä∏1Î¨∏" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏãúÌä∏1Î¨∏', 'supervisor') : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;"></div>
                                    </div>
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏1Î¨∏].region" value="ÏãúÌä∏ÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏1Î¨∏].location" value="ÏãúÌä∏1Î¨∏">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏1Î¨∏].assignment.teamLeader" value="">
                                </td>
                            </tr>
                            <tr>
                                <td class="personnel-col" style="border: none; border-right: 1px solid #ddd;">
                                    <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                        <input type="text" name="member_ÏãúÌä∏1Î¨∏_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏãúÌä∏1Î¨∏', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                        <input type="text" name="member_ÏãúÌä∏1Î¨∏_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏãúÌä∏1Î¨∏', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                        <input type="text" name="member_ÏãúÌä∏1Î¨∏_2" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏãúÌä∏1Î¨∏', 'members', 2) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    </div>
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ÏãúÌä∏1Ï§ëÎ¨∏</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ÏãúÌä∏1Ï§ëÎ¨∏_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏãúÌä∏1Ï§ëÎ¨∏', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_ÏãúÌä∏1Ï§ëÎ¨∏_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏãúÌä∏1Ï§ëÎ¨∏', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏1Ï§ëÎ¨∏].region" value="ÏãúÌä∏ÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏1Ï§ëÎ¨∏].location" value="ÏãúÌä∏1Ï§ëÎ¨∏">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏1Ï§ëÎ¨∏].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏1Ï§ëÎ¨∏].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ÏãúÌä∏1Ï£ºÏ∞®Ïû•Ï¥àÏÜå</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ÏãúÌä∏1Ï£ºÏ∞®Ïû•Ï¥àÏÜå_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏãúÌä∏1Ï£ºÏ∞®Ïû•Ï¥àÏÜå', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏1Ï£ºÏ∞®Ïû•Ï¥àÏÜå].region" value="ÏãúÌä∏ÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏1Ï£ºÏ∞®Ïû•Ï¥àÏÜå].location" value="ÏãúÌä∏1Ï£ºÏ∞®Ïû•Ï¥àÏÜå">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏1Ï£ºÏ∞®Ïû•Ï¥àÏÜå].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏1Ï£ºÏ∞®Ïû•Ï¥àÏÜå].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ÏãúÌä∏3Î¨∏</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ÏãúÌä∏3Î¨∏_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏãúÌä∏3Î¨∏', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_ÏãúÌä∏3Î¨∏_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏãúÌä∏3Î¨∏', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏3Î¨∏].region" value="ÏãúÌä∏ÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏3Î¨∏].location" value="ÏãúÌä∏3Î¨∏">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏3Î¨∏].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ÏãúÌä∏3Î¨∏].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ÏΩîÏùºÏ£ºÏ∞®Ïû•</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ÏΩîÏùºÏ£ºÏ∞®Ïû•_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏΩîÏùºÏ£ºÏ∞®Ïû•', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ÏΩîÏùºÏ£ºÏ∞®Ïû•].region" value="ÏãúÌä∏ÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[ÏΩîÏùºÏ£ºÏ∞®Ïû•].location" value="ÏΩîÏùºÏ£ºÏ∞®Ïû•">
                                    <input type="hidden" name="workAssignment[ÏΩîÏùºÏ£ºÏ∞®Ïû•].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ÏΩîÏùºÏ£ºÏ∞®Ïû•].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <!-- Îß§ÏïîÎèôÏßÄÏó≠ -->
                            <tr>
                                <td rowspan="2" class="region-col">Îß§ÏïîÎèôÏßÄÏó≠</td>
                                <td class="location-col">ÏóîÏßÑ4Î∂Ä</td>
                                <td class="personnel-col">
                                    <div style="display: flex; gap: 60px; justify-content: flex-start; margin-bottom: 5px;">
                                        <div style="text-align: left;">Ï°∞Ïû•: <input type="text" name="supervisor_ÏóîÏßÑ4Î∂Ä" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏóîÏßÑ4Î∂Ä', 'supervisor') : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;"></div>
                                    </div>
                                    <div>
                                        <input type="text" name="member_ÏóîÏßÑ4Î∂Ä_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏóîÏßÑ4Î∂Ä', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                        <input type="text" name="member_ÏóîÏßÑ4Î∂Ä_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏóîÏßÑ4Î∂Ä', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    </div>
                                    <input type="hidden" name="workAssignment[ÏóîÏßÑ4Î∂Ä].region" value="Îß§ÏïîÎèôÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[ÏóîÏßÑ4Î∂Ä].location" value="ÏóîÏßÑ4Î∂Ä">
                                    <input type="hidden" name="workAssignment[ÏóîÏßÑ4Î∂Ä].assignment.teamLeader" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ÏïºÏ†ÅÏû•Ï¥àÏÜå</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ÏïºÏ†ÅÏû•Ï¥àÏÜå_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ÏïºÏ†ÅÏû•Ï¥àÏÜå', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ÏïºÏ†ÅÏû•Ï¥àÏÜå].region" value="Îß§ÏïîÎèôÏßÄÏó≠">
                                    <input type="hidden" name="workAssignment[ÏïºÏ†ÅÏû•Ï¥àÏÜå].location" value="ÏïºÏ†ÅÏû•Ï¥àÏÜå">
                                    <input type="hidden" name="workAssignment[ÏïºÏ†ÅÏû•Ï¥àÏÜå].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ÏïºÏ†ÅÏû•Ï¥àÏÜå].assignment.supervisor" value="">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ÏßÅÎ¨¥ ÍµêÏú° -->
            <div class="form-section">
                <div class="section-header">‚ñ° ÏßÅÎ¨¥(ÏïàÏ†Ñ/Î≥¥Í±¥) ÍµêÏú°</div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group" style="width: 50%;">
                            <label>Í∏àÏ£ºÏ§ëÏ†ê</label>
                            <div style="margin-bottom: 10px;">
                                <button type="button" class="btn btn-secondary" onclick="addWeeklyFocus()" style="font-size: 12px; padding: 5px 10px;">Í∏àÏ£ºÏ§ëÏ†ê Ï∂îÍ∞Ä</button>
                            </div>
                            <div id="weeklyFocusItems">
                                <!-- Í∏àÏ£ºÏ§ëÏ†ê Ìï≠Î™©Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                            </div>
                        </div>
                        <div class="form-group" style="width: 50%;">
                            <label>ÍµêÏú°ÎÇ¥Ïö©</label>
                            <div style="margin-bottom: 10px;">
                                <button type="button" class="btn btn-secondary" onclick="addEducationContent()" style="font-size: 12px; padding: 5px 10px;">ÍµêÏú°ÎÇ¥Ïö© Ï∂îÍ∞Ä</button>
                            </div>
                            <div id="educationContentItems">
                                <!-- ÍµêÏú°ÎÇ¥Ïö© Ìï≠Î™©Îì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </form>
    </div>

    <script>
        // Í∑ºÎ¨¥Ìé∏ÏÑ± Îç∞Ïù¥ÌÑ∞ Ï∞æÍ∏∞ Ìï®Ïàò
        function findAssignmentData(workAssignment, location, field, index = null) {
            if (!workAssignment || !Array.isArray(workAssignment)) {
                return '';
            }
            
            const assignment = workAssignment.find(item => item.location === location);
            if (!assignment || !assignment.assignment) {
                return '';
            }
            
            if (field === 'teamLeader') {
                return assignment.assignment.teamLeader || '';
            } else if (field === 'supervisor') {
                return assignment.assignment.supervisor || '';
            } else if (field === 'members' && index !== null) {
                return assignment.assignment.members && assignment.assignment.members[index] ? assignment.assignment.members[index] : '';
            }
            
            return '';
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏûêÎèôÏûÖÎ†• Ïã§Ìñâ (ÏàòÏ†ïÌéòÏù¥ÏßÄÏóêÏÑúÎäî Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú)
        document.addEventListener('DOMContentLoaded', function() {
            loadExistingData();
            displayTodaySchedule();
        });

        // Ìèº Ï†úÏ∂ú Ïãú ÎîîÎ≤ÑÍπÖ
        document.getElementById('workOrderForm').addEventListener('submit', function(e) {
            console.log('üîß ÏàòÏ†ïÌéòÏù¥ÏßÄ Ìèº Ï†úÏ∂ú ÏãúÏûë');
            
            // workAssignment Í¥ÄÎ†® Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            const workAssignmentData = {};
            const locations = ['Ìï¥ÏïàÏûÖÎ¨∏', 'Ìï¥ÏïàÏ∂úÎ¨∏', 'Í∏∞Ïà†ÍµêÏú°ÏõêÎ¨∏', 'ÍµêÏú°ÏõêÏ§ëÎ¨∏', 'ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Î¨∏', 'ÏÑ±ÎÇ¥Ï£ºÏ∞®Ïû•Ï¥àÏÜå', 
                             'ÏÑ†Ï†ÅÏ§ëÎ¨∏', '5ÏùòÏû•Ï§ëÎ¨∏', 'ÏïÑÏÇ∞Î°úÏ§ëÎ¨∏', 'Ìï≠ÎßåÏàúÏ∞∞', 'ÏÑ±ÎÇ¥Î¨∏', 'Ï∞®ÎüâÍ≤ÄÏÉâÏÜå', 
                             'ÏãúÌä∏1Î¨∏', 'ÏãúÌä∏1Ï§ëÎ¨∏', 'ÏãúÌä∏1Ï£ºÏ∞®Ïû•Ï¥àÏÜå', 'ÏãúÌä∏3Î¨∏', 'ÏΩîÏùºÏ£ºÏ∞®Ïû•', 'ÏóîÏßÑ4Î∂Ä', 'ÏïºÏ†ÅÏû•Ï¥àÏÜå'];
            
            locations.forEach(location => {
                const teamLeader = document.querySelector(`input[name="teamLeader_${location}"]`)?.value || '';
                const supervisor = document.querySelector(`input[name="supervisor_${location}"]`)?.value || '';
                const members = [];
                
                for (let i = 0; i < 10; i++) {
                    const member = document.querySelector(`input[name="member_${location}_${i}"]`)?.value || '';
                    if (member.trim()) {
                        members.push(member.trim());
                    }
                }
                
                if (teamLeader || supervisor || members.length > 0) {
                    workAssignmentData[location] = {
                        teamLeader: teamLeader,
                        supervisor: supervisor,
                        members: members
                    };
                }
            });
            
            console.log('üîß ÏàòÏ†ïÌéòÏù¥ÏßÄ Ï†ÑÏÜ°Ìï† workAssignment Îç∞Ïù¥ÌÑ∞:', workAssignmentData);
        });

        // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ìï®Ïàò
        function loadExistingData() {
            // ÏÇ¨Í≥†ÎÇ¥Ïö© Î°úÎìú
            loadAccidentItems();
            
            // ÍµêÏú°ÎÇ¥Ïö© Î°úÎìú
            loadEducationContent();
        }

        // ÏÇ¨Í≥†ÎÇ¥Ïö© Î°úÎìú
        function loadAccidentItems() {
            <% if (workOrder.personnelStatus && workOrder.personnelStatus.absentDetails && workOrder.personnelStatus.absentDetails.length > 0) { %>
                <% workOrder.personnelStatus.absentDetails.forEach(function(detail) { %>
                    addAccidentItem('<%= detail.type %>', '<%= detail.employeeName %>');
                <% }); %>
            <% } %>
        }

        // ÍµêÏú°ÎÇ¥Ïö© Î°úÎìú
        function loadEducationContent() {
            <% if (workOrder.education && workOrder.education.weeklyFocus && workOrder.education.weeklyFocus.length > 0) { %>
                <% workOrder.education.weeklyFocus.forEach(function(focus) { %>
                    addWeeklyFocus('<%= focus %>');
                <% }); %>
            <% } %>
            
            <% if (workOrder.education && workOrder.education.content && workOrder.education.content.length > 0) { %>
                <% workOrder.education.content.forEach(function(content) { %>
                    addEducationContent('<%= content %>');
                <% }); %>
            <% } %>
        }

        // Í∑ºÎ¨¥Ï†ïÎ≥¥ ÏûêÎèôÏûÖÎ†• (ÏÉà Î™ÖÎ†πÏÑú ÏûëÏÑ± Ïãú Ï¥àÍ∏∞Ìôî)
        function autoFillWorkInfo() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const dateString = `${year}-${month}-${day}`;
            
            // Í∏∞Î≥∏Í∞íÎßå ÏÑ§Ï†ïÌïòÍ≥† Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Ï†úÍ±∞
            document.getElementById('workDate').value = dateString;
            document.getElementById('workTeam').value = ''; // Îπà Í∞íÏúºÎ°ú Ï¥àÍ∏∞Ìôî
            document.getElementById('workTime').value = ''; // Îπà Í∞íÏúºÎ°ú Ï¥àÍ∏∞Ìôî
        }

        // Ï£ºÏ∞® Í≥ÑÏÇ∞ Ìï®Ïàò (3Ï£º Ï£ºÍ∏∞)
        function getWeekCycle(date) {
            // Í∏∞Ï§ÄÏùº: 2025ÎÖÑ 1Ïõî 1Ïùº (ÏàòÏöîÏùº)ÏùÑ 1Ï£ºÏ∞®Î°ú ÏÑ§Ï†ï
            const baseDate = new Date('2025-01-01');
            const targetDate = new Date(date);
            
            // Ï£ºÏ∞® ÏãúÏûëÏùº Í≥ÑÏÇ∞ (ÏõîÏöîÏùº)
            const getWeekStart = (date) => {
                const day = date.getDay();
                const diff = date.getDate() - day + (day === 0 ? -6 : 1);
                const weekStart = new Date(date);
                weekStart.setDate(diff);
                weekStart.setHours(0, 0, 0, 0);
                return weekStart;
            };
            
            const baseWeekStart = getWeekStart(baseDate);
            const targetWeekStart = getWeekStart(targetDate);
            
            // Ï£ºÏ∞® Ï∞®Ïù¥ Í≥ÑÏÇ∞
            const timeDiff = targetWeekStart.getTime() - baseWeekStart.getTime();
            const weekDiff = Math.floor(timeDiff / (7 * 24 * 60 * 60 * 1000));
            
            // 3Ï£º Ï£ºÍ∏∞Î°ú ÏàúÌôò (1, 2, 3, 1, 2, 3...)
            return (weekDiff % 3) + 1;
        }

        // Í∑ºÎ¨¥Î∞ò ÏÑ†ÌÉù Ïãú Í∑ºÎ¨¥ÏãúÍ∞Ñ ÏûêÎèôÏûÖÎ†• (3Ï£º Ï£ºÍ∏∞ ÏàúÌôò Ïä§ÏºÄÏ§Ñ)
        function updateWorkTime() {
            const workTeam = document.getElementById('workTeam').value;
            const workTimeField = document.getElementById('workTime');
            const workDate = document.getElementById('workDate').value;
            
            // ÏÑ†ÌÉùÎêú ÎÇ†ÏßúÏùò ÏöîÏùº ÌôïÏù∏
            const selectedDate = new Date(workDate);
            const dayOfWeek = selectedDate.getDay(); // 0=ÏùºÏöîÏùº, 1=ÏõîÏöîÏùº, ..., 6=ÌÜ†ÏöîÏùº
            
            // Ï£ºÏ∞® Í≥ÑÏÇ∞ (3Ï£º Ï£ºÍ∏∞)
            const weekCycle = getWeekCycle(selectedDate);
            
            let workTime = '';
            
            // Ï£ºÎßê/Í≥µÌú¥Ïùº Í∑ºÎ¨¥
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                if (dayOfWeek === 0) { // ÏùºÏöîÏùº ÌäπÍ∑ºÍ∑ºÎ¨¥
                    // Ï£ºÏ∞® Í≥ÑÏÇ∞ÏúºÎ°ú Í∞Å ÌåÄÏùò ÌèâÏùº Í∑ºÎ¨¥ÌòïÌÉú ÌôïÏù∏
                    const weekNumber = getWeekNumber(selectedDate);
                    const team1Weekday = getTeamSchedule(1, weekNumber);
                    const team2Weekday = getTeamSchedule(2, weekNumber);
                    const team3Weekday = getTeamSchedule(3, weekNumber);
                    
                    // ÏùºÏöîÏùºÏùÄ Ï£ºÍ∞ÑÎ∞òÏù¥ Îã§Ïàò Í∑ºÎ¨¥Ïûê(20Î™Ö)Î•º Ìè¨Ìï®ÌïòÎØÄÎ°ú Ï£ºÍ∞ÑÎ∞òÏùÑ Í∑ºÎ¨¥Î∞òÏúºÎ°ú ÏßÄÏ†ï
                    const weekdayTeam = getTeamSchedule(parseInt(workTeam.replace('Î≥¥Ïïà', '').replace('Î∞ò', '')), weekNumber);
                    
                    if (weekdayTeam === 'Ï£ºÍ∞Ñ') {
                        // Ï£ºÍ∞ÑÎ∞òÏù¥ Ï£ºÍ∞ÑÌäπÍ∑ºÍ∑ºÎ¨¥ÏôÄ ÏïºÍ∞ÑÌäπÍ∑ºÍ∑ºÎ¨¥ ÌÜµÌï© (AÏ°∞+BÏ°∞ 40Î™Ö + ÏßÄÏõêÏ°∞ 20Î™Ö)
                        workTime = 'Ï£ºÍ∞ÑÌäπÍ∑ºÍ∑ºÎ¨¥(06:00~18:00) / ÏïºÍ∞ÑÌäπÍ∑ºÍ∑ºÎ¨¥(18:00~06:00)';
                    } else {
                        // Ïã¨ÏïºÎ∞ò, Ï¥àÏïºÎ∞òÏùÄ ÏùºÏöîÏùº Ìú¥Î¨¥ (ÏßÄÏõêÏ°∞Îßå Ï∞∏Ïó¨)
                        workTime = 'Ìú¥Î¨¥';
                    }
                } else { // ÌÜ†ÏöîÏùº ÌäπÍ∑ºÍ∑ºÎ¨¥
                    // Ï£ºÏ∞® Í≥ÑÏÇ∞ÏúºÎ°ú Í∞Å ÌåÄÏùò ÌèâÏùº Í∑ºÎ¨¥ÌòïÌÉú ÌôïÏù∏
                    const weekNumber = getWeekNumber(selectedDate);
                    const teamNumber = parseInt(workTeam.replace('Î≥¥Ïïà', '').replace('Î∞ò', ''));
                    const weekdayWorkType = getTeamSchedule(teamNumber, weekNumber);
                    
                    if (weekdayWorkType === 'Ïã¨Ïïº') {
                        // Ïã¨ÏïºÌåÄÏùÄ ÌÜ†ÏöîÏùº 1~30Î≤à ÏïºÍ∞ÑÌäπÍ∑º, 31~40Î≤à Ìú¥Î¨¥
                        workTime = 'ÏïºÍ∞ÑÌäπÍ∑ºÍ∑ºÎ¨¥(18:00~06:00)';
                    } else if (weekdayWorkType === 'Ï¥àÏïº') {
                        // Ï¥àÏïºÌåÄÏùÄ ÌÜ†ÏöîÏùº 1~30Î≤à Ï£ºÍ∞ÑÌäπÍ∑º, 31~40Î≤à Ìú¥Î¨¥
                        workTime = 'Ï£ºÍ∞ÑÌäπÍ∑ºÍ∑ºÎ¨¥(06:00~18:00)';
                    } else {
                        // Ï£ºÍ∞ÑÎ∞òÏùÄ ÌÜ†ÏöîÏùº Ìú¥Î¨¥
                        workTime = 'Ìú¥Î¨¥';
                    }
                }
            } else {
                // ÌèâÏùº Í∑ºÎ¨¥ (ÏÉàÎ°úÏö¥ Ìï®Ïàò ÏÇ¨Ïö©)
                const weekNumber = getWeekNumber(selectedDate);
                const teamNumber = parseInt(workTeam.replace('Î≥¥Ïïà', '').replace('Î∞ò', ''));
                const teamSchedule = getTeamSchedule(teamNumber, weekNumber);
                
                switch(teamSchedule) {
                    case 'Ï£ºÍ∞Ñ':
                        workTime = 'Ï£ºÍ∞ÑÍ∑ºÎ¨¥(06:00~14:00)';
                        break;
                    case 'Ï¥àÏïº':
                        workTime = 'Ï¥àÏïºÍ∑ºÎ¨¥(14:00~22:00)';
                        break;
                    case 'Ïã¨Ïïº':
                        workTime = 'Ïã¨ÏïºÍ∑ºÎ¨¥(22:00~06:00)';
                        break;
                    default:
                        workTime = 'Í∑ºÎ¨¥ÌòïÌÉú ÎØ∏Ï†ï';
                }
            }
            
            workTimeField.value = workTime;
            
            // ÏãúÍ∞Ñ Ï†ïÎ≥¥ Î∂ÑÎ¶¨ Î∞è ÏÑ§Ï†ï
            const workTimeStartField = document.getElementById('workTimeStart');
            const workTimeEndField = document.getElementById('workTimeEnd');
            const workShiftField = document.getElementById('workShift');
            
            // ÏãúÍ∞Ñ Ï∂îÏ∂ú (Ïòà: "ÏïºÍ∞ÑÌäπÍ∑º(18:00~06:00)" -> start: "18:00", end: "06:00")
            const timeMatch = workTime.match(/\((\d{2}:\d{2})~(\d{2}:\d{2})\)/);
            if (timeMatch) {
                workTimeStartField.value = timeMatch[1];
                workTimeEndField.value = timeMatch[2];
            } else {
                workTimeStartField.value = '';
                workTimeEndField.value = '';
            }
            
            // shift Í∞í ÏÑ§Ï†ï (Í∑ºÎ¨¥ÏãúÍ∞ÑÏóêÏÑú Ï∂îÏ∂ú)
            if (workTime.includes('Ï£ºÍ∞Ñ')) {
                workShiftField.value = 'Ï£ºÍ∞Ñ';
            } else if (workTime.includes('Ï¥àÏïº')) {
                workShiftField.value = 'Ï¥àÏïº';
            } else if (workTime.includes('Ïã¨Ïïº')) {
                workShiftField.value = 'Ïã¨Ïïº';
            } else if (workTime.includes('ÏïºÍ∞ÑÌäπÍ∑º')) {
                workShiftField.value = 'ÏïºÍ∞ÑÌäπÍ∑º';
            } else if (workTime.includes('Ï£ºÍ∞ÑÌäπÍ∑º')) {
                workShiftField.value = 'Ï£ºÍ∞ÑÌäπÍ∑º';
            } else if (workTime.includes('Ìú¥Î¨¥')) {
                workShiftField.value = 'Ìú¥Î¨¥';
            } else {
                workShiftField.value = '';
            }
            
            // Ï¥ùÏõê ÏûêÎèô ÏÑ§Ï†ï (ÌèâÏùº: 40Î™Ö, Ìú¥Ïùº: 30Î™Ö)
            const totalPersonnelField = document.getElementById('totalPersonnel');
            const absentPersonnelField = document.getElementById('absentPersonnel');
            const currentPersonnelField = document.getElementById('currentPersonnel');
            
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                // Ï£ºÎßê/Í≥µÌú¥Ïùº: 30Î™Ö
                totalPersonnelField.value = '30';
                const absent = parseInt(absentPersonnelField.value) || 0;
                currentPersonnelField.value = 30 - absent;
            } else {
                // ÌèâÏùº: 40Î™Ö
                totalPersonnelField.value = '40';
                const absent = parseInt(absentPersonnelField.value) || 0;
                currentPersonnelField.value = 40 - absent;
            }
        }

        // Ïù∏ÏõêÌòÑÌô© ÏûêÎèôÏûÖÎ†• (ÏÉà Î™ÖÎ†πÏÑú ÏûëÏÑ± Ïãú Ï¥àÍ∏∞Ìôî)
        function autoFillPersonnelInfo() {
            // Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
            document.getElementById('totalPersonnel').value = '40';
            document.getElementById('absentPersonnel').value = '0';
            document.getElementById('currentPersonnel').value = '40';
            
            // Í∏∞Ï°¥ ÏÇ¨Í≥†ÎÇ¥Ïö© Ï†úÍ±∞
            document.getElementById('accidentItems').innerHTML = '';
        }

        // ÏßÅÎ¨¥ÍµêÏú° ÏûêÎèôÏûÖÎ†• (ÏÉà Î™ÖÎ†πÏÑú ÏûëÏÑ± Ïãú Ï¥àÍ∏∞Ìôî)
        function autoFillEducationInfo() {
            // Í∏∞Ï°¥ ÍµêÏú°ÎÇ¥Ïö© Ï†úÍ±∞
            document.getElementById('weeklyFocusItems').innerHTML = '';
            document.getElementById('educationContentItems').innerHTML = '';
        }

        // Í∑ºÎ¨¥Ìé∏ÏÑ± ÌÖåÏù¥Î∏î Ï¥àÍ∏∞Ìôî
        function clearWorkAssignmentTable() {
            // Î™®Îì† Í∑ºÎ¨¥Ìé∏ÏÑ± ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
            const inputs = document.querySelectorAll('.work-assignment-table input[type="text"]');
            inputs.forEach(input => {
                input.value = '';
            });
        }

        // ÏÇ¨Í≥† Ìï≠Î™© Ï∂îÍ∞Ä
        function addAccidentItem(accidentType = '', personnelName = '') {
            const container = document.getElementById('accidentItems');
            const div = document.createElement('div');
            div.style.marginBottom = '10px';
            div.style.display = 'flex';
            div.style.alignItems = 'center';
            div.style.gap = '10px';
            
            div.innerHTML = `
                <select name="personnelStatus[absentDetails][][type]" style="width: 120px; padding: 5px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                    <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                    <option value="Ïó∞Ï∞®1" ${accidentType === 'Ïó∞Ï∞®1' ? 'selected' : ''}>Ïó∞Ï∞®1</option>
                    <option value="Ïó∞Ï∞®2" ${accidentType === 'Ïó∞Ï∞®2' ? 'selected' : ''}>Ïó∞Ï∞®2</option>
                    <option value="Î≥ëÍ∞Ä" ${accidentType === 'Î≥ëÍ∞Ä' ? 'selected' : ''}>Î≥ëÍ∞Ä</option>
                    <option value="ÏÇ∞Ïû¨" ${accidentType === 'ÏÇ∞Ïû¨' ? 'selected' : ''}>ÏÇ∞Ïû¨</option>
                    <option value="Ï†ïÏßÅ" ${accidentType === 'Ï†ïÏßÅ' ? 'selected' : ''}>Ï†ïÏßÅ</option>
                    <option value="Ìú¥ÏßÅ" ${accidentType === 'Ìú¥ÏßÅ' ? 'selected' : ''}>Ìú¥ÏßÅ</option>
                    <option value="Í≤ΩÏ°∞" ${accidentType === 'Í≤ΩÏ°∞' ? 'selected' : ''}>Í≤ΩÏ°∞</option>
                    <option value="Í≤∞Í∑º" ${accidentType === 'Í≤∞Í∑º' ? 'selected' : ''}>Í≤∞Í∑º</option>
                    <option value="Í∏∞ÌÉÄ" ${accidentType === 'Í∏∞ÌÉÄ' ? 'selected' : ''}>Í∏∞ÌÉÄ</option>
                    <option value="Í∑ºÎ¨¥ÏßÄÏõêÏ°∞" ${accidentType === 'Í∑ºÎ¨¥ÏßÄÏõêÏ°∞' ? 'selected' : ''}>Í∑ºÎ¨¥ÏßÄÏõêÏ°∞</option>
                </select>
                <span>:</span>
                <input type="text" name="personnelStatus[absentDetails][][employeeName]" placeholder="Î™ÖÎã®" value="${personnelName}" style="width: 150px; padding: 5px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                <button type="button" onclick="removeAccidentItem(this)" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">ÏÇ≠Ï†ú</button>
            `;
            
            container.appendChild(div);
        }

        // ÏÇ¨Í≥† Ìï≠Î™© ÏÇ≠Ï†ú
        function removeAccidentItem(button) {
            button.parentElement.remove();
        }

        // Í∏àÏ£ºÏ§ëÏ†ê Ï∂îÍ∞Ä
        function addWeeklyFocus(content = '') {
            const container = document.getElementById('weeklyFocusItems');
            const div = document.createElement('div');
            div.style.marginBottom = '10px';
            div.style.display = 'flex';
            div.style.alignItems = 'flex-start';
            div.style.gap = '10px';
            
            div.innerHTML = `
                <textarea name="education[weeklyFocus][]" placeholder="Í∏àÏ£ºÏ§ëÏ†ê ÏûÖÎ†•" style="flex: 1; padding: 5px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; resize: vertical; min-height: 30px; max-height: 120px; font-family: inherit;">${content}</textarea>
                <button type="button" onclick="removeWeeklyFocus(this)" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-top: 2px;">ÏÇ≠Ï†ú</button>
            `;
            
            container.appendChild(div);
            
            // ÏûêÎèô ÌÅ¨Í∏∞ Ï°∞Ï†ï
            const textarea = div.querySelector('textarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
        }

        // Í∏àÏ£ºÏ§ëÏ†ê ÏÇ≠Ï†ú
        function removeWeeklyFocus(button) {
            button.parentElement.remove();
        }

        // ÍµêÏú°ÎÇ¥Ïö© Ï∂îÍ∞Ä
        function addEducationContent(content = '') {
            const container = document.getElementById('educationContentItems');
            const div = document.createElement('div');
            div.style.marginBottom = '10px';
            div.style.display = 'flex';
            div.style.alignItems = 'flex-start';
            div.style.gap = '10px';
            
            div.innerHTML = `
                <textarea name="education[content][]" placeholder="ÍµêÏú°ÎÇ¥Ïö© ÏûÖÎ†•" style="flex: 1; padding: 5px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; resize: vertical; min-height: 30px; max-height: 120px; font-family: inherit;">${content}</textarea>
                <button type="button" onclick="removeEducationContent(this)" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-top: 2px;">ÏÇ≠Ï†ú</button>
            `;
            
            container.appendChild(div);
            
            // ÏûêÎèô ÌÅ¨Í∏∞ Ï°∞Ï†ï
            const textarea = div.querySelector('textarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
        }

        // ÍµêÏú°ÎÇ¥Ïö© ÏÇ≠Ï†ú
        function removeEducationContent(button) {
            button.parentElement.remove();
        }

        // Ï¥ùÏõê Î≥ÄÍ≤Ω Ïãú ÌòÑÏû¨Ïõê ÏûêÎèô Í≥ÑÏÇ∞
        document.getElementById('totalPersonnel').addEventListener('input', function() {
            const total = parseInt(this.value) || 0;
            const absent = parseInt(document.getElementById('absentPersonnel').value) || 0;
            const current = total - absent;
            document.getElementById('currentPersonnel').value = current;
        });

        // Í≤∞Ïõê Ïàò Î≥ÄÍ≤Ω Ïãú ÌòÑÏû¨Ïõê ÏûêÎèô Í≥ÑÏÇ∞
        document.getElementById('absentPersonnel').addEventListener('input', function() {
            const total = parseInt(document.getElementById('totalPersonnel').value) || 0;
            const absent = parseInt(this.value) || 0;
            const current = total - absent;
            document.getElementById('currentPersonnel').value = current;
        });

        // Í∑ºÎ¨¥Î∞ò ÏÑ†ÌÉù Ïãú Í∑ºÎ¨¥ÏãúÍ∞Ñ ÏûêÎèôÏûÖÎ†•
        document.getElementById('workTeam').addEventListener('change', updateWorkTime);
        
        // ÎÇ†Ïßú Î≥ÄÍ≤Ω ÏãúÏóêÎèÑ Í∑ºÎ¨¥ÏãúÍ∞Ñ ÏûêÎèôÏûÖÎ†•
        document.getElementById('workDate').addEventListener('change', updateWorkTime);

        // Ïò§ÎäòÏùò Í∑ºÎ¨¥ÌòïÌÉú ÌëúÏãú Ìï®Ïàò
        function displayTodaySchedule() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            
            // ÏùºÏöîÏùºÏù∏ Í≤ΩÏö∞ÏóêÎßå ÌäπÍ∑ºÍ∑ºÎ¨¥ Ïä§ÏºÄÏ§Ñ ÌëúÏãú
            if (dayOfWeek === 0) {
                const weekNumber = getWeekNumber(today);
                const cycle = weekNumber % 3;
                
                // Í∞Å ÌåÄÏùò ÌèâÏùº Í∑ºÎ¨¥ÌòïÌÉú Í≥ÑÏÇ∞
                const team1Weekday = getTeamSchedule(1, weekNumber);
                const team2Weekday = getTeamSchedule(2, weekNumber);
                const team3Weekday = getTeamSchedule(3, weekNumber);
                
                const container = document.getElementById('todayScheduleContainer');
                
                // ÏùºÏöîÏùº ÌäπÍ∑ºÍ∑ºÎ¨¥ Ïä§ÏºÄÏ§Ñ HTML ÏÉùÏÑ±
                container.innerHTML = `
                    <div class="col-md-12">
                        <div class="alert alert-info">
                            <h6><i class="fa-solid fa-calendar-day me-2"></i>2025ÎÖÑ 9Ïõî 7Ïùº ÏùºÏöîÏùº ÌäπÍ∑ºÍ∑ºÎ¨¥</h6>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="card border-success">
                                        <div class="card-header bg-success text-white py-2">
                                            <h6 class="mb-0">Î≥¥Ïïà2Î∞ò - Ï£ºÍ∞ÑÌäπÍ∑º</h6>
                                        </div>
                                        <div class="card-body py-2">
                                            <div class="text-center">
                                                <div class="h6 mb-0 text-success">Ï£ºÍ∞ÑÌäπÍ∑ºÍ∑ºÎ¨¥</div>
                                                <small class="text-muted">06:00~18:00 (AÏ°∞ 20Î™Ö + ÏßÄÏõêÏ°∞ 10Î™Ö)</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card border-warning">
                                        <div class="card-header bg-warning text-white py-2">
                                            <h6 class="mb-0">Î≥¥Ïïà2Î∞ò - ÏïºÍ∞ÑÌäπÍ∑º</h6>
                                        </div>
                                        <div class="card-body py-2">
                                            <div class="text-center">
                                                <div class="h6 mb-0 text-warning">ÏïºÍ∞ÑÌäπÍ∑ºÍ∑ºÎ¨¥</div>
                                                <small class="text-muted">18:00~06:00 (BÏ°∞ 20Î™Ö + ÏßÄÏõêÏ°∞ 10Î™Ö)</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <small class="text-muted">
                                    <i class="fa-solid fa-info-circle me-1"></i>
                                    ÏùºÏöîÏùºÏùÄ ÌäπÍ∑ºÍ∑ºÎ¨¥Î°ú 12ÏãúÍ∞ÑÏî© Í∑ºÎ¨¥Ìï©ÎãàÎã§. Í∞Å ÌåÄÏùò Ï°∞Î≥ÑÎ°ú Îã§Î•∏ Í∑ºÎ¨¥ÌòïÌÉúÎ•º Í∞ÄÏßëÎãàÎã§.
                                </small>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // ÌèâÏùºÏù∏ Í≤ΩÏö∞ Í∞ÑÎã®Ìïú Î©îÏãúÏßÄ ÌëúÏãú
                const container = document.getElementById('todayScheduleContainer');
                container.innerHTML = `
                    <div class="col-md-12">
                        <div class="alert alert-secondary">
                            <h6 style="font-size: 14px;"><i class="fa-solid fa-calendar me-2"></i>ÌèâÏùº Í∑ºÎ¨¥</h6>
                            <p class="mb-0" style="font-size: 14px;">Ïò§ÎäòÏùÄ ÌèâÏùºÏûÖÎãàÎã§. Í∞Å ÌåÄÏùò Ï†ïÍ∑ú Í∑ºÎ¨¥ÌòïÌÉúÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.</p>
                        </div>
                    </div>
                `;
            }
        }

        // Ï£ºÏ∞® Í≥ÑÏÇ∞ Ìï®Ïàò (1Ïõî 1Ïùº ÏàòÏöîÏùºÎ∂ÄÌÑ∞ ÏãúÏûë, Í∏∞Ï§ÄÏùº Ï°∞Ï†ï)
        function getWeekNumber(date) {
            // 2025ÎÖÑ 1Ïõî 1Ïùº(ÏàòÏöîÏùº) 06:00ÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Í≥ÑÏÇ∞ÌïòÎêò, 1Ï£ºÏ∞® Î∂ÄÏ°± Î¨∏Ï†ú Ìï¥Í≤∞
            const yearStart = new Date(2025, 0, 1, 6, 0, 0); // 2025ÎÖÑ 1Ïõî 1Ïùº 06:00
            const targetDate = new Date(date);
            
            // ÏõîÏöîÏùº 06:00ÏúºÎ°ú Ï°∞Ï†ï
            const dayOfWeek = targetDate.getDay();
            const mondayOffset = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
            
            const monday6am = new Date(targetDate);
            monday6am.setDate(targetDate.getDate() - mondayOffset);
            monday6am.setHours(6, 0, 0, 0);
            
            const weekDiff = Math.floor((monday6am - yearStart) / (7 * 24 * 60 * 60 * 1000));
            const weekNumber = weekDiff + 2; // +1ÏùÑ +2Î°ú ÏàòÏ†ïÌïòÏó¨ 1Ï£ºÏ∞® Ï∂îÍ∞Ä
            
            return weekNumber;
        }

        // ÌåÄÎ≥Ñ Í∑ºÎ¨¥ÌòïÌÉú Í≥ÑÏÇ∞ Ìï®Ïàò (Ïò¨Î∞îÎ•∏ Ìå®ÌÑ¥ Í∏∞Î∞ò)
        function getTeamSchedule(teamNumber, weekNumber) {
            // 1Ï£ºÏ∞®: 1Î∞ò Ï¥àÏïº, 2Î∞ò Ïã¨Ïïº, 3Î∞ò Ï£ºÍ∞Ñ
            // 2Ï£ºÏ∞®: 1Î∞ò Ï£ºÍ∞Ñ, 2Î∞ò Ï¥àÏïº, 3Î∞ò Ïã¨Ïïº
            // 3Ï£ºÏ∞®: 1Î∞ò Ïã¨Ïïº, 2Î∞ò Ï£ºÍ∞Ñ, 3Î∞ò Ï¥àÏïº
            // 4Ï£ºÏ∞®: 1Î∞ò Ï¥àÏïº, 2Î∞ò Ïã¨Ïïº, 3Î∞ò Ï£ºÍ∞Ñ (1Ï£ºÏ∞®ÏôÄ ÎèôÏùº)
            // 5Ï£ºÏ∞®: 1Î∞ò Ï£ºÍ∞Ñ, 2Î∞ò Ï¥àÏïº, 3Î∞ò Ïã¨Ïïº (2Ï£ºÏ∞®ÏôÄ ÎèôÏùº)
            // 6Ï£ºÏ∞®: 1Î∞ò Ïã¨Ïïº, 2Î∞ò Ï£ºÍ∞Ñ, 3Î∞ò Ï¥àÏïº (3Ï£ºÏ∞®ÏôÄ ÎèôÏùº)
            
            const cycle = (weekNumber - 1) % 3; // 0, 1, 2 Î∞òÎ≥µ
            
            if (teamNumber === 1) {
                // 1Î∞ò: Ï¥àÏïº(1Ï£ºÏ∞®) ‚Üí Ï£ºÍ∞Ñ(2Ï£ºÏ∞®) ‚Üí Ïã¨Ïïº(3Ï£ºÏ∞®)
                const schedules = ['Ï¥àÏïº', 'Ï£ºÍ∞Ñ', 'Ïã¨Ïïº'];
                return schedules[cycle];
            } else if (teamNumber === 2) {
                // 2Î∞ò: Ïã¨Ïïº(1Ï£ºÏ∞®) ‚Üí Ï¥àÏïº(2Ï£ºÏ∞®) ‚Üí Ï£ºÍ∞Ñ(3Ï£ºÏ∞®)
                const schedules = ['Ïã¨Ïïº', 'Ï¥àÏïº', 'Ï£ºÍ∞Ñ'];
                return schedules[cycle];
            } else if (teamNumber === 3) {
                // 3Î∞ò: Ï£ºÍ∞Ñ(1Ï£ºÏ∞®) ‚Üí Ïã¨Ïïº(2Ï£ºÏ∞®) ‚Üí Ï¥àÏïº(3Ï£ºÏ∞®)
                const schedules = ['Ï£ºÍ∞Ñ', 'Ïã¨Ïïº', 'Ï¥àÏïº'];
                return schedules[cycle];
            }
            
            return 'Ï£ºÍ∞Ñ';
        }

    </script>

    </div>
</div>

<%- include('footer') %>
</body>
</html>
