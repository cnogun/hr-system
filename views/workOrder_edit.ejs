<%- include('header') %>

<body>
<style>
        /* í‘¸í„°ë¥¼ ë°”ë””ì—ì„œ ë¶„ë¦¬í•˜ì—¬ í™”ë©´ í•˜ë‹¨ì— ê³ ì • */
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 0;
        }
        
        .flex-grow-1 {
            flex: 1;
            padding-bottom: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-section {
            margin-bottom: 15px;
            border: none;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .section-header {
            background-color: #f8f9fa;
            padding: 8px 15px;
            font-weight: bold;
            font-size: 14px;
            border-bottom: none;
        }
        
        .section-content {
            padding: 20px;
        }
        
        .form-row {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .form-group {
            margin-right: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 12px;
        }
        
        .form-control {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .work-assignment-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ddd;
            font-size: 14px;
        }
        
        .work-assignment-table th,
        .work-assignment-table td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: center;
            vertical-align: middle;
            height: 20px;
        }
        
        .work-assignment-table th {
            background-color: #f0f0f0;
            font-weight: normal;
        }
        
        .work-assignment-table .region-col {
            background-color: #e9ecef;
            font-weight: bold;
            width: 15%;
        }
        
        .work-assignment-table .location-col {
            background-color: #e9ecef;
            font-weight: bold;
            text-align: center;
            width: 30%;
        }
        
        .work-assignment-table .personnel-col {
            width: 55%;
        }
        
        .work-assignment-table .personnel-col input {
            width: 80px !important;
            border: 1px solid #ddd !important;
            padding: 2px !important;
            text-align: left !important;
            font-size: 12px !important;
            display: inline-block !important;
            margin: 2px !important;
            background-color: white !important;
        }
        
        /* ìƒˆë¡œìš´ ê·¼ë¬´í¸ì„± ì¢Œìš° ëŒ€ì¹­ ìŠ¤íƒ€ì¼ */
        .assignment-container {
            display: flex;
            gap: 20px;
            width: 100%;
        }
        
        .assignment-left, .assignment-right {
            flex: 1;
        }
        
        .assignment-left table, .assignment-right table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
            table-layout: fixed;
        }
        
        .assignment-left th, .assignment-right th {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            height: 20px;
        }
        
        .assignment-left td, .assignment-right td {
            border: 1px solid #dee2e6;
            padding: 4px;
            vertical-align: middle;
            height: 20px;
        }
        
        .assignment-left .region-col, .assignment-right .region-col {
            width: 15%;
            text-align: center;
            font-weight: bold;
            background-color: #e9ecef;
        }
        
        .assignment-left .location-col, .assignment-right .location-col {
            width: 30%;
            text-align: center;
            vertical-align: middle;
            font-weight: bold;
            background-color: #f8f9fa;
        }
        
        .assignment-left .personnel-col, .assignment-right .personnel-col {
            width: 55%;
            text-align: left;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
    </style>

<div class="flex-grow-1">
    <div class="container">
        <!-- ì œëª©ê³¼ ë²„íŠ¼ -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="mb-0">ê·¼ë¬´ëª…ë ¹ì„œ ìˆ˜ì •</h1>
            <div class="btn-group">
                <a href="/work-orders" class="btn btn-secondary">ëª©ë¡</a>
                <button type="submit" form="workOrderForm" class="btn btn-primary">ì €ì¥</button>
                <a href="/work-orders/<%= workOrder._id %>" class="btn btn-success">ë³´ê¸°</a>
                <button type="button" class="btn btn-warning" onclick="history.back()">ì·¨ì†Œ</button>
            </div>
        </div>
        
        <form id="workOrderForm" action="/work-orders/<%= workOrder._id %>" method="POST">
            <input type="hidden" name="_method" value="PUT">
            <!-- ì˜¤ëŠ˜ì˜ ê·¼ë¬´ í˜•íƒœ -->
            <div class="form-section">
                <div class="section-header">â–¡ ì˜¤ëŠ˜ì˜ ê·¼ë¬´ í˜•íƒœ</div>
                <div class="section-content">
                    <div class="row" id="todayScheduleContainer">
                        <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                    </div>
                </div>
            </div>

            <!-- ê·¼ë¬´ ì •ë³´ -->
            <div class="form-section">
                <div class="section-header">â–¡ ê·¼ë¬´ ì •ë³´ (ìˆ˜ì •)</div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ê·¼ë¬´ ë‚ ì§œ</label>
                            <input type="date" name="workInfo[date]" class="form-control" id="workDate" 
                                   value="<%= workOrder.workInfo && workOrder.workInfo.date ? workOrder.workInfo.date.toISOString().split('T')[0] : '' %>" required>
                        </div>
                        <div class="form-group">
                            <label>ê·¼ë¬´ë°˜</label>
                            <select name="workInfo[team]" class="form-control" id="workTeam" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ë³´ì•ˆ1ë°˜" <%= workOrder.workInfo && workOrder.workInfo.team === 'ë³´ì•ˆ1ë°˜' ? 'selected' : '' %>>ë³´ì•ˆ1ë°˜</option>
                                <option value="ë³´ì•ˆ2ë°˜" <%= workOrder.workInfo && workOrder.workInfo.team === 'ë³´ì•ˆ2ë°˜' ? 'selected' : '' %>>ë³´ì•ˆ2ë°˜</option>
                                <option value="ë³´ì•ˆ3ë°˜" <%= workOrder.workInfo && workOrder.workInfo.team === 'ë³´ì•ˆ3ë°˜' ? 'selected' : '' %>>ë³´ì•ˆ3ë°˜</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 2; min-width: 450px;">
                            <label>ê·¼ë¬´ì‹œê°„</label>
                            <input type="text" name="workInfo[workTime.display]" class="form-control" id="workTime" 
                                   value="<%= workOrder.workInfo && workOrder.workInfo.workTime && workOrder.workInfo.workTime.display ? workOrder.workInfo.workTime.display : '' %>"
                                   placeholder="ê·¼ë¬´ë°˜ì„ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤" readonly style="width: 100%; min-width: 400px; font-size: 14px;">
                            <input type="hidden" name="workInfo[workTime.start]" id="workTimeStart" 
                                   value="<%= workOrder.workInfo && workOrder.workInfo.workTime && workOrder.workInfo.workTime.start ? workOrder.workInfo.workTime.start : '' %>">
                            <input type="hidden" name="workInfo[workTime.end]" id="workTimeEnd" 
                                   value="<%= workOrder.workInfo && workOrder.workInfo.workTime && workOrder.workInfo.workTime.end ? workOrder.workInfo.workTime.end : '' %>">
                            <input type="hidden" name="workInfo[shift]" id="workShift" 
                                   value="<%= workOrder.workInfo && workOrder.workInfo.shift ? workOrder.workInfo.shift : '' %>">
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì¸ì› í˜„í™© -->
            <div class="form-section">
                <div class="section-header">â–¡ ì¸ì› í˜„í™©</div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ì´ì›</label>
                            <input type="number" name="personnelStatus[totalPersonnel]" class="form-control" id="totalPersonnel" 
                                   value="<%= workOrder.personnelStatus && workOrder.personnelStatus.totalPersonnel ? workOrder.personnelStatus.totalPersonnel : '' %>" required>
                        </div>
                        <div class="form-group">
                            <label>ê²°ì› ìˆ˜</label>
                            <input type="number" name="personnelStatus[absentPersonnel]" class="form-control" id="absentPersonnel" 
                                   value="<%= workOrder.personnelStatus && workOrder.personnelStatus.absentPersonnel ? workOrder.personnelStatus.absentPersonnel : '0' %>">
                        </div>
                        <div class="form-group">
                            <label>í˜„ì¬ì›</label>
                            <input type="number" name="personnelStatus[currentPersonnel]" class="form-control" id="currentPersonnel" 
                                   value="<%= workOrder.personnelStatus && workOrder.personnelStatus.currentPersonnel ? workOrder.personnelStatus.currentPersonnel : '' %>" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="width: 100%;">
                            <label>ì‚¬ê³ ë‚´ìš©</label>
                            <div style="margin-bottom: 10px;">
                                <button type="button" class="btn btn-secondary" onclick="addAccidentItem()" style="font-size: 12px; padding: 5px 10px;">ì‚¬ê³  í•­ëª© ì¶”ê°€</button>
                            </div>
                            <div id="accidentItems">
                                <!-- ì‚¬ê³  í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- ê·¼ë¬´ í¸ì„± -->
            <div class="form-section">
                <div class="section-header">â–¡ ê·¼ë¬´ í¸ì„± (ìˆ˜ì •)</div>
                <div class="section-content">
                    <div class="assignment-container">
                        <!-- ì™¼ìª½ ì˜ì—­ (í•´ì•ˆì§€ì—­) -->
                        <div class="assignment-left">
                            <table class="work-assignment-table" style="table-layout: fixed; vertical-align: middle; font-size: 14px;">
                        <thead>
                                    <tr style="height: 20px;">
                                        <th class="region-col" style="vertical-align: middle;">ì§€ì—­</th>
                                        <th class="location-col" style="vertical-align: middle;">ë³´ì•ˆê·¼ë¬´ì§€</th>
                                        <th class="personnel-col" style="vertical-align: middle; text-align: center;">í¸ì„±</th>
                            </tr>
                        </thead>
                                <tr style="height: 1px; background-color: #ddd;">
                                    <td colspan="3" style="padding: 0; height: 1px;"></td>
                                </tr>
                        <tbody>
                            <!-- í•´ì•ˆì§€ì—­ -->
                            <tr>
                                <td rowspan="12" class="region-col">í•´ì•ˆì§€ì—­</td>
                                <td class="location-col">í•´ì•ˆì…ë¬¸</td>
                                <td class="personnel-col">
                                    <div style="display: flex; flex-direction: column; gap: 5px;">
                                        <div style="text-align: left;">ì¡°ì¥: <input type="text" name="supervisor_í•´ì•ˆì…ë¬¸" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'í•´ì•ˆì…ë¬¸', 'supervisor') : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;"></div>
                                        <div style="display: flex; gap: 5px;">
                                            <input type="text" name="member_í•´ì•ˆì…ë¬¸_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'í•´ì•ˆì…ë¬¸', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;">
                                            <input type="text" name="member_í•´ì•ˆì…ë¬¸_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'í•´ì•ˆì…ë¬¸', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;">
                                            <input type="text" name="member_í•´ì•ˆì…ë¬¸_2" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'í•´ì•ˆì…ë¬¸', 'members', 2) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;">
                                        </div>
                                    </div>
                                    <input type="hidden" name="workAssignment[í•´ì•ˆì…ë¬¸].region" value="í•´ì•ˆì§€ì—­">
                                    <input type="hidden" name="workAssignment[í•´ì•ˆì…ë¬¸].location" value="í•´ì•ˆì…ë¬¸">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">í•´ì•ˆì¶œë¬¸</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_í•´ì•ˆì¶œë¬¸_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'í•´ì•ˆì¶œë¬¸', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_í•´ì•ˆì¶œë¬¸_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'í•´ì•ˆì¶œë¬¸', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_í•´ì•ˆì¶œë¬¸_2" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'í•´ì•ˆì¶œë¬¸', 'members', 2) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[í•´ì•ˆì¶œë¬¸].region" value="í•´ì•ˆì§€ì—­">
                                    <input type="hidden" name="workAssignment[í•´ì•ˆì¶œë¬¸].location" value="í•´ì•ˆì¶œë¬¸">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ê¸°ìˆ êµìœ¡ì›ë¬¸</td>
                                <td class="personnel-col">
                                    <div style="display: flex; flex-direction: column; gap: 5px;">
                                        <div style="text-align: left;">ì¡°ì¥: <input type="text" name="supervisor_ê¸°ìˆ êµìœ¡ì›ë¬¸" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ê¸°ìˆ êµìœ¡ì›ë¬¸', 'supervisor') : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;"></div>
                                        <div style="display: flex; gap: 5px;">
                                            <input type="text" name="member_ê¸°ìˆ êµìœ¡ì›ë¬¸_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ê¸°ìˆ êµìœ¡ì›ë¬¸', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;">
                                            <input type="text" name="member_ê¸°ìˆ êµìœ¡ì›ë¬¸_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ê¸°ìˆ êµìœ¡ì›ë¬¸', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">êµìœ¡ì›ì¤‘ë¬¸</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_êµìœ¡ì›ì¤‘ë¬¸_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'êµìœ¡ì›ì¤‘ë¬¸', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[êµìœ¡ì›ì¤‘ë¬¸].region" value="í•´ì•ˆì§€ì—­">
                                    <input type="hidden" name="workAssignment[êµìœ¡ì›ì¤‘ë¬¸].location" value="êµìœ¡ì›ì¤‘ë¬¸">
                                    <input type="hidden" name="workAssignment[êµìœ¡ì›ì¤‘ë¬¸].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[êµìœ¡ì›ì¤‘ë¬¸].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ì„±ë‚´ì£¼ì°¨ì¥ë¬¸</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ì„±ë‚´ì£¼ì°¨ì¥ë¬¸_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì„±ë‚´ì£¼ì°¨ì¥ë¬¸', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ì„±ë‚´ì£¼ì°¨ì¥ë¬¸].region" value="í•´ì•ˆì§€ì—­">
                                    <input type="hidden" name="workAssignment[ì„±ë‚´ì£¼ì°¨ì¥ë¬¸].location" value="ì„±ë‚´ì£¼ì°¨ì¥ë¬¸">
                                    <input type="hidden" name="workAssignment[ì„±ë‚´ì£¼ì°¨ì¥ë¬¸].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ì„±ë‚´ì£¼ì°¨ì¥ë¬¸].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ì„±ë‚´ì£¼ì°¨ì¥ì´ˆì†Œ</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ì„±ë‚´ì£¼ì°¨ì¥ì´ˆì†Œ_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì„±ë‚´ì£¼ì°¨ì¥ì´ˆì†Œ', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ì„±ë‚´ì£¼ì°¨ì¥ì´ˆì†Œ].region" value="í•´ì•ˆì§€ì—­">
                                    <input type="hidden" name="workAssignment[ì„±ë‚´ì£¼ì°¨ì¥ì´ˆì†Œ].location" value="ì„±ë‚´ì£¼ì°¨ì¥ì´ˆì†Œ">
                                    <input type="hidden" name="workAssignment[ì„±ë‚´ì£¼ì°¨ì¥ì´ˆì†Œ].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ì„±ë‚´ì£¼ì°¨ì¥ì´ˆì†Œ].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ì„ ì ì¤‘ë¬¸</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ì„ ì ì¤‘ë¬¸_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì„ ì ì¤‘ë¬¸', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_ì„ ì ì¤‘ë¬¸_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì„ ì ì¤‘ë¬¸', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">5ì˜ì¥ì¤‘ë¬¸</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_5ì˜ì¥ì¤‘ë¬¸_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, '5ì˜ì¥ì¤‘ë¬¸', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_5ì˜ì¥ì¤‘ë¬¸_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, '5ì˜ì¥ì¤‘ë¬¸', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ì•„ì‚°ë¡œì¤‘ë¬¸</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ì•„ì‚°ë¡œì¤‘ë¬¸_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì•„ì‚°ë¡œì¤‘ë¬¸', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_ì•„ì‚°ë¡œì¤‘ë¬¸_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì•„ì‚°ë¡œì¤‘ë¬¸', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">í•­ë§Œìˆœì°°</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_í•­ë§Œìˆœì°°_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'í•­ë§Œìˆœì°°', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_í•­ë§Œìˆœì°°_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'í•­ë§Œìˆœì°°', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[í•­ë§Œìˆœì°°].region" value="í•´ì•ˆì§€ì—­">
                                    <input type="hidden" name="workAssignment[í•­ë§Œìˆœì°°].location" value="í•­ë§Œìˆœì°°">
                                    <input type="hidden" name="workAssignment[í•­ë§Œìˆœì°°].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[í•­ë§Œìˆœì°°].assignment.supervisor" value="">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- ì˜¤ë¥¸ìª½ ì˜ì—­ (ì„±ë‚´/ì‹œíŠ¸/ë§¤ì•”ë™ì§€ì—­) -->
                <div class="assignment-right">
                    <table class="work-assignment-table" style="table-layout: fixed; vertical-align: middle; font-size: 14px;">
                        <thead>
                            <tr style="height: 20px;">
                                <th class="region-col" style="vertical-align: middle;">ì§€ì—­</th>
                                <th class="location-col" style="vertical-align: middle;">ë³´ì•ˆê·¼ë¬´ì§€</th>
                                <th class="personnel-col" style="vertical-align: middle; text-align: center;">í¸ì„±</th>
                            </tr>
                        </thead>
                        <tr style="height: 1px; background-color: #ddd;">
                            <td colspan="3" style="padding: 0; height: 1px;"></td>
                        </tr>
                        <tbody>
                            <!-- ì„±ë‚´ì§€ì—­ -->
                            <tr>
                                <td rowspan="3" class="region-col">ì„±ë‚´ì§€ì—­</td>
                                <td rowspan="2" class="location-col">ì„±ë‚´ë¬¸</td>
                                <td class="personnel-col" style="border: none; border-right: 1px solid #ddd;">
                                    <input type="text" name="member_ì„±ë‚´ë¬¸_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì„±ë‚´ë¬¸', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 0; border-bottom: none; border-right: none;">
                                    <input type="text" name="member_ì„±ë‚´ë¬¸_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì„±ë‚´ë¬¸', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 0; border-bottom: none; border-left: none;">
                                    <input type="hidden" name="workAssignment[ì„±ë‚´ë¬¸].region" value="ì„±ë‚´ì§€ì—­">
                                    <input type="hidden" name="workAssignment[ì„±ë‚´ë¬¸].location" value="ì„±ë‚´ë¬¸">
                                    <input type="hidden" name="workAssignment[ì„±ë‚´ë¬¸].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ì„±ë‚´ë¬¸].assignment.supervisor" value="">
                                </td>
                            </tr>
                            <tr>
                                <td class="personnel-col" style="border: none; border-right: 1px solid #ddd;">
                                    <input type="text" name="member_ì„±ë‚´ë¬¸_2" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì„±ë‚´ë¬¸', 'members', 2) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 0; border-top: none; border-right: none;">
                                    <input type="text" name="member_ì„±ë‚´ë¬¸_3" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì„±ë‚´ë¬¸', 'members', 3) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 0; border-top: none; border-left: none;">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ì°¨ëŸ‰ê²€ìƒ‰ì†Œ</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ì°¨ëŸ‰ê²€ìƒ‰ì†Œ_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì°¨ëŸ‰ê²€ìƒ‰ì†Œ', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_ì°¨ëŸ‰ê²€ìƒ‰ì†Œ_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì°¨ëŸ‰ê²€ìƒ‰ì†Œ', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ì°¨ëŸ‰ê²€ìƒ‰ì†Œ].region" value="ì„±ë‚´ì§€ì—­">
                                    <input type="hidden" name="workAssignment[ì°¨ëŸ‰ê²€ìƒ‰ì†Œ].location" value="ì°¨ëŸ‰ê²€ìƒ‰ì†Œ">
                                    <input type="hidden" name="workAssignment[ì°¨ëŸ‰ê²€ìƒ‰ì†Œ].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ì°¨ëŸ‰ê²€ìƒ‰ì†Œ].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <!-- ì‹œíŠ¸ì§€ì—­ -->
                            <tr>
                                <td rowspan="6" class="region-col">ì‹œíŠ¸ì§€ì—­</td>
                                <td rowspan="2" class="location-col">ì‹œíŠ¸1ë¬¸</td>
                                <td class="personnel-col" style="border: none; border-right: 1px solid #ddd;">
                                    <div style="display: flex; gap: 60px; justify-content: flex-start;">
                                        <div style="text-align: left;">ì¡°ì¥: <input type="text" name="supervisor_ì‹œíŠ¸1ë¬¸" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì‹œíŠ¸1ë¬¸', 'supervisor') : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;"></div>
                                    </div>
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸1ë¬¸].region" value="ì‹œíŠ¸ì§€ì—­">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸1ë¬¸].location" value="ì‹œíŠ¸1ë¬¸">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸1ë¬¸].assignment.teamLeader" value="">
                                </td>
                            </tr>
                            <tr>
                                <td class="personnel-col" style="border: none; border-right: 1px solid #ddd;">
                                    <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                        <input type="text" name="member_ì‹œíŠ¸1ë¬¸_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì‹œíŠ¸1ë¬¸', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                        <input type="text" name="member_ì‹œíŠ¸1ë¬¸_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì‹œíŠ¸1ë¬¸', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    </div>
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ì‹œíŠ¸1ì¤‘ë¬¸</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ì‹œíŠ¸1ì¤‘ë¬¸_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì‹œíŠ¸1ì¤‘ë¬¸', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_ì‹œíŠ¸1ì¤‘ë¬¸_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì‹œíŠ¸1ì¤‘ë¬¸', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸1ì¤‘ë¬¸].region" value="ì‹œíŠ¸ì§€ì—­">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸1ì¤‘ë¬¸].location" value="ì‹œíŠ¸1ì¤‘ë¬¸">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸1ì¤‘ë¬¸].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸1ì¤‘ë¬¸].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ì‹œíŠ¸1ì£¼ì°¨ì¥ì´ˆì†Œ</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ì‹œíŠ¸1ì£¼ì°¨ì¥ì´ˆì†Œ_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì‹œíŠ¸1ì£¼ì°¨ì¥ì´ˆì†Œ', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸1ì£¼ì°¨ì¥ì´ˆì†Œ].region" value="ì‹œíŠ¸ì§€ì—­">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸1ì£¼ì°¨ì¥ì´ˆì†Œ].location" value="ì‹œíŠ¸1ì£¼ì°¨ì¥ì´ˆì†Œ">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸1ì£¼ì°¨ì¥ì´ˆì†Œ].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸1ì£¼ì°¨ì¥ì´ˆì†Œ].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ì‹œíŠ¸3ë¬¸</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ì‹œíŠ¸3ë¬¸_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì‹œíŠ¸3ë¬¸', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="text" name="member_ì‹œíŠ¸3ë¬¸_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì‹œíŠ¸3ë¬¸', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸3ë¬¸].region" value="ì‹œíŠ¸ì§€ì—­">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸3ë¬¸].location" value="ì‹œíŠ¸3ë¬¸">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸3ë¬¸].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ì‹œíŠ¸3ë¬¸].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ì½”ì¼ì£¼ì°¨ì¥</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ì½”ì¼ì£¼ì°¨ì¥_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì½”ì¼ì£¼ì°¨ì¥', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ì½”ì¼ì£¼ì°¨ì¥].region" value="ì‹œíŠ¸ì§€ì—­">
                                    <input type="hidden" name="workAssignment[ì½”ì¼ì£¼ì°¨ì¥].location" value="ì½”ì¼ì£¼ì°¨ì¥">
                                    <input type="hidden" name="workAssignment[ì½”ì¼ì£¼ì°¨ì¥].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ì½”ì¼ì£¼ì°¨ì¥].assignment.supervisor" value="">
                                </td>
                            </tr>
                            
                            <!-- ë§¤ì•”ë™ì§€ì—­ -->
                            <tr>
                                <td rowspan="2" class="region-col">ë§¤ì•”ë™ì§€ì—­</td>
                                <td class="location-col">ì—”ì§„4ë¶€</td>
                                <td class="personnel-col">
                                    <div style="display: flex; gap: 60px; justify-content: flex-start; margin-bottom: 5px;">
                                        <div style="text-align: left;">ì¡°ì¥: <input type="text" name="supervisor_ì—”ì§„4ë¶€" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì—”ì§„4ë¶€', 'supervisor') : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px;"></div>
                                    </div>
                                    <div>
                                        <input type="text" name="member_ì—”ì§„4ë¶€_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì—”ì§„4ë¶€', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                        <input type="text" name="member_ì—”ì§„4ë¶€_1" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì—”ì§„4ë¶€', 'members', 1) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    </div>
                                    <input type="hidden" name="workAssignment[ì—”ì§„4ë¶€].region" value="ë§¤ì•”ë™ì§€ì—­">
                                    <input type="hidden" name="workAssignment[ì—”ì§„4ë¶€].location" value="ì—”ì§„4ë¶€">
                                    <input type="hidden" name="workAssignment[ì—”ì§„4ë¶€].assignment.teamLeader" value="">
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="location-col">ì•¼ì ì¥ì´ˆì†Œ</td>
                                <td class="personnel-col">
                                    <input type="text" name="member_ì•¼ì ì¥ì´ˆì†Œ_0" value="<%= workOrder ? findAssignmentData(workOrder.workAssignment, 'ì•¼ì ì¥ì´ˆì†Œ', 'members', 0) : '' %>" style="width: 80px; border: 1px solid #ddd; padding: 2px; margin: 2px;">
                                    <input type="hidden" name="workAssignment[ì•¼ì ì¥ì´ˆì†Œ].region" value="ë§¤ì•”ë™ì§€ì—­">
                                    <input type="hidden" name="workAssignment[ì•¼ì ì¥ì´ˆì†Œ].location" value="ì•¼ì ì¥ì´ˆì†Œ">
                                    <input type="hidden" name="workAssignment[ì•¼ì ì¥ì´ˆì†Œ].assignment.teamLeader" value="">
                                    <input type="hidden" name="workAssignment[ì•¼ì ì¥ì´ˆì†Œ].assignment.supervisor" value="">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ì§ë¬´ êµìœ¡ -->
            <div class="form-section">
                <div class="section-header">â–¡ ì§ë¬´(ì•ˆì „/ë³´ê±´) êµìœ¡</div>
                <div class="section-content">
                    <div class="form-row">
                        <div class="form-group" style="width: 50%;">
                            <label>ê¸ˆì£¼ì¤‘ì </label>
                            <div style="margin-bottom: 10px;">
                                <button type="button" class="btn btn-secondary" onclick="addWeeklyFocus()" style="font-size: 12px; padding: 5px 10px;">ê¸ˆì£¼ì¤‘ì  ì¶”ê°€</button>
                            </div>
                            <div id="weeklyFocusItems">
                                <!-- ê¸ˆì£¼ì¤‘ì  í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                        <div class="form-group" style="width: 50%;">
                            <label>êµìœ¡ë‚´ìš©</label>
                            <div style="margin-bottom: 10px;">
                                <button type="button" class="btn btn-secondary" onclick="addEducationContent()" style="font-size: 12px; padding: 5px 10px;">êµìœ¡ë‚´ìš© ì¶”ê°€</button>
                            </div>
                            <div id="educationContentItems">
                                <!-- êµìœ¡ë‚´ìš© í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </form>
    </div>

    <script>
        // ê·¼ë¬´í¸ì„± ë°ì´í„° ì°¾ê¸° í•¨ìˆ˜
        function findAssignmentData(workAssignment, location, field, index = null) {
            if (!workAssignment || !Array.isArray(workAssignment)) {
                return '';
            }
            
            const assignment = workAssignment.find(item => item.location === location);
            if (!assignment || !assignment.assignment) {
                return '';
            }
            
            if (field === 'teamLeader') {
                return assignment.assignment.teamLeader || '';
            } else if (field === 'supervisor') {
                return assignment.assignment.supervisor || '';
            } else if (field === 'members' && index !== null) {
                return assignment.assignment.members && assignment.assignment.members[index] ? assignment.assignment.members[index] : '';
            }
            
            return '';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ì…ë ¥ ì‹¤í–‰ (ìˆ˜ì •í˜ì´ì§€ì—ì„œëŠ” ê¸°ì¡´ ë°ì´í„° ë¡œë“œ)
        document.addEventListener('DOMContentLoaded', function() {
            loadExistingData();
            displayTodaySchedule();
        });

        // í¼ ì œì¶œ ì‹œ ë””ë²„ê¹…
        document.getElementById('workOrderForm').addEventListener('submit', function(e) {
            console.log('ğŸ”§ ìˆ˜ì •í˜ì´ì§€ í¼ ì œì¶œ ì‹œì‘');
            
            // workAssignment ê´€ë ¨ ë°ì´í„° ìˆ˜ì§‘
            const workAssignmentData = {};
            const locations = ['í•´ì•ˆì…ë¬¸', 'í•´ì•ˆì¶œë¬¸', 'ê¸°ìˆ êµìœ¡ì›ë¬¸', 'êµìœ¡ì›ì¤‘ë¬¸', 'ì„±ë‚´ì£¼ì°¨ì¥ë¬¸', 'ì„±ë‚´ì£¼ì°¨ì¥ì´ˆì†Œ', 
                             'ì„ ì ì¤‘ë¬¸', '5ì˜ì¥ì¤‘ë¬¸', 'ì•„ì‚°ë¡œì¤‘ë¬¸', 'í•­ë§Œìˆœì°°', 'ì„±ë‚´ë¬¸', 'ì°¨ëŸ‰ê²€ìƒ‰ì†Œ', 
                             'ì‹œíŠ¸1ë¬¸', 'ì‹œíŠ¸1ì¤‘ë¬¸', 'ì‹œíŠ¸1ì£¼ì°¨ì¥ì´ˆì†Œ', 'ì‹œíŠ¸3ë¬¸', 'ì½”ì¼ì£¼ì°¨ì¥', 'ì—”ì§„4ë¶€', 'ì•¼ì ì¥ì´ˆì†Œ'];
            
            locations.forEach(location => {
                const teamLeader = document.querySelector(`input[name="teamLeader_${location}"]`)?.value || '';
                const supervisor = document.querySelector(`input[name="supervisor_${location}"]`)?.value || '';
                const members = [];
                
                for (let i = 0; i < 10; i++) {
                    const member = document.querySelector(`input[name="member_${location}_${i}"]`)?.value || '';
                    if (member.trim()) {
                        members.push(member.trim());
                    }
                }
                
                if (teamLeader || supervisor || members.length > 0) {
                    workAssignmentData[location] = {
                        teamLeader: teamLeader,
                        supervisor: supervisor,
                        members: members
                    };
                }
            });
            
            console.log('ğŸ”§ ìˆ˜ì •í˜ì´ì§€ ì „ì†¡í•  workAssignment ë°ì´í„°:', workAssignmentData);
        });

        // ê¸°ì¡´ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        function loadExistingData() {
            // ì‚¬ê³ ë‚´ìš© ë¡œë“œ
            loadAccidentItems();
            
            // êµìœ¡ë‚´ìš© ë¡œë“œ
            loadEducationContent();
        }

        // ì‚¬ê³ ë‚´ìš© ë¡œë“œ
        function loadAccidentItems() {
            <% if (workOrder.personnelStatus && workOrder.personnelStatus.absentDetails && workOrder.personnelStatus.absentDetails.length > 0) { %>
                <% workOrder.personnelStatus.absentDetails.forEach(function(detail) { %>
                    addAccidentItem('<%= detail.type %>', '<%= detail.employeeName %>');
                <% }); %>
            <% } %>
        }

        // êµìœ¡ë‚´ìš© ë¡œë“œ
        function loadEducationContent() {
            <% if (workOrder.education && workOrder.education.weeklyFocus && workOrder.education.weeklyFocus.length > 0) { %>
                <% workOrder.education.weeklyFocus.forEach(function(focus) { %>
                    addWeeklyFocus('<%= focus %>');
                <% }); %>
            <% } %>
            
            <% if (workOrder.education && workOrder.education.content && workOrder.education.content.length > 0) { %>
                <% workOrder.education.content.forEach(function(content) { %>
                    addEducationContent('<%= content %>');
                <% }); %>
            <% } %>
        }

        // ê·¼ë¬´ì •ë³´ ìë™ì…ë ¥ (ìƒˆ ëª…ë ¹ì„œ ì‘ì„± ì‹œ ì´ˆê¸°í™”)
        function autoFillWorkInfo() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const dateString = `${year}-${month}-${day}`;
            
            // ê¸°ë³¸ê°’ë§Œ ì„¤ì •í•˜ê³  ê¸°ì¡´ ë°ì´í„° ì œê±°
            document.getElementById('workDate').value = dateString;
            document.getElementById('workTeam').value = ''; // ë¹ˆ ê°’ìœ¼ë¡œ ì´ˆê¸°í™”
            document.getElementById('workTime').value = ''; // ë¹ˆ ê°’ìœ¼ë¡œ ì´ˆê¸°í™”
        }

        // ì£¼ì°¨ ê³„ì‚° í•¨ìˆ˜ (3ì£¼ ì£¼ê¸°)
        function getWeekCycle(date) {
            // ê¸°ì¤€ì¼: 2025ë…„ 1ì›” 1ì¼ (ìˆ˜ìš”ì¼)ì„ 1ì£¼ì°¨ë¡œ ì„¤ì •
            const baseDate = new Date('2025-01-01');
            const targetDate = new Date(date);
            
            // ì£¼ì°¨ ì‹œì‘ì¼ ê³„ì‚° (ì›”ìš”ì¼)
            const getWeekStart = (date) => {
                const day = date.getDay();
                const diff = date.getDate() - day + (day === 0 ? -6 : 1);
                const weekStart = new Date(date);
                weekStart.setDate(diff);
                weekStart.setHours(0, 0, 0, 0);
                return weekStart;
            };
            
            const baseWeekStart = getWeekStart(baseDate);
            const targetWeekStart = getWeekStart(targetDate);
            
            // ì£¼ì°¨ ì°¨ì´ ê³„ì‚°
            const timeDiff = targetWeekStart.getTime() - baseWeekStart.getTime();
            const weekDiff = Math.floor(timeDiff / (7 * 24 * 60 * 60 * 1000));
            
            // 3ì£¼ ì£¼ê¸°ë¡œ ìˆœí™˜ (1, 2, 3, 1, 2, 3...)
            return (weekDiff % 3) + 1;
        }

        // ê·¼ë¬´ë°˜ ì„ íƒ ì‹œ ê·¼ë¬´ì‹œê°„ ìë™ì…ë ¥ (3ì£¼ ì£¼ê¸° ìˆœí™˜ ìŠ¤ì¼€ì¤„)
        function updateWorkTime() {
            const workTeam = document.getElementById('workTeam').value;
            const workTimeField = document.getElementById('workTime');
            const workDate = document.getElementById('workDate').value;
            
            // ì„ íƒëœ ë‚ ì§œì˜ ìš”ì¼ í™•ì¸
            const selectedDate = new Date(workDate);
            const dayOfWeek = selectedDate.getDay(); // 0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼
            
            // ì£¼ì°¨ ê³„ì‚° (3ì£¼ ì£¼ê¸°)
            const weekCycle = getWeekCycle(selectedDate);
            
            let workTime = '';
            
            // ì£¼ë§/ê³µíœ´ì¼ ê·¼ë¬´
            if (dayOfWeek === 0 || dayOfWeek === 6) {
                if (dayOfWeek === 0) { // ì¼ìš”ì¼ íŠ¹ê·¼ê·¼ë¬´
                    // ì£¼ì°¨ ê³„ì‚°ìœ¼ë¡œ ê° íŒ€ì˜ í‰ì¼ ê·¼ë¬´í˜•íƒœ í™•ì¸
                    const weekNumber = getWeekNumber(selectedDate);
                    const team1Weekday = getTeamSchedule(1, weekNumber);
                    const team2Weekday = getTeamSchedule(2, weekNumber);
                    const team3Weekday = getTeamSchedule(3, weekNumber);
                    
                    // ì¼ìš”ì¼ì€ ì£¼ê°„ë°˜ì´ ë‹¤ìˆ˜ ê·¼ë¬´ì(20ëª…)ë¥¼ í¬í•¨í•˜ë¯€ë¡œ ì£¼ê°„ë°˜ì„ ê·¼ë¬´ë°˜ìœ¼ë¡œ ì§€ì •
                    const weekdayTeam = getTeamSchedule(parseInt(workTeam.replace('ë³´ì•ˆ', '').replace('ë°˜', '')), weekNumber);
                    
                    if (weekdayTeam === 'ì£¼ê°„') {
                        // ì£¼ê°„ë°˜ì´ ì£¼ê°„íŠ¹ê·¼ê·¼ë¬´ì™€ ì•¼ê°„íŠ¹ê·¼ê·¼ë¬´ í†µí•© (Aì¡°+Bì¡° 40ëª… + ì§€ì›ì¡° 20ëª…)
                        workTime = 'ì£¼ê°„íŠ¹ê·¼ê·¼ë¬´(06:00~18:00) / ì•¼ê°„íŠ¹ê·¼ê·¼ë¬´(18:00~06:00)';
                    } else {
                        // ì‹¬ì•¼ë°˜, ì´ˆì•¼ë°˜ì€ ì¼ìš”ì¼ íœ´ë¬´ (ì§€ì›ì¡°ë§Œ ì°¸ì—¬)
                        workTime = 'íœ´ë¬´';
                    }
                } else { // í† ìš”ì¼ íŠ¹ê·¼ê·¼ë¬´
                    // ì£¼ì°¨ ê³„ì‚°ìœ¼ë¡œ ê° íŒ€ì˜ í‰ì¼ ê·¼ë¬´í˜•íƒœ í™•ì¸
                    const weekNumber = getWeekNumber(selectedDate);
                    const teamNumber = parseInt(workTeam.replace('ë³´ì•ˆ', '').replace('ë°˜', ''));
                    const weekdayWorkType = getTeamSchedule(teamNumber, weekNumber);
                    
                    if (weekdayWorkType === 'ì‹¬ì•¼') {
                        // ì‹¬ì•¼ë°˜ì€ í† ìš”ì¼ ì•¼ê°„íŠ¹ê·¼ê·¼ë¬´
                        workTime = 'ì•¼ê°„íŠ¹ê·¼ê·¼ë¬´(18:00~06:00)';
                    } else if (weekdayWorkType === 'ì´ˆì•¼') {
                        // ì´ˆì•¼ë°˜ì€ í† ìš”ì¼ ì£¼ê°„íŠ¹ê·¼ê·¼ë¬´
                        workTime = 'ì£¼ê°„íŠ¹ê·¼ê·¼ë¬´(06:00~18:00)';
                    } else {
                        // ì£¼ê°„ë°˜ì€ í† ìš”ì¼ íœ´ë¬´
                        workTime = 'íœ´ë¬´';
                    }
                }
            } else {
                // í‰ì¼ ê·¼ë¬´ (ìƒˆë¡œìš´ í•¨ìˆ˜ ì‚¬ìš©)
                const weekNumber = getWeekNumber(selectedDate);
                const teamNumber = parseInt(workTeam.replace('ë³´ì•ˆ', '').replace('ë°˜', ''));
                const teamSchedule = getTeamSchedule(teamNumber, weekNumber);
                
                switch(teamSchedule) {
                    case 'ì£¼ê°„':
                        workTime = 'ì£¼ê°„ê·¼ë¬´(06:00~14:00)';
                        break;
                    case 'ì´ˆì•¼':
                        workTime = 'ì´ˆì•¼ê·¼ë¬´(14:00~22:00)';
                        break;
                    case 'ì‹¬ì•¼':
                        workTime = 'ì‹¬ì•¼ê·¼ë¬´(22:00~06:00)';
                        break;
                    default:
                        workTime = 'ê·¼ë¬´í˜•íƒœ ë¯¸ì •';
                }
            }
            
            workTimeField.value = workTime;
            
            // ì‹œê°„ ì •ë³´ ë¶„ë¦¬ ë° ì„¤ì •
            const workTimeStartField = document.getElementById('workTimeStart');
            const workTimeEndField = document.getElementById('workTimeEnd');
            const workShiftField = document.getElementById('workShift');
            
            // ì‹œê°„ ì¶”ì¶œ (ì˜ˆ: "ì•¼ê°„íŠ¹ê·¼(18:00~06:00)" -> start: "18:00", end: "06:00")
            const timeMatch = workTime.match(/\((\d{2}:\d{2})~(\d{2}:\d{2})\)/);
            if (timeMatch) {
                workTimeStartField.value = timeMatch[1];
                workTimeEndField.value = timeMatch[2];
            } else {
                workTimeStartField.value = '';
                workTimeEndField.value = '';
            }
            
            // shift ê°’ ì„¤ì • (ê·¼ë¬´ì‹œê°„ì—ì„œ ì¶”ì¶œ)
            if (workTime.includes('ì£¼ê°„')) {
                workShiftField.value = 'ì£¼ê°„';
            } else if (workTime.includes('ì´ˆì•¼')) {
                workShiftField.value = 'ì´ˆì•¼';
            } else if (workTime.includes('ì‹¬ì•¼')) {
                workShiftField.value = 'ì‹¬ì•¼';
            } else if (workTime.includes('ì•¼ê°„íŠ¹ê·¼')) {
                workShiftField.value = 'ì•¼ê°„íŠ¹ê·¼';
            } else if (workTime.includes('ì£¼ê°„íŠ¹ê·¼')) {
                workShiftField.value = 'ì£¼ê°„íŠ¹ê·¼';
            } else if (workTime.includes('íœ´ë¬´')) {
                workShiftField.value = 'íœ´ë¬´';
            } else {
                workShiftField.value = '';
            }
        }

        // ì¸ì›í˜„í™© ìë™ì…ë ¥ (ìƒˆ ëª…ë ¹ì„œ ì‘ì„± ì‹œ ì´ˆê¸°í™”)
        function autoFillPersonnelInfo() {
            // ê¸°ë³¸ê°’ ì„¤ì •
            document.getElementById('totalPersonnel').value = '40';
            document.getElementById('absentPersonnel').value = '0';
            document.getElementById('currentPersonnel').value = '40';
            
            // ê¸°ì¡´ ì‚¬ê³ ë‚´ìš© ì œê±°
            document.getElementById('accidentItems').innerHTML = '';
        }

        // ì§ë¬´êµìœ¡ ìë™ì…ë ¥ (ìƒˆ ëª…ë ¹ì„œ ì‘ì„± ì‹œ ì´ˆê¸°í™”)
        function autoFillEducationInfo() {
            // ê¸°ì¡´ êµìœ¡ë‚´ìš© ì œê±°
            document.getElementById('weeklyFocusItems').innerHTML = '';
            document.getElementById('educationContentItems').innerHTML = '';
        }

        // ê·¼ë¬´í¸ì„± í…Œì´ë¸” ì´ˆê¸°í™”
        function clearWorkAssignmentTable() {
            // ëª¨ë“  ê·¼ë¬´í¸ì„± ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            const inputs = document.querySelectorAll('.work-assignment-table input[type="text"]');
            inputs.forEach(input => {
                input.value = '';
            });
        }

        // ì‚¬ê³  í•­ëª© ì¶”ê°€
        function addAccidentItem(accidentType = '', personnelName = '') {
            const container = document.getElementById('accidentItems');
            const div = document.createElement('div');
            div.style.marginBottom = '10px';
            div.style.display = 'flex';
            div.style.alignItems = 'center';
            div.style.gap = '10px';
            
            div.innerHTML = `
                <select name="personnelStatus[absentDetails][][type]" style="width: 120px; padding: 5px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ì—°ì°¨1" ${accidentType === 'ì—°ì°¨1' ? 'selected' : ''}>ì—°ì°¨1</option>
                    <option value="ì—°ì°¨2" ${accidentType === 'ì—°ì°¨2' ? 'selected' : ''}>ì—°ì°¨2</option>
                    <option value="ë³‘ê°€" ${accidentType === 'ë³‘ê°€' ? 'selected' : ''}>ë³‘ê°€</option>
                    <option value="ì‚°ì¬" ${accidentType === 'ì‚°ì¬' ? 'selected' : ''}>ì‚°ì¬</option>
                    <option value="ì •ì§" ${accidentType === 'ì •ì§' ? 'selected' : ''}>ì •ì§</option>
                    <option value="íœ´ì§" ${accidentType === 'íœ´ì§' ? 'selected' : ''}>íœ´ì§</option>
                    <option value="ê²½ì¡°" ${accidentType === 'ê²½ì¡°' ? 'selected' : ''}>ê²½ì¡°</option>
                    <option value="ê²°ê·¼" ${accidentType === 'ê²°ê·¼' ? 'selected' : ''}>ê²°ê·¼</option>
                    <option value="ê¸°íƒ€" ${accidentType === 'ê¸°íƒ€' ? 'selected' : ''}>ê¸°íƒ€</option>
                    <option value="ê·¼ë¬´ì§€ì›ì¡°" ${accidentType === 'ê·¼ë¬´ì§€ì›ì¡°' ? 'selected' : ''}>ê·¼ë¬´ì§€ì›ì¡°</option>
                </select>
                <span>:</span>
                <input type="text" name="personnelStatus[absentDetails][][employeeName]" placeholder="ëª…ë‹¨" value="${personnelName}" style="width: 150px; padding: 5px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                <button type="button" onclick="removeAccidentItem(this)" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">ì‚­ì œ</button>
            `;
            
            container.appendChild(div);
        }

        // ì‚¬ê³  í•­ëª© ì‚­ì œ
        function removeAccidentItem(button) {
            button.parentElement.remove();
        }

        // ê¸ˆì£¼ì¤‘ì  ì¶”ê°€
        function addWeeklyFocus(content = '') {
            const container = document.getElementById('weeklyFocusItems');
            const div = document.createElement('div');
            div.style.marginBottom = '10px';
            div.style.display = 'flex';
            div.style.alignItems = 'flex-start';
            div.style.gap = '10px';
            
            div.innerHTML = `
                <textarea name="education[weeklyFocus][]" placeholder="ê¸ˆì£¼ì¤‘ì  ì…ë ¥" style="flex: 1; padding: 5px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; resize: vertical; min-height: 30px; max-height: 120px; font-family: inherit;">${content}</textarea>
                <button type="button" onclick="removeWeeklyFocus(this)" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-top: 2px;">ì‚­ì œ</button>
            `;
            
            container.appendChild(div);
            
            // ìë™ í¬ê¸° ì¡°ì •
            const textarea = div.querySelector('textarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
        }

        // ê¸ˆì£¼ì¤‘ì  ì‚­ì œ
        function removeWeeklyFocus(button) {
            button.parentElement.remove();
        }

        // êµìœ¡ë‚´ìš© ì¶”ê°€
        function addEducationContent(content = '') {
            const container = document.getElementById('educationContentItems');
            const div = document.createElement('div');
            div.style.marginBottom = '10px';
            div.style.display = 'flex';
            div.style.alignItems = 'flex-start';
            div.style.gap = '10px';
            
            div.innerHTML = `
                <textarea name="education[content][]" placeholder="êµìœ¡ë‚´ìš© ì…ë ¥" style="flex: 1; padding: 5px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; resize: vertical; min-height: 30px; max-height: 120px; font-family: inherit;">${content}</textarea>
                <button type="button" onclick="removeEducationContent(this)" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-top: 2px;">ì‚­ì œ</button>
            `;
            
            container.appendChild(div);
            
            // ìë™ í¬ê¸° ì¡°ì •
            const textarea = div.querySelector('textarea');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
        }

        // êµìœ¡ë‚´ìš© ì‚­ì œ
        function removeEducationContent(button) {
            button.parentElement.remove();
        }

        // ì´ì› ë³€ê²½ ì‹œ í˜„ì¬ì› ìë™ ê³„ì‚°
        document.getElementById('totalPersonnel').addEventListener('input', function() {
            const total = parseInt(this.value) || 0;
            const absent = parseInt(document.getElementById('absentPersonnel').value) || 0;
            const current = total - absent;
            document.getElementById('currentPersonnel').value = current;
        });

        // ê²°ì› ìˆ˜ ë³€ê²½ ì‹œ í˜„ì¬ì› ìë™ ê³„ì‚°
        document.getElementById('absentPersonnel').addEventListener('input', function() {
            const total = parseInt(document.getElementById('totalPersonnel').value) || 0;
            const absent = parseInt(this.value) || 0;
            const current = total - absent;
            document.getElementById('currentPersonnel').value = current;
        });

        // ê·¼ë¬´ë°˜ ì„ íƒ ì‹œ ê·¼ë¬´ì‹œê°„ ìë™ì…ë ¥
        document.getElementById('workTeam').addEventListener('change', updateWorkTime);
        
        // ë‚ ì§œ ë³€ê²½ ì‹œì—ë„ ê·¼ë¬´ì‹œê°„ ìë™ì…ë ¥
        document.getElementById('workDate').addEventListener('change', updateWorkTime);

        // ì˜¤ëŠ˜ì˜ ê·¼ë¬´í˜•íƒœ í‘œì‹œ í•¨ìˆ˜
        function displayTodaySchedule() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            
            // ì¼ìš”ì¼ì¸ ê²½ìš°ì—ë§Œ íŠ¹ê·¼ê·¼ë¬´ ìŠ¤ì¼€ì¤„ í‘œì‹œ
            if (dayOfWeek === 0) {
                const weekNumber = getWeekNumber(today);
                const cycle = weekNumber % 3;
                
                // ê° íŒ€ì˜ í‰ì¼ ê·¼ë¬´í˜•íƒœ ê³„ì‚°
                const team1Weekday = getTeamSchedule(1, weekNumber);
                const team2Weekday = getTeamSchedule(2, weekNumber);
                const team3Weekday = getTeamSchedule(3, weekNumber);
                
                const container = document.getElementById('todayScheduleContainer');
                
                // ì¼ìš”ì¼ íŠ¹ê·¼ê·¼ë¬´ ìŠ¤ì¼€ì¤„ HTML ìƒì„±
                container.innerHTML = `
                    <div class="col-md-12">
                        <div class="alert alert-info">
                            <h6><i class="fa-solid fa-calendar-day me-2"></i>2025ë…„ 9ì›” 7ì¼ ì¼ìš”ì¼ íŠ¹ê·¼ê·¼ë¬´</h6>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="card border-success">
                                        <div class="card-header bg-success text-white py-2">
                                            <h6 class="mb-0">ë³´ì•ˆ2ë°˜ - ì£¼ê°„íŠ¹ê·¼</h6>
                                        </div>
                                        <div class="card-body py-2">
                                            <div class="text-center">
                                                <div class="h6 mb-0 text-success">ì£¼ê°„íŠ¹ê·¼ê·¼ë¬´</div>
                                                <small class="text-muted">06:00~18:00 (Aì¡° 20ëª… + ì§€ì›ì¡° 10ëª…)</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card border-warning">
                                        <div class="card-header bg-warning text-white py-2">
                                            <h6 class="mb-0">ë³´ì•ˆ2ë°˜ - ì•¼ê°„íŠ¹ê·¼</h6>
                                        </div>
                                        <div class="card-body py-2">
                                            <div class="text-center">
                                                <div class="h6 mb-0 text-warning">ì•¼ê°„íŠ¹ê·¼ê·¼ë¬´</div>
                                                <small class="text-muted">18:00~06:00 (Bì¡° 20ëª… + ì§€ì›ì¡° 10ëª…)</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <small class="text-muted">
                                    <i class="fa-solid fa-info-circle me-1"></i>
                                    ì¼ìš”ì¼ì€ íŠ¹ê·¼ê·¼ë¬´ë¡œ 12ì‹œê°„ì”© ê·¼ë¬´í•©ë‹ˆë‹¤. ê° íŒ€ì˜ ì¡°ë³„ë¡œ ë‹¤ë¥¸ ê·¼ë¬´í˜•íƒœë¥¼ ê°€ì§‘ë‹ˆë‹¤.
                                </small>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // í‰ì¼ì¸ ê²½ìš° ê°„ë‹¨í•œ ë©”ì‹œì§€ í‘œì‹œ
                const container = document.getElementById('todayScheduleContainer');
                container.innerHTML = `
                    <div class="col-md-12">
                        <div class="alert alert-secondary">
                            <h6><i class="fa-solid fa-calendar me-2"></i>í‰ì¼ ê·¼ë¬´</h6>
                            <p class="mb-0">ì˜¤ëŠ˜ì€ í‰ì¼ì…ë‹ˆë‹¤. ê° íŒ€ì˜ ì •ê·œ ê·¼ë¬´í˜•íƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                        </div>
                    </div>
                `;
            }
        }

        // ì£¼ì°¨ ê³„ì‚° í•¨ìˆ˜ (1ì›” 1ì¼ ìˆ˜ìš”ì¼ë¶€í„° ì‹œì‘, ê¸°ì¤€ì¼ ì¡°ì •)
        function getWeekNumber(date) {
            // 2025ë…„ 1ì›” 1ì¼(ìˆ˜ìš”ì¼) 06:00ì„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°í•˜ë˜, 1ì£¼ì°¨ ë¶€ì¡± ë¬¸ì œ í•´ê²°
            const yearStart = new Date(2025, 0, 1, 6, 0, 0); // 2025ë…„ 1ì›” 1ì¼ 06:00
            const targetDate = new Date(date);
            
            // ì›”ìš”ì¼ 06:00ìœ¼ë¡œ ì¡°ì •
            const dayOfWeek = targetDate.getDay();
            const mondayOffset = dayOfWeek === 0 ? 6 : dayOfWeek - 1;
            
            const monday6am = new Date(targetDate);
            monday6am.setDate(targetDate.getDate() - mondayOffset);
            monday6am.setHours(6, 0, 0, 0);
            
            const weekDiff = Math.floor((monday6am - yearStart) / (7 * 24 * 60 * 60 * 1000));
            const weekNumber = weekDiff + 2; // +1ì„ +2ë¡œ ìˆ˜ì •í•˜ì—¬ 1ì£¼ì°¨ ì¶”ê°€
            
            return weekNumber;
        }

        // íŒ€ë³„ ê·¼ë¬´í˜•íƒœ ê³„ì‚° í•¨ìˆ˜ (ì˜¬ë°”ë¥¸ íŒ¨í„´ ê¸°ë°˜)
        function getTeamSchedule(teamNumber, weekNumber) {
            // 1ì£¼ì°¨: 1ë°˜ ì´ˆì•¼, 2ë°˜ ì‹¬ì•¼, 3ë°˜ ì£¼ê°„
            // 2ì£¼ì°¨: 1ë°˜ ì£¼ê°„, 2ë°˜ ì´ˆì•¼, 3ë°˜ ì‹¬ì•¼
            // 3ì£¼ì°¨: 1ë°˜ ì‹¬ì•¼, 2ë°˜ ì£¼ê°„, 3ë°˜ ì´ˆì•¼
            // 4ì£¼ì°¨: 1ë°˜ ì´ˆì•¼, 2ë°˜ ì‹¬ì•¼, 3ë°˜ ì£¼ê°„ (1ì£¼ì°¨ì™€ ë™ì¼)
            // 5ì£¼ì°¨: 1ë°˜ ì£¼ê°„, 2ë°˜ ì´ˆì•¼, 3ë°˜ ì‹¬ì•¼ (2ì£¼ì°¨ì™€ ë™ì¼)
            // 6ì£¼ì°¨: 1ë°˜ ì‹¬ì•¼, 2ë°˜ ì£¼ê°„, 3ë°˜ ì´ˆì•¼ (3ì£¼ì°¨ì™€ ë™ì¼)
            
            const cycle = (weekNumber - 1) % 3; // 0, 1, 2 ë°˜ë³µ
            
            if (teamNumber === 1) {
                // 1ë°˜: ì´ˆì•¼(1ì£¼ì°¨) â†’ ì£¼ê°„(2ì£¼ì°¨) â†’ ì‹¬ì•¼(3ì£¼ì°¨)
                const schedules = ['ì´ˆì•¼', 'ì£¼ê°„', 'ì‹¬ì•¼'];
                return schedules[cycle];
            } else if (teamNumber === 2) {
                // 2ë°˜: ì‹¬ì•¼(1ì£¼ì°¨) â†’ ì´ˆì•¼(2ì£¼ì°¨) â†’ ì£¼ê°„(3ì£¼ì°¨)
                const schedules = ['ì‹¬ì•¼', 'ì´ˆì•¼', 'ì£¼ê°„'];
                return schedules[cycle];
            } else if (teamNumber === 3) {
                // 3ë°˜: ì£¼ê°„(1ì£¼ì°¨) â†’ ì‹¬ì•¼(2ì£¼ì°¨) â†’ ì´ˆì•¼(3ì£¼ì°¨)
                const schedules = ['ì£¼ê°„', 'ì‹¬ì•¼', 'ì´ˆì•¼'];
                return schedules[cycle];
            }
            
            return 'ì£¼ê°„';
        }

    </script>

    </div>
</div>

<%- include('footer') %>
</body>
</html>
