<%- include('header') %>

<style>
  .employee-dashboard {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px 0;
  }
  
  .stats-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 30px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px);
  }
  
  .employee-card {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    height: 100%;
  }
  
  .employee-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
  }
  
  .profile-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
  }
  
  .profile-placeholder {
    width: 100%;
    height: 200px;
    background: linear-gradient(45deg, #667eea, #764ba2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 3rem;
  }
  
  .employee-info {
    padding: 20px;
  }
  
  .employee-name {
    font-size: 1.3rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 5px;
  }
  
  .employee-position {
    color: #718096;
    font-size: 0.9rem;
    margin-bottom: 15px;
  }
  
  .info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 15px;
  }
  
  .info-item {
    font-size: 0.85rem;
  }
  
  .info-label {
    color: #718096;
    font-weight: 500;
  }
  
  .info-value {
    color: #2d3748;
    font-weight: 600;
  }
  
  .status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }
  
  .status-active {
    background: #c6f6d5;
    color: #22543d;
  }
  
  .status-inactive {
    background: #fed7d7;
    color: #742a2a;
  }
  
  .action-buttons {
    display: flex;
    gap: 8px;
    margin-top: 15px;
  }
  
  .btn-action {
    flex: 1;
    padding: 8px 12px;
    font-size: 0.8rem;
    border-radius: 8px;
    text-decoration: none;
    text-align: center;
    transition: all 0.2s ease;
  }
  
  .btn-view {
    background: #4299e1;
    color: white;
    border: none;
  }
  
  .btn-view:hover {
    background: #3182ce;
    color: white;
  }
  
  .btn-edit {
    background: #48bb78;
    color: white;
    border: none;
  }
  
  .btn-edit:hover {
    background: #38a169;
    color: white;
  }
  
  .btn-delete {
    background: #f56565;
    color: white;
    border: none;
  }
  
  .btn-delete:hover {
    background: #e53e3e;
    color: white;
  }
  
  .search-filter {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 30px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .stat-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
  }
  
  .stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: #667eea;
  }
  
  .stat-label {
    color: #718096;
    font-size: 0.9rem;
    margin-top: 5px;
  }
  
  .department-filter {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 15px;
  }
  
  .filter-btn {
    padding: 6px 16px;
    border: 2px solid #e2e8f0;
    background: white;
    color: #4a5568;
    border-radius: 20px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .filter-btn.active {
    background: #667eea;
    color: white;
    border-color: #667eea;
  }
  
  .filter-btn:hover {
    border-color: #667eea;
    color: #667eea;
  }
  
  .filter-btn.active:hover {
    background: #5a67d8;
    color: white;
  }
  
  .no-employees {
    text-align: center;
    padding: 60px 20px;
    color: #718096;
  }
  
  .no-employees i {
    font-size: 4rem;
    margin-bottom: 20px;
    color: #cbd5e0;
  }
</style>

<div class="employee-dashboard">
  <div class="container">
    <!-- 헤더 섹션 -->
    <div class="stats-card">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="mb-1" style="color: #2d3748; font-weight: 700;">
            <i class="fas fa-users me-2"></i>직원 관리 대시보드
          </h2>
          <p class="text-muted mb-0">전체 직원 정보를 한눈에 확인하고 관리하세요</p>
        </div>
        <a href="/admin/employees/new" class="btn btn-success btn-lg">
          <i class="fas fa-plus me-2"></i>신입직원 추가
        </a>
      </div>
      
      <% if (typeof message !== 'undefined' && message) { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          <i class="fas fa-check-circle me-2"></i>
          <%= message %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% } %>
    </div>

    <!-- 통계 카드 -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number"><%= employees.length %></div>
        <div class="stat-label">전체 직원</div>
      </div>
      <div class="stat-card">
        <div class="stat-number"><%= employees.filter(e => e.department === '보안1팀').length %></div>
        <div class="stat-label">보안1팀</div>
      </div>
      <div class="stat-card">
        <div class="stat-number"><%= employees.filter(e => e.department === '보안2팀').length %></div>
        <div class="stat-label">보안2팀</div>
      </div>
      <div class="stat-card">
        <div class="stat-number"><%= employees.filter(e => e.department === '관리팀').length %></div>
        <div class="stat-label">관리팀</div>
      </div>
    </div>

    <!-- 검색 및 필터 -->
    <div class="search-filter">
      <div class="row">
        <div class="col-md-6">
          <div class="input-group">
            <span class="input-group-text">
              <i class="fas fa-search"></i>
            </span>
            <input type="text" id="searchInput" class="form-control" placeholder="직원명, 사번, 이메일로 검색...">
          </div>
        </div>
        <div class="col-md-6">
          <select id="departmentFilter" class="form-select">
            <option value="">전체 부서</option>
            <option value="보안1팀">보안1팀</option>
            <option value="보안2팀">보안2팀</option>
            <option value="보안3팀">보안3팀</option>
            <option value="관리팀">관리팀</option>
            <option value="인사팀">인사팀</option>
            <option value="영업팀">영업팀</option>
            <option value="지원팀">지원팀</option>
          </select>
        </div>
      </div>
      
      <div class="department-filter">
        <button class="filter-btn active" data-department="">전체</button>
        <button class="filter-btn" data-department="보안1팀">보안1팀</button>
        <button class="filter-btn" data-department="보안2팀">보안2팀</button>
        <button class="filter-btn" data-department="보안3팀">보안3팀</button>
        <button class="filter-btn" data-department="관리팀">관리팀</button>
        <button class="filter-btn" data-department="인사팀">인사팀</button>
        <button class="filter-btn" data-department="영업팀">영업팀</button>
        <button class="filter-btn" data-department="지원팀">지원팀</button>
      </div>
    </div>

    <!-- 직원 카드 그리드 -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="employeeGrid">
      <% if (employees.length === 0) { %>
        <div class="col-12">
          <div class="no-employees">
            <i class="fas fa-users"></i>
            <h4>등록된 직원이 없습니다</h4>
            <p>첫 번째 직원을 추가해보세요!</p>
            <a href="/admin/employees/new" class="btn btn-primary">
              <i class="fas fa-plus me-2"></i>직원 추가
            </a>
          </div>
        </div>
      <% } else { %>
        <% employees.forEach(function(emp) { %>
          <div class="col employee-item" 
               data-name="<%= emp.name.toLowerCase() %>" 
               data-empno="<%= (emp.empNo || '').toLowerCase() %>" 
               data-email="<%= emp.email.toLowerCase() %>" 
               data-department="<%= emp.department || '' %>">
            <div class="employee-card">
              <!-- 프로필 이미지 -->
              <% if (emp.profileImage) { %>
                <img src="<%= emp.profileImage %>" class="profile-image" alt="<%= emp.name %> 프로필">
              <% } else { %>
                <div class="profile-placeholder">
                  <i class="fas fa-user"></i>
                </div>
              <% } %>
              
              <!-- 직원 정보 -->
              <div class="employee-info">
                <div class="employee-name"><%= emp.name %></div>
                <div class="employee-position"><%= emp.position || '직책 미지정' %></div>
                
                <!-- 상태 배지 -->
                <span class="status-badge status-active">재직중</span>
                
                <!-- 주요 정보 -->
                <div class="info-grid">
                  <div class="info-item">
                    <div class="info-label">사번</div>
                    <div class="info-value"><%= emp.empNo || '-' %></div>
                  </div>
                  <div class="info-item">
                    <div class="info-label">부서</div>
                    <div class="info-value"><%= emp.department || '-' %></div>
                  </div>
                  <div class="info-item">
                    <div class="info-label">이메일</div>
                    <div class="info-value"><%= emp.email %></div>
                  </div>
                  <div class="info-item">
                    <div class="info-label">전화번호</div>
                    <div class="info-value"><%= emp.phone || '-' %></div>
                  </div>
                  <div class="info-item">
                    <div class="info-label">입사일</div>
                    <div class="info-value"><%= emp.hireDate ? emp.hireDate.toISOString().slice(0,10) : '-' %></div>
                  </div>
                  <div class="info-item">
                    <div class="info-label">채용형태</div>
                    <div class="info-value"><%= emp.employmentType || '-' %></div>
                  </div>
                </div>
                
                <!-- 액션 버튼 -->
                <div class="action-buttons">
                  <a href="/admin/employees/<%= emp._id %>" class="btn-action btn-view">
                    <i class="fas fa-eye me-1"></i>상세보기
                  </a>
                  <a href="/employees/<%= emp._id %>/edit" class="btn-action btn-edit">
                    <i class="fas fa-edit me-1"></i>수정
                  </a>
                  <button onclick="deleteEmployee('<%= emp._id %>', '<%= emp.name %>')" class="btn-action btn-delete">
                    <i class="fas fa-trash me-1"></i>삭제
                  </button>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      <% } %>
    </div>
  </div>
</div>

<script>
// 검색 및 필터 기능
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('searchInput');
  const departmentFilter = document.getElementById('departmentFilter');
  const filterButtons = document.querySelectorAll('.filter-btn');
  const employeeItems = document.querySelectorAll('.employee-item');
  
  // 검색 기능
  searchInput.addEventListener('input', filterEmployees);
  departmentFilter.addEventListener('change', filterEmployees);
  
  // 필터 버튼 클릭
  filterButtons.forEach(button => {
    button.addEventListener('click', function() {
      // 활성 버튼 변경
      filterButtons.forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      
      // 필터 적용
      const department = this.dataset.department;
      departmentFilter.value = department;
      filterEmployees();
    });
  });
  
  function filterEmployees() {
    const searchTerm = searchInput.value.toLowerCase();
    const selectedDepartment = departmentFilter.value;
    
    employeeItems.forEach(item => {
      const name = item.dataset.name;
      const empno = item.dataset.empno;
      const email = item.dataset.email;
      const department = item.dataset.department;
      
      const matchesSearch = name.includes(searchTerm) || 
                           empno.includes(searchTerm) || 
                           email.includes(searchTerm);
      
      const matchesDepartment = !selectedDepartment || department === selectedDepartment;
      
      if (matchesSearch && matchesDepartment) {
        item.style.display = 'block';
      } else {
        item.style.display = 'none';
      }
    });
    
    // 결과가 없을 때 메시지 표시
    const visibleItems = document.querySelectorAll('.employee-item[style="display: block"]');
    const noResultsDiv = document.getElementById('noResults');
    
    if (visibleItems.length === 0 && (searchTerm || selectedDepartment)) {
      if (!noResultsDiv) {
        const div = document.createElement('div');
        div.id = 'noResults';
        div.className = 'col-12';
        div.innerHTML = `
          <div class="no-employees">
            <i class="fas fa-search"></i>
            <h4>검색 결과가 없습니다</h4>
            <p>다른 검색어나 필터를 시도해보세요.</p>
          </div>
        `;
        document.getElementById('employeeGrid').appendChild(div);
      }
    } else if (noResultsDiv) {
      noResultsDiv.remove();
    }
  }
});

// 직원 삭제 함수
function deleteEmployee(employeeId, employeeName) {
  if (confirm(`정말로 ${employeeName} 직원을 삭제하시겠습니까?\n\n이 작업은 되돌릴 수 없습니다.`)) {
    fetch(`/employees/${employeeId}?_method=DELETE`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      }
    }).then(response => {
      if (response.ok) {
        location.reload();
      } else {
        alert('삭제 중 오류가 발생했습니다.');
      }
    }).catch(error => {
      console.error('Error:', error);
      alert('삭제 중 오류가 발생했습니다.');
    });
  }
}
</script>

<%- include('footer') %> 